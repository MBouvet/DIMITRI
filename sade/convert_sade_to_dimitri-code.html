<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:54 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>convert_sade_to_dimitri.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="convert_sade_to_dimitri.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      CONVERT_SADE_TO_DIMITRI       </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      CONVERTS A SADE FORMAT FILE INTO THE DIMITRI TOA REF ARRAY</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = CONVERT_SADE_TO_DIMITRI(SADEFILE,SENSOR) </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      SADEFILE - THE FULL PATH TO THE SADE FILE  </span>
<span class="comments">;*      SENSOR   - THE SENSOR NAME</span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      SENSOR_TOA_REF - THE DIMITRI ARRAY STRUCTURE</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      16 DEC 2011 - C KENT  - INITIAL DIMITRI VERSION</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION CONVERT_SADE_TO_DIMITRI,SADEFILE,SENSOR

  CASE SENSOR OF
    'AATSR'       : NBANDS=7 
    'MERIS'       : NBANDS=15 
    'MODISA'      : NBANDS=10 
    'PARASOL'     : NBANDS=9 
    'VEGETATION'  : NBANDS=4 
  ENDCASE

  IF SENSOR EQ 'MODISA' THEN TBANDS = 22 ELSE TBANDS=NBANDS
  BIDX = [0,1,15,2,16,20,21,17,18,19] <span class="comments">;ONLY FOR MODISA</span>
  NUMNONREF=12+5

<span class="comments">;------------------------------</span>
<span class="comments">;READ THE SADE FILE</span>

  SADEDATA = READ_SADE_TXT(SADEFILE,SENSOR)

<span class="comments">;------------------------------</span>
<span class="comments">;CREATE A DIMITRI STRUCTURE TO HOLD THE DATA</span>

  SENSOR_TOA_REF = MAKE_ARRAY(/DOUBLE,2*TBANDS+NUMNONREF,N_ELEMENTS(SADEDATA.PROCNAME),VALUE=-999.)
  EMPTY_AUX = MAKE_ARRAY(12,/DOUBLE,VALUE=-999.)

<span class="comments">;------------------------------</span>
<span class="comments">; LOOP OVER EACH SADE OBSERVATION</span>

  FOR ISADE = 0,N_ELEMENTS(SADEDATA.PROCNAME)-1 DO BEGIN
 
<span class="comments">;------------------------------ </span>
<span class="comments">; CONVERT TIME TO DECIMAL FORMAT</span>
  
    TTIME = SADEDATA.ACQDATE[ISADE]
    YEAR    = DOUBLE(STRMID(TTIME,6,4))
    MONTH   = DOUBLE(STRMID(TTIME,3,2))
    DAY     = DOUBLE(STRMID(TTIME,0,2))
    HOUR    = DOUBLE(STRMID(TTIME,11,2))
    MINUTE  = DOUBLE(STRMID(TTIME,14,2))
    SECOND  = DOUBLE(STRMID(TTIME,17,2))
  
    IF FLOOR(YEAR) MOD 4 EQ 0 THEN DIY=366. ELSE DIY=365. 
    TEMP = DOUBLE((HOUR/(DIY*24.))+(MINUTE/(DIY*60.*24.))+SECOND/(DIY*60.*60.*24.)) 
    DOY  = JULDAY(MONTH,DAY,YEAR)-JULDAY(1,0,YEAR)
    DTIME  = DOUBLE(YEAR)+(DOUBLE(DOY)/DIY)+TEMP

<span class="comments">;------------------------------</span>
<span class="comments">; EXTRACT ANGLES AND PARASOL CENTRE WAVELENGTH</span>
    
    IDX = 3 <span class="comments">;IS PARASOL 670NM BAND FOR ASCENDING ORDER WAVELENGTHS</span>
    VZA = SADEDATA.(4+2*NBANDS+IDX)[ISADE]
    VAA = SADEDATA.(4+3*NBANDS+IDX)[ISADE]
    SZA = SADEDATA.(4+4*NBANDS+3)[ISADE]
    SAA = SADEDATA.(4+4*NBANDS+4)[ISADE]

<span class="comments">;------------------------------</span>
<span class="comments">; EXTRACT REF</span>
<span class="comments">; EXTRACT STD</span>

    FOR IVAL = 0,1 DO BEGIN
      TEMP = 0.0
      FOR IBAND=0,NBANDS-1 DO BEGIN
        TEMP = [TEMP,SADEDATA.(4+IBAND+IVAL*NBANDS)[ISADE]]
      ENDFOR
      TEMP = TEMP[1:NBANDS]
      CASE IVAL OF
        0 : TOA_REF = TEMP 
        1 : TOA_STD = TEMP
      ENDCASE
    ENDFOR

<span class="comments">;------------------------------</span>
<span class="comments">; MODISA BAND EXCEPTION - INSERT TOAREF INTO A 22 BAND ARRAY</span>
    
    IF SENSOR EQ 'MODISA' THEN BEGIN
      TEMP = TOA_REF
      TOA_REF = DBLARR(TBANDS)-999.
      TOA_REF[BIDX] = TEMP
      TEMP = TOA_STD
      TOA_STD = DBLARR(TBANDS)-999.
      TOA_STD[BIDX] = TEMP
    ENDIF

<span class="comments">;-------------------------------</span>
<span class="comments">; METEO INFORMATION</span>

  <span class="comments">;DIMITRI WANTS OZONE, PRESSURE, HUMIDITY, WIND SPEED1, WNDSPEED 2, WVAP</span>
    EMPTY_AUX[10] = SADEDATA.WVAP[ISADE]
    EMPTY_AUX[0] = SADEDATA.OZONE[ISADE] lt 0. ? -999. : SADEDATA.OZONE[ISADE]*1000. <span class="comments">; if valid then multiply by 1000</span>
    EMPTY_AUX[2] = SADEDATA.PRESS[ISADE]
    
    if SADEDATA.WIND[ISADE] lt 0. or SADEDATA.WIND[ISADE] gt 100. then begin
    EMPTY_AUX[6] = -999.
    EMPTY_AUX[8] = -999.
    endif else begin
    WIND = SADEDATA.WIND[ISADE] 
    EMPTY_AUX[6] = SQRT((WIND^2)/2.)
    EMPTY_AUX[8] = SQRT((WIND^2)/2.)
    endelse

<span class="comments">;------------------------------</span>
<span class="comments">; PLACE ALL DATA INTO DIMITRI VARIABLE</span>
  
    SENSOR_TOA_REF[*,ISADE] = [DTIME,VZA,VAA,SZA,SAA,EMPTY_AUX,TOA_REF,TOA_STD]
  ENDFOR

  RETURN,SENSOR_TOA_REF

END
</code>
    </div>
  </body>
</html>