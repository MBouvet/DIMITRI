<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:54 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>get_parasol_viewing_geometries.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="get_parasol_viewing_geometries.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*     GET_PARASOL_VIEWING_GEOMETRIES     </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*     RETURNS THE SITE AVERAGE PARASOL VZA AND VAA VALUES FOR EACH BAND AND DIRECTION </span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = GET_PARASOL_VIEWING_GEOMETRIES(PNAME,ICOORDS,SITE) </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      PNAME   - THE PARASOL PRODUCT NAME</span>
<span class="comments">;*      ICOORDS - THE LAT AND LON COORDINATES OF THE SITE [NLAT,SALT,ELON,WLON]</span>
<span class="comments">;*      SITE    - THE SITE NAME</span>
<span class="comments">;*      </span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      COMPANG - THE COMPUTE VZA AND VAA ANGLES FOR EACH BAND AND DIRECTION</span>
<span class="comments">;*      </span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      16 DEC 2011 - C KENT  - INITIAL DIMITRI VERSION</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION GET_PARASOL_VIEWING_GEOMETRIES,PNAME,ICOORDS,SITE

<span class="comments">;--------------------------</span>
<span class="comments">; FIND THE DATA PRODUCT</span>

  IFOLDER = get_dimitri_location('INPUT')<span class="comments">;'/mnt/USB_drive/DIMITRI/DIMITRI_2.0/Input/'</span>
  DL=PATH_SEP()
  FF = IFOLDER+'Site_'+SITE+DL+'PARASOL'+DL+'Proc_Calibration_1'+DL
  NAME = FILE_SEARCH(FF,PNAME)
  COMPANG = MAKE_ARRAY(9,16,2,/FLOAT)
  IF NAME EQ '' THEN STOP

<span class="comments">;--------------------------</span>
<span class="comments">; READ IN THE DATA</span>

  L1B_DATA = GET_PARASOL_L1B_DATA(NAME[0]) 

<span class="comments">;--------------------------</span>
<span class="comments">; GET INDEX OF GOOD DATA WITHIN ICOORDS</span>

  FOR INDIRECTION=0,15 DO BEGIN
    ROI_INDEX = WHERE($
                L1B_DATA.LATITUDE LT ICOORDS[0] AND $
                L1B_DATA.LATITUDE GT ICOORDS[1] AND $
                L1B_DATA.LONGITUDE LT ICOORDS[2] AND $
                L1B_DATA.LONGITUDE GT ICOORDS[3] AND $<span class="comments">;)</span>
                L1B_DATA.REF_443NP[INDIRECTION] GT 0.0) 
    TEMPIXVZA = MAKE_ARRAY(N_ELEMENTS(ROI_INDEX),9,/FLOAT)
    TEMPIXVAA = MAKE_ARRAY(N_ELEMENTS(ROI_INDEX),9,/FLOAT)
    FOR IPIX = 0,N_ELEMENTS(ROI_INDEX)-1 DO BEGIN
      PVZA = L1B_DATA[ROI_INDEX[IPIX]].VZA[INDIRECTION]
      PRAA = L1B_DATA[ROI_INDEX[IPIX]].RAA[INDIRECTION]
      PDVZC = L1B_DATA[ROI_INDEX[IPIX]].DELTA_AV_COS_A[INDIRECTION]
      PDVZS = L1B_DATA[ROI_INDEX[IPIX]].DELTA_AV_SIN_A[INDIRECTION]
      NEWANGLES = COMPUTE_PARASOL_VIEWING_GEOMETRIES(PVZA,PRAA,PDVZC,PDVZS,/ORDER)
      TEMPIXVZA[IPIX,*] = NEWANGLES.VZA
      TEMPIXVAA[IPIX,*] = NEWANGLES.RAA
    ENDFOR
    FOR IPBAND=0,9-1 DO BEGIN
      NVZA = MEAN(TEMPIXVZA[*,IPBAND])
      NVAA = MEAN(L1B_DATA[ROI_INDEX].SAA-TEMPIXVAA[*,IPBAND])
      TEMP_ANGLES = DIMITRI_ANGLE_CORRECTOR(NVZA,NVAA,0.0,0.0)
      COMPANG[IPBAND,INDIRECTION,0] = TEMP_ANGLES.VZA
      COMPANG[IPBAND,INDIRECTION,1] = TEMP_ANGLES.VAA
    ENDFOR
  ENDFOR

<span class="comments">;--------------------------</span>
<span class="comments">; RETURN THE DATA</span>
  
  RETURN,COMPANG

END
</code>
    </div>
  </body>
</html>