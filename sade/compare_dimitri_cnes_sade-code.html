<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:51:06 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>compare_dimitri_cnes_sade.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="compare_dimitri_cnes_sade.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">PRO COMPARE_DIMITRI_CNES_SADE

<span class="comments">;SADE1 = '/mnt/Projects/MEREMSII/WG_Reference_Dataset_2/Libya4/Libya4_PARASOL_Calibration_1.SADE'</span>
<span class="comments">;SADE2 = '/mnt/Projects/MEREMSII/WG_Reference_Dataset/CNES/Libya4_CNES/Libya4_CNES/CNES_Libya4_PARASOL_Calibration_1.SADE'</span>
sensor = 'VEGETATION'

SADE1 = 'R:\MEREMSII\WG_Reference_Dataset\distributable_files\Libya4\Libya4_VEGETATION_Calibration_1.SADE'
SADE2 = 'R:\MEREMSII\WG_Reference_Dataset\CNES\Libya4_CNES\Libya4_CNES\CNES_Libya4_VEGETATION_Calibration_1.SADE'
<span class="comments">;sensor = 'VEGETATION'</span>

<span class="comments">;SADE1 = 'R:\MEREMSII\WG_Reference_Dataset\distributable_files\Libya4\Libya4_MERIS_2nd_Reprocessing.SADE'</span>
<span class="comments">;SADE2 = 'R:\MEREMSII\WG_Reference_Dataset\CNES\Libya4_CNES\Libya4_CNES\CNES_Libya4_MERIS_2nd_Reprocessing.SADE'</span>
<span class="comments">;sensor = 'MERIS'</span>

<span class="comments">;SADE1 = '/mnt/Projects/MEREMSII/WG_Reference_Dataset/distributable_files/Libya4/Libya4_MERIS_2nd_Reprocessing.SADE'</span>
<span class="comments">;SADE2 = '/mnt/Projects/MEREMSII/WG_Reference_Dataset/CNES/Libya4_CNES/Libya4_CNES/CNES_Libya4_MERIS_2nd_Reprocessing.SADE'</span>
<span class="comments">;sensor = 'MERIS'</span>

toaref1 = CONVERT_SADE_TO_DIMITRI(SADE1,SENSOR)
toaref2 = CONVERT_SADE_TO_DIMITRI(SADE2,SENSOR)

<span class="comments">;; try it with new dataset</span>
<span class="comments">;restore,'/mnt/Projects/MEREMSII/DIMITRI_2.0/Input/Site_Libya4/VEGETATION/Proc_Calibration_1/VEGETATION_TOA_REF.dat'</span>
<span class="comments">;restore,'R:\MEREMSII\DIMITRI_2.0\Input\Site_Libya4\VEGETATION\Proc_Calibration_1\VEGETATION_TOA_REF.dat'</span>
<span class="comments">;toaref1 = sensor_l1b_ref</span>
<span class="comments">;;</span>
<span class="comments">;res = where(toaref1[17,*] gt 0.0 and toaref1[21,*] lt 0.010)</span>
<span class="comments">;toaref1 = toaref1[*,res]</span>
<span class="comments">;---------------------------</span>

<span class="comments">;oplot,toaref1[0,*],toaref1[17,*] </span>
<span class="comments">;plot,toaref2[0,*],toaref2[17,*]</span>

<span class="comments">;find matching dates</span>
good_idx = make_array(/integer,n_elements(toaref1[0,*]))
good_idx2 = make_array(/integer,n_elements(toaref1[0,*]))

for ii=0,n_elements(toaref1[0,*])-1 do begin

res = where(abs(toaref2[0,*]-toaref1[0,ii]) lt 0.0004,count)
<span class="comments">;good_idx1</span>
if count eq 1 then good_idx[ii] = res
endfor

res = where(good_idx gt 0)
toaref1 = toaref1[*,res]
toaref2 = toaref2[*,good_idx[res]]
newref1 = toaref1

<span class="comments">;get diff in reflectance</span>
diffref = abs(toaref1[17,*]-toaref2[17,*])
rmd = make_array(n_elements(toaref1[17,*]),/float)
shiftrmd = make_array(n_elements(toaref1[17,*]),/float)
dua = make_array(n_elements(toaref1[17,*]),/float)
dayj= make_array(n_elements(toaref1[17,*]),/float)

mb= make_array(n_elements(toaref1[17,*]),/float)
dvito= make_array(n_elements(toaref1[17,*]),/float)

<span class="comments">;plot, diffref</span>

<span class="comments">;recalculate dimitri ref assuming d2 on denominator</span>
stop
for ii=0,n_elements(toaref1[0,*])-1 do begin
IF FLOAT(floor(toaref1[0,ii])) MOD 4 EQ 0 THEN DIY = 366.0 ELSE DIY = 365.0
doy = float(floor(diy*(toaref1[0,ii]-floor(toaref1[0,ii]))))
year = FLOAT(floor(toaref1[0,ii]))

<span class="comments">;shiftdoy = doy+fix(diy/2)</span>
<span class="comments">;if shiftdoy gt diy then shiftdoy=shiftdoy-diy</span>

<span class="comments">;m = 0.9856*(doy-4.)*!DPI/180.</span>
<span class="comments">;phase = 0.</span>
<span class="comments">;rmd[ii] = 1./(1-0.01673*cos(M))</span>

<span class="comments">;m = 0.9856*(doy-4.)*!DPI/180.</span>
<span class="comments">;phase = !DPI</span>
<span class="comments">;shiftrmd[ii] = 1./(1-0.01673*cos(M+phase))</span>

<span class="comments">;d = d^4;</span>
<span class="comments">;</span>
<span class="comments">;e = 0.00014</span>
<span class="comments">;a = 1+e</span>
<span class="comments">;b = 0.01671</span>
<span class="comments">;c = 0.9856002831</span>
<span class="comments">;capd = 3.4532868</span>
<span class="comments">;gamma = (c*doy)-capd</span>
<span class="comments">;rmd[ii] = 1./(A-B*cos(gamma*!DPI/180.)-e*cos(gamma*!DPI/90.))</span>
<span class="comments">;</span>
<span class="comments">;gammasft = (c*shiftdoy)-capd</span>
<span class="comments">;shiftrmd[ii] = 1./(A-B*cos(gammasft*!DPI/180.)-e*cos(gammasft*!DPI/90.))</span>

<span class="comments">;</span>
<span class="comments">;</span>
mb[ii] = (1.0+0.0167*cos(2.0*!DPI*(doy-3.0)/DIY))

<span class="comments">;newref1[17,ii] = newref1[17,ii]/((rmd^4));*(shiftrmd^2))</span>
<span class="comments">;newref1[17,ii] = newref1[17,ii]/(rmd^4);*cos(newref1[3,ii]*!DTOR))</span>
<span class="comments">;newref1[17,ii] = newref1[17,ii]/cos(newref1[3,ii]*!DTOR)</span>

<span class="comments">;vito d computation</span>
jd = 1+julday(1,1,year)-julday(1,1,1950)<span class="comments">;julian day since 1950</span>
t = jd-10000.
dayj[ii] = t
d = ((11.786+12.190749*t) mod 360.)*(!DPI/180.)
xlp = ((134.003+0.9856*t) mod 360.)*(!DPI/180.)
dua[ii] = 1. / (1.+(1672.2*cos(xlp)+28.*cos(2.*xlp)-0.35*cos(d))*1.e-5)
dvito[ii] = dua[ii]^2

endfor

device, decomposed=0
loadct,39


<span class="comments">;newref1[17,*] = newref1[17,*]/(mb^2)</span>
NEWREF1[18,*] = NEWREF1[18,*]/(DVITO*(mb^2))
plot,newref1[0,*],100.*(newref1[18,*]-toaref2[18,*])/toaref2[18,*],color=90
stop


<span class="comments">;plot,toaref1[0,*],shiftrmd</span>
<span class="comments">;oplot,toaref1[0,*],rmd</span>
<span class="comments">;plot,toaref1[0,*],rmd^2</span>
<span class="comments">;plot,toaref1[0,*],shiftrmd;*</span>
<span class="comments">;gain = abs((shiftrmd^2)-1.)+1.</span>
<span class="comments">;oplot,toaref1[0,*],shiftrmd^4</span>
<span class="comments">;plot,newref1[0,*],100.*(newref1[17,*]-toaref2[17,*])/toaref2[17,*],color=70,psym=5</span>
<span class="comments">;plot,toaref1[0,*],shiftrmd</span>

<span class="comments">;plot,toaref1[0,*],100.*(toaref1[17,*]-toaref2[17,*])/toaref2[17,*],/nodata,xtitle='Time',ytitle='100*(DIMITRI-CNES)/CNES',$</span>
<span class="comments">;title = 'DIMITRI/d^2_vs_CNES',background=255,color=0,yrange=[-4,2]</span>

b = 17
newref1[b,*] = newref1[b,*]*dua^2<span class="comments">;/rmd^2</span>

plot,toaref1[0,*],100.*(newref1[b,*]-toaref2[b,*])/toaref2[b,*],/nodata,xtitle='Time',ytitle='100*(DIMITRI-CNES)/CNES',$
title = 'DIMITRI/d^2_vs_CNES',background=255,color=0<span class="comments">;,yrange=[0.95,1.05]</span>
oplot,newref1[0,*],100.*(newref1[b,*]-toaref2[b,*])/toaref2[b,*],color=90

stop

b = 17
oplot,newref1[0,*],100.*(newref1[b,*]-toaref2[b,*])/toaref2[b,*],color=90
b = 18
oplot,newref1[0,*],100.*(newref1[b,*]-toaref2[b,*])/toaref2[b,*],color=120
b = 19
oplot,newref1[0,*],100.*(newref1[b,*]-toaref2[b,*])/toaref2[b,*],color=180
b = 20
oplot,newref1[0,*],100.*(newref1[b,*]-toaref2[b,*])/toaref2[b,*],color=220

<span class="comments">;d1 = 100.*((newref1[17,*]/(rmd^2))-toaref2[17,*])/toaref2[17,*]</span>
<span class="comments">;d2 = 100.*((newref1[18,*]/(rmd^2))-toaref2[18,*])/toaref2[18,*]</span>
<span class="comments">;oplot,newref1[0,*],d1-d2,color=220</span>
 stop
 
 
 
oplot,toaref1[0,*],100.*(toaref1[17,*]-toaref2[17,*])/toaref2[17,*]
plot,newref1[0,*],100.*(newref1[17,*]-toaref2[17,*])/toaref2[17,*],psym=2

stop
END
</code>
    </div>
  </body>
</html>