<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:51:06 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>remove_bad_sade.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="remove_bad_sade.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      REMOVE_BAD_SADE       </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      REMOVES THE ERRONEOUS DATA FROM THE SADE SENSOR FILES AND REMOVES QUICKLOOKS</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES =  REMOVE_BAD_SADE(SITE,SENSOR,PROC_VER,PRODFILE)    </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      SITE      - THE SITE NAME</span>
<span class="comments">;*      SENSOR    - THE SENSOR</span>
<span class="comments">;*      PROC_VER  - THE SENSORS PROCESSING VERSION</span>
<span class="comments">;*      PRODFILE  - THE FULL PATH OF THE PRODUCT FILE       </span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      A CLEANED SADE FILE</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      16 DEC 2011 - C KENT  - INITIAL DIMITRI VERSION</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

PRO REMOVE_BAD_SADE,SITE,SENSOR,PROC_VER,PRODFILE

  <span class="comments">;IFOL = '/mnt/Projects/MEREMSII/WG_Reference_Dataset_2/'</span>
  CASE STRUPCASE(!VERSION.OS_FAMILY) OF 
  'WINDOWS': IFOL = 'R:\MEREMSII\WG_Reference_Dataset\'
  'UNIX':    IFOL = '/mnt/Projects/MEREMSII/WG_Reference_Dataset/'
  ENDCASE
  DL = PATH_SEP()
  OUPUTFILE = IFOL+SITE+DL+SITE+'_'+SENSOR+'_'+PROC_VER+'_cleaned.SADE'

  CASE SENSOR OF
    'AATSR'       : NBANDS=7 
    'MERIS'       : NBANDS=15 
    'MODISA'      : NBANDS=10 
    'PARASOL'     : NBANDS=9 
    'VEGETATION'  : NBANDS=4 
  ENDCASE

<span class="comments">; READ IN SADE TXT</span>

  SADEFILE = IFOL+SITE+DL+SITE+'_'+SENSOR+'_'+PROC_VER+'.SADE'
  SADEDATA = READ_SADE_TXT(SADEFILE,SENSOR)

<span class="comments">; READ IN PRODFILE</span>

  PRODDATA = READ_SADE_PRODFILE_TEXT(PRODFILE)

<span class="comments">; CREATE AN ARRAY OF NUMBER ELEMENTS OF SADE TEXT</span>

  BADINDX = MAKE_ARRAY(N_ELEMENTS(SADEDATA.JPG),/INTEGER,VALUE=0)

<span class="comments">; LOOP OVER EACH PRODFILE PRODUCT</span>

  FOR II=0,N_ELEMENTS(PRODDATA.BADPROD)-1 DO BEGIN
  
<span class="comments">; FIND WHICH SADETEXT JPGS MATCH, SET THESE INDEICESES TO 1</span>
    
    RES = WHERE(SADEDATA.JPG EQ PRODDATA.BADPROD[II],COUNT)
    IF COUNT GT 0 THEN BEGIN
    BADINDX[RES] = 1
    FOR JJ=0,COUNT-1 DO BEGIN
      IF FILE_TEST(IFOL+SITE+DL+SENSOR+DL+SADEDATA.JPG[RES[JJ]]) THEN FILE_DELETE,IFOL+SITE+DL+SENSOR+DL+SADEDATA.JPG[RES[JJ]]
      ENDFOR
    ENDIF
  
  ENDFOR

<span class="comments">; PRINT OUT SADE DATA FROM INDICES OF 0 AND NOT JPG FILE INFO</span>
  
  OPENW,OUTF,OUPUTFILE,/GET_LUN
  FOR KK=0,N_ELEMENTS(SADEDATA.JPG)-1 DO BEGIN
    IF BADINDX[KK] THEN CONTINUE
    FOR IVAL = 0,3 DO BEGIN
      TEMP = 0.0
      FOR IBAND=0,NBANDS-1 DO TEMP = [TEMP,SADEDATA.(4+IBAND+IVAL*NBANDS)[KK]]
      TEMP = TEMP[1:NBANDS]
      CASE IVAL OF
        0 : TOA_REF = TEMP 
        1 : TOA_STD = TEMP
        2 : VZA = TEMP
        3 : VAA = TEMP
      ENDCASE
    ENDFOR
    IF TOA_REF[0] GT 1.0 THEN CONTINUE
    
    PRINTF,OUTF,STRING(SENSOR+'_'+PROC_VER),SADEDATA.ACQDATE[KK],SADEDATA.PROCDATE[KK],SITE,TOA_REF,TOA_STD,$
          VZA,VAA,SADEDATA.NPIXS[KK],SADEDATA.LAT[KK],SADEDATA.LON[KK],SADEDATA.SZA[KK],SADEDATA.SAA[KK],SADEDATA.WVAP[KK],SADEDATA.OZONE[KK],SADEDATA.PRESS[KK],SADEDATA.WIND[KK],$
          FORMAT = '(4(A,1H ),'+STRTRIM(FIX(4*NBANDS),2)+'(F11.6,1H ),1(I10,1H ),2(F10.3,1H ),5(F12.6,1H ),1(F12.6))'
  ENDFOR
  FREE_LUN,OUTF
  PRINT, 'FINISHED...'
END
</code>
    </div>
  </body>
</html>