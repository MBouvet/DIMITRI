<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:50:45 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dimitri_interface_doublet.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dimitri_interface_doublet.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      DIMITRI_INTERFACE_DOUBLET       </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      FORMS THE INTERFACE ROUTINE BETWEEN THE DIMITRI HMI AND THE DOUBLET </span>
<span class="comments">;*      EXTRACTION FUNCTION.</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = DIMITRI_INTERFACE_DOUBLET(OUTPUT_FOLDER,ED_REGION,SENSOR1,PROC_VER1,SENSOR2,$</span>
<span class="comments">;*                                      PROC_VER2,CHI_THRESHOLD,DAY_OFFSET,CLOUD_PERCENTAGE,$</span>
<span class="comments">;*                                      ROI_PERCENTAGE,VZA_MIN,VZA_MAX,VAA_MIN,VAA_MAX,SZA_MIN,$</span>
<span class="comments">;*					SZA_MAX,SAA_MIN,SAA_MAX)      </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      OUTPUT_FOLDER     - THE FULL PATH OF THE OUTPUT FOLDER  </span>
<span class="comments">;*      ED_REGION         - THE VALIDATION SITE NAME E.G. 'Uyuni'</span>
<span class="comments">;*      SENSOR1           - THE NAME OF THE 1ST SENSOR FOR DOUBLET EXTRACTION E.G. 'MERIS'</span>
<span class="comments">;*      PROC_VER1         - THE PROCESSING VERSION OF THE 1ST SENSOR E.G. '2nd_Processing'</span>
<span class="comments">;*      SENSOR2           - THE NAME OF THE 2ND SENSOR FOR DOUBLET EXTRACTION E.G. 'MODISA</span>
<span class="comments">;*      PROC_VER2         - THE PROCESSING VERSION OF THE 2ND SENSOR E.G. 'Collection_5'</span>
<span class="comments">;*      CHI_THRESHOLD     - THE CHI THRESHOLD VALUE AS RETURNED BY COMPUTE_CHI_THRESHOLD.PRO</span>
<span class="comments">;*      DAY_OFFSET        - THE NUMBER OF DAYS DIFFERENCE ALLOWED BETWEEN DOUBLETS E.G 2</span>
<span class="comments">;*      CLOUD_PERCENTAGE  - THE PERCENTAGE CLOUD COVER THRESHOLD ALLOWED WITHIN PRODUCTS E.G. 60.0 </span>
<span class="comments">;*      ROI_PERCENTAGE    - THE PERCENTAGE ROI COVERAGE ALLOWED WITHIN PRODUCTS E.G. 75.0     </span>
<span class="comments">;*      VZA_MIN           - THE MINIMUM VIEWING ZENITH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      VZA_MAX           - THE MAXIMUM VIEWING ZENITH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      VAA_MIN           - THE MINIMUM VIEWING AZIMUTH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      VAA_MAX           - THE MAXIMUM VIEWING AZIMUTH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      SZA_MIN           - THE MINIMUM SOLAR ZENITH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      SZA_MAX           - THE MAXIMUM SOLAR ZENITH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      SAA_MIN           - THE MINIMUM SOLAR AZIMUTH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      SAA_MAX           - THE MAXIMUM SOLAR AZIMTUH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      VERBOSE           - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      STATUS            - 1: NO ERRORS REPORTED, (-1) OR 0: ERRORS DURING INGESTION </span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*        18 JAN 2011 - C KENT    - DIMITRI-2 V1.0</span>
<span class="comments">;*        21 MAR 2011 - C KENT    - MODIFIED FILE DEFINITION TO USE GET_DIMITRI_LOCATION</span>
<span class="comments">;*        02 JUL 2011 - C KENT    - ADDED ABSOLUTE ANGULAR CRITERIA</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*        02 DEC 2010 - C KENT    - WINDOWS 32-BIT MACHINE IDL 8.0: COMPILATION SUCCESSFUL. </span>
<span class="comments">;*                                  RESULTS NOMINAL FOR AATSR VS ATSR2 OVER UYUNI IN 2003.</span>
<span class="comments">;*        13 APR 2011 - C KENT    - LINUX 64-BIT MACHINE IDL 8.0: COMPILATION AND OPERATION </span>
<span class="comments">;*                                  NOMINAL</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION DIMITRI_INTERFACE_DOUBLET,OUTPUT_FOLDER,ED_REGION,SENSOR1,PROC_VER1,SENSOR2,PROC_VER2,CHI_THRESHOLD,$
                                   DAY_OFFSET,CLOUD_PERCENTAGE,ROI_PERCENTAGE,                               $
                                   VZA_MIN,VZA_MAX,VAA_MIN,VAA_MAX,SZA_MIN,SZA_MAX,SAA_MIN,SAA_MAX,          $
                                   VERBOSE=VERBOSE

<span class="comments">;--------------------------------</span>
<span class="comments">; COMPUTE DIMITRI DIRECTORY</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI INTERFACE DOUBLET: STARTING DOUBLET EXTRACTION'

<span class="comments">;--------------------------------</span>
<span class="comments">; DEFINE MAIN DIRECTORY, REGION, </span>
<span class="comments">; SENSOR1 AND SENSOR2 FOLDERS  </span>

  DL            = GET_DIMITRI_LOCATION('DL')
  INPUT_FOLDER  = GET_DIMITRI_LOCATION('INPUT')
  RFOLDER       = INPUT_FOLDER+'Site_'+ED_REGION
  S1_FOLDER     = STRING(RFOLDER+DL+SENSOR1+DL+'Proc_'+PROC_VER1)
  S2_FOLDER     = STRING(RFOLDER+DL+SENSOR2+DL+'Proc_'+PROC_VER2)

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI INTERFACE DOUBLET: SENSOR1 FOLDER = ',S1_FOLDER
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI INTERFACE DOUBLET: SENSOR2 FOLDER = ',S2_FOLDER

<span class="comments">;--------------------------------</span>
<span class="comments">; CREATE OUTPUT FOLDER IF IT DOESN'T EXIST</span>

  RES = FILE_INFO(OUTPUT_FOLDER)
  IF RES.EXISTS NE 1 OR RES.DIRECTORY NE 1 THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT,"DIMITRI INTERFACE DOUBLET: OUTPUT FOLDER DOESN'T EXIST, CREATING"
    FILE_MKDIR,OUTPUT_FOLDER 
  ENDIF
  
<span class="comments">;--------------------------------</span>
<span class="comments">; CHANGE OUTPUT_FOLDER TO OFOLDER</span>
  
  RES = STRMID(OUTPUT_FOLDER,STRLEN(OUTPUT_FOLDER)-1,1)
  IF STRCMP(RES,DL) EQ 0 THEN OFOLDER = STRING(OUTPUT_FOLDER+DL) ELSE OFOLDER = OUTPUT_FOLDER

<span class="comments">;--------------------------------</span>
<span class="comments">; CHECK REGION IS A DIMITRI VALIDATION </span>
<span class="comments">; SITE AND SENSOR INFORMATION IS CORRECT</span>

  RES1 = FILE_INFO(RFOLDER)
  RES2 = FILE_INFO(S1_FOLDER)
  RES3 = FILE_INFO(S2_FOLDER)
  IF  RES1.EXISTS EQ 0 OR $
      RES2.EXISTS EQ 0 OR $
      RES3.EXISTS EQ 0 THEN BEGIN
      PRINT, 'DIMITRI INTERFACE DOUBLET: ERROR, REGION AND SENSOR CONFIGURATION INCORRECT' 
      RETURN,-1
  ENDIF
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI INTERFACE DOUBLET: REGION AND SENSOR DATA VALID'

<span class="comments">;--------------------------------</span>
<span class="comments">; CHECK USER PARAMETERS ARE VALID</span>

  CHI_THRESHOLD     = FLOAT(CHI_THRESHOLD)
  DAY_OFFSET        = FIX(DAY_OFFSET)
  CLOUD_PERCENTAGE  = CLOUD_PERCENTAGE>0.0
  CLOUD_PERCENTAGE  = CLOUD_PERCENTAGE&lt<span class="comments">;100.0</span>
  ROI_PERCENTAGE    = ROI_PERCENTAGE>0.0
  ROI_PERCENTAGE    = ROI_PERCENTAGE&lt<span class="comments">;100.0</span>
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI INTERFACE DOUBLET: USER PARAMETERS APPEAR VALID'

<span class="comments">;--------------------------------  </span>
<span class="comments">; CALL EXTRACT DOUBLET FUNCTION</span>
  
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI INTERFACE DOUBLET: CALLING DOUBLET EXTRACTION ROUTINE'
  RES = EXTRACT_DOUBLETS(OFOLDER,ED_REGION,SENSOR1,PROC_VER1,SENSOR2,PROC_VER2,CHI_THRESHOLD, $
                         DAY_OFFSET,CLOUD_PERCENTAGE,ROI_PERCENTAGE,                          $
                         VZA_MIN,VZA_MAX,VAA_MIN,VAA_MAX,SZA_MIN,SZA_MAX,SAA_MIN,SAA_MAX,VERBOSE=VERBOSE)

<span class="comments">;--------------------------------  </span>
<span class="comments">; CHECK RETURN PARAMETER</span>
  
  IF RES NE 1 THEN BEGIN
    PRINT, 'DIMITRI INTERFACE DOUBLET: ERROR OCCURED DURING DOUBLET EXTRACTION'
    RETURN,-1
  ENDIF ELSE BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI INTERFACE DOUBLET: DOUBLET EXTRACTION SUCCESSFUL'
    RETURN,1
  ENDELSE

END
</code>
    </div>
  </body>
</html>