<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:51:03 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>update_dimitri_extract_toa_ncdf.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="update_dimitri_extract_toa_ncdf.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      UPDATE_DIMITRI_EXTRACT_TOA_NCDF   </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      THIS FUNCTION OVERWRITES ANY NETCDF VARIABLE WITHIN THE EXTRACTED SENSOR TOA </span>
<span class="comments">;*      TIME SERIES NETCDF FILES, GIVEN THE NEW DATA AND THE VARIABLE NAME</span>
<span class="comments">;*</span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = UPDATE_DIMITRI_EXTRACT_TOA_NCDF(NSITE,NSENSOR,NPROCV,VARNAME,VARDATA)</span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      NSITE   - A STRING SCALAR OF THE VALIDATION SITE</span>
<span class="comments">;*      NSENSOR - A STRING SCALAR OF THE SENSOR </span>
<span class="comments">;*      NPROCV  - A STRING SENSOR OF THE PROCESSING VERSION</span>
<span class="comments">;*      VARNAME - A STRING SCALAR OF THE VARIABLE NAME TO BE OVERWRITTEN</span>
<span class="comments">;*      VARDATA - AN ARRAY UPDATED DATA TO BE USED TO OVERWRITE DATA WITHIN VARNAME</span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      VERBOSE   - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      STATUS    - 0 IS NOMINAL, NEGATIVE INDICATES SOME KIND OF ERROR ENCOUNTERED</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      30 AUG 2011 - C KENT   - DIMITRI-2 V1.0</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      </span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION UPDATE_DIMITRI_EXTRACT_TOA_NCDF,NSITE,NSENSOR,NPROCV,VARNAME,VARDATA,VERBOSE=VERBOSE

<span class="comments">;---------------------------------</span>
<span class="comments">; DEFINE THE TOA NETCDF FILENAME</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'UPDATE_DIMITRI_EXTRACT_TOA_NCDF: DEFINING NETCDF FILENAME'
  IFOLDER   = GET_DIMITRI_LOCATION('INPUT')
  DL        = GET_DIMITRI_LOCATION('DL')
  NCDF_FILE = IFOLDER+DL+'Site_'+nSITE+DL+nSENSOR+DL+'Proc_'+nPROCV+DL+nSITE+'_'+nSENSOR+'_Proc_'+nPROCV+'.nc'

<span class="comments">;---------------------------------</span>
<span class="comments">; CHECK THAT THE NCDF FILE EXISTS</span>

  IF NOT FILE_TEST(NCDF_FILE) THEN BEGIN
    PRINT,"UPDATE_DIMITRI_EXTRACT_TOA_NCDF: ERROR, INPUT NCDF DOESN'T EXIST"
    RETURN,-1
  ENDIF

<span class="comments">;---------------------------------</span>
<span class="comments">; OPEN THE NETCDF FILE</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'UPDATE_DIMITRI_EXTRACT_TOA_NCDF: OPENING THE NETCDF FILE'  
  NCID = NCDF_OPEN(NCDF_FILE,/WRITE)

<span class="comments">;---------------------------------</span>
<span class="comments">; GET ID OF THE REQUIRED VARIABLE FOR CHANGING</span>
  
  VID = NCDF_VARID(NCID,VARNAME) 
  IF VID LT 0 THEN BEGIN
    PRINT,"UPDATE_DIMITRI_EXTRACT_TOA_NCDF: ERROR, VARIABLE DOESN'T EXIST"
    RETURN,-2
  ENDIF

<span class="comments">;---------------------------------</span>
<span class="comments">; GET DATA FROM THE VARIABLE TO BE CHANGED</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'UPDATE_DIMITRI_EXTRACT_TOA_NCDF: RETRIEVEING DATA FROM NETCDF'  
  NCDF_VARGET, NCID, VID, OLDVAL 

<span class="comments">;---------------------------------</span>
<span class="comments">; MAKE SURE NEW DATA IS SAME SIZE AS OLD DATA</span>

  IF N_ELEMENTS(OLDVAL) NE N_ELEMENTS(VARDATA) THEN BEGIN
    PRINT,'UPDATE_DIMITRI_EXTRACT_TOA_NCDF: ERROR, ARRAYS ARE OF DIFFERENT SIZES, CANNOT OVERWRITE'
    RETURN,-3
  ENDIF

<span class="comments">;---------------------------------</span>
<span class="comments">; WRITE NEW DATA TO VARIABLE AND CHANGE MODIFICATION DATE ATTRIBUTE</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'UPDATE_DIMITRI_EXTRACT_TOA_NCDF: OVERWRITING OLD VARIABLE'  
  NCDF_VARPUT, NCID,VID,VARDATA,OFFSET=0 

  CALDAT, SYSTIME(/UTC,/JULIAN),TMM,TDD,TYY,THR,TMN,TSS
  TYY = STRTRIM(STRING(TYY),2)
  TMM = TMM LT 10 ? '0'+STRTRIM(STRING(TMM),2) : STRTRIM(STRING(TMM),2)
  TDD = TDD LT 10 ? '0'+STRTRIM(STRING(TDD),2) : STRTRIM(STRING(TDD),2)
  THR = THR LT 10 ? '0'+STRTRIM(STRING(THR),2) : STRTRIM(STRING(THR),2)
  TMN = TMN LT 10 ? '0'+STRTRIM(STRING(TMN),2) : STRTRIM(STRING(TMN),2)
  TSS = TSS LT 10 ? '0'+STRTRIM(STRING(TSS,FORMAT='(I)'),2) : STRTRIM(STRING(TSS,FORMAT='(I)'),2)
  MDATE = TYY+TMM+TDD+' '+THR+':'+TMN+':'+TSS
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'UPDATE_DIMITRI_EXTRACT_TOA_NCDF: OVERWRITING MODIFICATION DATE/TIME'
  NCDF_ATTPUT,NCID , 'modification_time' , MDATE,/GLOBAL 

<span class="comments">;---------------------------------</span>
<span class="comments">; CLOSE THE NCDF FILE</span>

  NCDF_CLOSE,NCID

<span class="comments">;---------------------------------  </span>
<span class="comments">; RETURN NOMINAL OUTPUT</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'UPDATE_DIMITRI_EXTRACT_TOA_NCDF: UPDATE SUCCESSFUL'
  RETURN,0
  
end
</code>
    </div>
  </body>
</html>