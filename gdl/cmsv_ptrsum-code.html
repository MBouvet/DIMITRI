<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:32 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cmsv_ptrsum.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cmsv_ptrsum.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;   CMSV_PTRSUM</span>
<span class="comments">;</span>
<span class="comments">; AUTHOR:</span>
<span class="comments">;   Craig B. Markwardt, NASA/GSFC Code 662, Greenbelt, MD 20770</span>
<span class="comments">;   craigm@lheamail.gsfc.nasa.gov</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;   Construct an inventory of heap data accessible to a variable</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;   CMSV_PTRSUM, VAR, LIST</span>
<span class="comments">;   </span>
<span class="comments">; DESCRIPTION: </span>
<span class="comments">;</span>
<span class="comments">;   This procedure constructs an inventory of heap data that is</span>
<span class="comments">;   accessible to a single variable.  It searches all array elements,</span>
<span class="comments">;   recursively through structure tags, and by dereferencing pointers.</span>
<span class="comments">;   Users can use this procedure to determine all heap variables that</span>
<span class="comments">;   need to be saved to disk.</span>
<span class="comments">;</span>
<span class="comments">;   This procedure is part of the CMSVLIB SAVE library for IDL by</span>
<span class="comments">;   Craig Markwardt. </span>
<span class="comments">;</span>
<span class="comments">; ==================================================================</span>
<span class="comments">;   Research Systems, Inc. has issued a separate license intended</span>
<span class="comments">;   to resolve any potential conflict between this software and the</span>
<span class="comments">;   IDL End User License Agreement. The text of that license</span>
<span class="comments">;   can be found in the file LICENSE.RSI, included with this</span>
<span class="comments">;   software library.</span>
<span class="comments">; ==================================================================</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;</span>
<span class="comments">;   VAR - the variable to be examined</span>
<span class="comments">;</span>
<span class="comments">;   LIST - upon output, an array of pointers, each of which points to</span>
<span class="comments">;          a heap variable accessible to VAR.  If there are no heap</span>
<span class="comments">;          data pointed to by VAR, then LIST returns a NULL value.</span>
<span class="comments">;</span>
<span class="comments">; KEYWORDS:</span>
<span class="comments">;</span>
<span class="comments">;   NULL - if set, return the null value in LIST instead of the</span>
<span class="comments">;          pointer list.  VAR is ignored.</span>
<span class="comments">;</span>
<span class="comments">;   HAS_OBJECTS - upon return, the value is 1 if VAR contains or</span>
<span class="comments">;                 points to an object reference, and 0 if not.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLE:</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; SEE ALSO:</span>
<span class="comments">;</span>
<span class="comments">;   CMRESTORE, SAVE, RESTORE, CMSVLIB</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;   Written, 2000</span>
<span class="comments">;   Documented, 24 Jan 2001</span>
<span class="comments">;   Make version checks with correct precision, 19 Jul 2001, CM</span>
<span class="comments">;   Added notification about RSI License, 13 May 2002, CM</span>
<span class="comments">;</span>
<span class="comments">; $Id: cmsv_ptrsum.pro,v 1.7 2002/05/13 06:41:10 craigm Exp $</span>
<span class="comments">;</span>
<span class="comments">;-</span>
<span class="comments">; Copyright (C) 2000-2001, Craig Markwardt</span>
<span class="comments">; This software is provided as is without any warranty whatsoever.</span>
<span class="comments">; Permission to use, copy, modify, and distribute modified or</span>
<span class="comments">; unmodified copies is granted, provided this copyright and disclaimer</span>
<span class="comments">; are included unchanged.</span>
<span class="comments">;-</span>
<a id="cmsv_ptrsum:source"></a>pro cmsv_ptrsum, data, result, null=null0, has_objects=hobj

  forward_function ptr_new
  common cmsv_ptrsum_data, version, null

  if n_elements(version) EQ 0 then version = double(!version.release)
  if version LT 5D then begin
      result = 0L
      return
  endif
  if n_elements(null) EQ 0 then null = ptr_new()
  if keyword_set(null0) then begin
      data = null
      return
  endif

  pd = null
  sz = size(data)
  tp = sz(sz(0)+1)
  if tp EQ 8 then begin
      for i = 0L, n_tags(data(0))-1 do begin
          cmsv_ptrsum, data.(i), x, has_objects=hobj
          sz = size(data.(i))
          if sz(sz(0)+1) EQ 11 then hobj = 1
          if n_elements(x) GT 1 then pd = [pd, x] $
          else if x(0) NE null then pd = [pd, x]
      endfor
  endif else if tp EQ 10 then begin
      pd = [pd, data(*)]
      for i = 0, n_elements(data)-1 do begin
          wh = where(data(i) EQ pd, ct)
          if ct EQ 0 then begin   <span class="comments">;; Prevent cycles!!!</span>
              cmsv_ptrsum, *(data(i)), x
              sz = size(*(data(i)))
              if sz(sz(0)+1) EQ 11 then hobj = 1
              if n_elements(x) GT 1 then pd = [pd, x] $
              else if x(0) NE null then pd = [pd, x]
          endif
      endfor
  endif
  if n_elements(pd) GT 1 then pd = pd(uniq(pd, sort(pd)))

  result = pd
  return
end

</code>
    </div>
  </body>
</html>