<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:32 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>cmsv_rdata.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    

    <script type="text/javascript" src="../idldoc-resources/js/jquery.js"></script>
    <script type="text/javascript" src="../idldoc-resources/js/copybutton.js"></script>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="cmsv_rdata.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">

    <div class="header">
      <h1>Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/</h1>
      <h2>Generated by IDLdoc</h2>
    </div>
    
    
    <table class="navbar smaller" summary="Navigation header" cellspacing="0">
      <tr>
        <td >
          <a href="../overview.html">Overview</a>
        </td>
    
        <td >
          Directory
        </td>
    
        <td class="selected">File</td>
    
        
        <td >
          <a href="cmsv_rdata-code.html" title="Chromocoded source">Source</a> <a href="cmsv_rdata.pro" title=".pro file"><img src="../idldoc-resources/attach.png" alt="[attach.png]" align="top"/></a>
        </td>
        
    
        <td >Etc</td>
    
        <td >
        	<a href="../categories.html">Categories</a>
        </td>
    
        <td >
        	<a href="../search.html">Search</a>
        </td>
    
        
        <td >
          <a href="../idldoc-index.html">Index</a>
        </td>
        
    
        
        <td >
          <a href="../idldoc-warnings.html">Warnings</a>
        </td>
        
    
        <td >
          <a href="../idldoc-help.html">Help</a>
        </td>
    
        <td class="flexible">
          Developer documentation
        </td>
      </tr>
    </table>
    
    
    
    <p class="localnavbar smallest"><a href="" target="_top">single page</a> | <a href="../index.html" target="_top">use frames</a> &nbsp;&nbsp;&nbsp; summary &nbsp;&nbsp;&nbsp; class &nbsp;&nbsp;&nbsp; fields &nbsp;&nbsp;&nbsp; <a href="#routine-details">routine details</a> &nbsp;&nbsp;&nbsp; <a href="#attributes">file attributes</a></p>
    
    
    
    
    
    
    
    
    

    <div class="content">
      <h2 class="directory">gdl/</h2>
      <h1 class="basename">cmsv_rdata.pro<span class="file-attributes"></span></h1>
      

      
      
      
      <br/>

      
      <div id="file_comments">
        <div class="small "><p> NAME:
   CMSV_RDATA
</p>

<p> AUTHOR:
   Craig B. Markwardt, NASA/GSFC Code 662, Greenbelt, MD 20770
   craigm@lheamail.gsfc.nasa.gov
</p>

<p> PURPOSE:
   Read SAVE-formatted data variable record from input block or file unit
</p>

<p> CALLING SEQUENCE:
   CMSV_RDATA, BLOCK, POINTER, SIZE, DATA, UNIT=UNIT, $
          TEMPLATE=TEMPLATE, /TEMPORARY, PTR_INDEX=PTR_INDEX, $
          PTR_CALLBACK=PTR_CALLBACK, PTR_OFFSETS=PTR_OFFSETS, $
          OFFSET=OFFSET, STATUS=STATUS, ERRMSG=ERRMSG
</p>

<p> DESCRIPTION:
</p>

<p>   CMSV_RDATA reads the data portion of an IDL SAVE variable record.
   An IDL variable is stored in two components: the type descriptor
   which describes the name, type, and dimensions of the variable;
   and the data record, which contains the raw data of the variable.
   This procedure reads the raw data and returns it to the user.  The
   initial type portion of the record must have already been read
   using the CMSV_RVTYPE procedure.
</p>

<p>   CMSV_RDATA supports the following variable types:
</p>

<p>     BYTE(1),INT(2),LONG(3) - integer types
     UINT(12),ULONG(13),LONG64(14),ULONG64(15) - integer types (IDL &gt;5.2 only)
     FLOAT(4),DOUBLE(5),COMPLEX(6),DCOMPLEX(9) - float types
     STRING(7) - string type
     STRUCT(8) - structure type
     POINTER(10) - pointer type - SEE BELOW
     NOT SUPPORTED - OBJ(11) - object reference type - NOT SUPPORTED
</p>

<p>   Arrays and structures containing any of the supported types are
   supported (including structures within structures).
</p>

<p>   For scalars and arrays of numeric or string types, the caller must
   only supply the SIZE parameter, which specifies the type and
   dimensions of the variable to be read.  This information can be
   obtained from the CMSV_RVTYPE routine. The data is returned in the
   output parameter DATA.
</p>

<p>   For structure data, in addition to specifying the SIZE array, the
   user must also supply a "template" describing the structure into
   which the data will be read.  This template is simply a "blank"
   form of the data structure, and is returned by CMSV_RVTYPE.
</p>

<p>   Thus, a simple way to read structure, numeric or string data is
   the following code (with error checking removed)
</p>

<p>     CMSV_RVTYPE, block, pointer, name, size, template=template, unit=unit
     CMSV_RDATA, block, pointer, size, data, template=template, unit=unit
</p>

<p>   [ This code assumes the record header has been read with
   CMSV_RREC. ]
</p>

<p> ==================================================================
   Research Systems, Inc. has issued a separate license intended
   to resolve any potential conflict between this software and the
   IDL End User License Agreement. The text of that license
   can be found in the file LICENSE.RSI, included with this
   software library.
 ==================================================================
</p>

<p> POINTER DATA
</p>

<p>   Pointer data stored in IDL SAVE files are particularly difficult
   to manage, because the actual heap variables are stored in
   separate records which *precede* the record of interest.  Thus, if
   your application requires the reading of pointer data, you must
   perform special processing in your own code in order to support
   it.  In essence, you must maintain an inventory of heap variables
   as they are encountered in the file.
</p>

<p>   If these procedures are not followed then pointer data will not be
   read, and a LONG integer value appears in the pointers' places.
   Under IDL 4, pointer data can never be read.
</p>

<p>   This is accomplished by placing some additional logic in your file
   processing loop.  There are four separate components to this: (1)
   loop initialization; (2) reading a HEAP_INDEX record; (3) parsing
   a HEAP_DATA record; and (4) passing extra arguments to CMSV_RDATA.
   The additional state information is maintained in two variables
   named PTR_INDEX, which keeps track of the heap variable numbers,
   and PTR_OFFSETS, which stores the file location of each variable.
</p>

<p>   (1) Loop initialization: is quite simple, use the following code:
       ptr_index   = [0L]
       ptr_offsets = [0L]
       ptr_data    = [ptr_new()]
</p>

<p>   (2) Reading HEAP_INDEX, which is an array of values indicating
       the heap variable numbers of each heap variables.  These
       values are stored in PTR_INDEX:
</p>

<p>          CMSV_RHEAP, block, pointer, index, unit=unit
          ptr_index   = [ptr_index, index]
          ptr_offsets = [ptr_offsets, lonarr(n_elements(index))]
          ptr_data    = [ptr_data, ptrarr(n_elements(index))]
</p>

<p>   (3) Parse the HEAP_DATA record.  Here were are interested in the
       heap variable number, and the file offset.
</p>

<p>       opointer = pointer
       CMSV_RVTYPE, block, pointer, vindex, /heap, unit=unit
</p>

<p>       vindex = floor(vindex(0))
       wh = where(ptr_index EQ vindex)
       ptr_offsets(wh(0)) = offset + opointer
</p>

<p>       Keep in mind that the file offset is OFFSET+POINTER.
</p>

<p>   (4) Pass extra parameters to CMSV_RDATA.  The user simply passes
       these extra variables to the CMSV_RDATA procedure, which
       automatically recognizes heap data and reads it from the
       appropriate location.
</p>

<p>       CMSV_RVTYPE, block, pointer, name, size, unit=unit, template=tp
       CMSV_RDATA, block, pointer, size, data, template=tp, $
         unit=unit, ptr_offsets=ptr_offsets, $
         ptr_index=ptr_index, ptr_data=ptr_data
</p>

<p>   If this technique is used properly, only those heap variables
   which are needed are read.  Thus, there are never any lost or
   dangling pointers.  Since each bit of heap data is stored in a
   variable returned to the user, it is not necessary to
   PTR_FREE(ptr_data); in fact, doing so would corrupt the input
   data.
</p>

<p> BLOCK, POINTER, OFFSET
</p>

<p>   This procedure can read data from a byte array, a file unit, or
   both.  In fact, this procedure is designed to implement "lazy"
   reading from a file, which is to say, it normally reads from a
   byte array of data.  However, if the requested data goes beyond
   the end of the byte array, more data is read from the file on
   demand.  This way the user gets the benefit of fast memory access
   for small reads, but guaranteed file access for large reads.
</p>

<p>   The terminology is as follows: BLOCK is a byte array which
   represents a portion of, or an entire, IDL SAVE file.  The block
   may be a cached portion of an on-disk file, or an entire in-memory
   SAVE file.  POINTER is the current file pointer within BLOCK
   (i.e., the next byte to be read is BLOCK[POINTER]).  Hence, a
   POINTER value of 0 refers to the start of the block.  OFFSET is
   the file offset of the 0th byte of BLOCK; thus "POINT_LUN,
   OFFSET+POINTER" should point to the same byte as BLOCK[POINTER].
   The following diagram shows the meanings for BLOCK, POINTER and
   OFFSET schematically:
</p>

<p>                 0 &lt;-  OFFSET  -&gt; |
   FILE          |----------------|------*--------|---------&gt;
</p>

<p>   BLOCK                          |------*--------|
                                  0      ^ POINTER
</p>

<p>   This procedure is part of the CMSVLIB SAVE library for IDL by
   Craig Markwardt.  You must have the full CMSVLIB core package
   installed in order for this procedure to function properly.
</p>

<p> INPUTS:
</p>

<p>   BLOCK - a byte array, a cache of the SAVE file.  Users will
           usually not access this array directly.  Users are advised
           to clear BLOCK after calling POINT_LUN.
</p>

<p>   POINTER - a long integer, a pointer to the next byte to be read
             from BLOCK.  CMSVLIB routines will automatically
             advance the pointer.
</p>

<p>   SIZE - an array of integers describing the type and dimensions of
          the variable to be read, in the format returned by the
          SIZE() routine.  This parameter is required.
</p>

<p>   DATA - upon output, the data variable.  If any heap data is read,
          the user is ultimately responsible for freeing it.
</p>

<p> KEYWORDS:
</p>

<p>   UNIT - a file unit.  If a library routine reads to the end of
          BLOCK, or if BLOCK is undefined, then this file UNIT will
          be accessed for more data.  If undefined, then BLOCK must
          contain the entire file in memory.
</p>

<p>   TEMPLATE - for structure data (data type 8), a "blank" structure
              containing the fields and data values to be read in.
              This structure is returned by CMSV_RVTYPE.
              This keyword is mandatory for structure data.
</p>

<p>   TEMPORARY - if set, BLOCK becomes undefined upon return.
</p>

<p>   PTR_OFFSETS - array of file offsets, as described above.  Default:
                 pointer data is converted to an integer.
</p>

<p>   PTR_INDEX - array of heap variable indices, as described above.
               Default:  pointer data is converted to an integer.
</p>

<p>   PTR_DATA - array of pointers, as described above.
               Default:  pointer data is converted to an integer.
</p>

<p>   OFFSET - the file offset of byte zero of BLOCK.  Default: 0
            (OFFSET is used by this routine)
</p>

<p>   STATUS - upon return, this keyword will contain 1 for success and
            0 for failure.
</p>

<p>   ERRMSG - upon return with a failure, this keyword will contain the
            error condition as a string.
</p>

<p> EXAMPLE:
</p>

<p> SEE ALSO:
</p>

<p>   CMRESTORE, SAVE, RESTORE, CMSVLIB
</p>

<p> MODIFICATION HISTORY:
   Written, 2000
   Documented, 24 Jan 2001
   Added UNDEFINED data type for IDL &gt;5.3, CM, 21 Apr 2001
   Fixed bug for pointers within structures, CM, 21 Apr 2001
   Add support for IDL 4 byte-compiled strings, CM, 22 Apr 2001
   Make version checks with correct precision, 19 Jul 2001, CM
   Added notification about RSI License, 13 May 2002, CM
   Clarify and speed some of the code, 22 Nov 2009, CM
   NOTE: remember to modify CMSVLIB.PRO when changing library!
</p>

<p> $Id: cmsv_rdata.pro,v 1.11 2009/11/22 23:04:43 craigm Exp $
</p>

<p></p>

</div>
      </div>
      

      

      

      

      

      
      <div>
        <h2>Routines</h2>

        <dl class="routine-summary">
          
            <dt class="syntax"><a href="#cmsv_rconv"><code>cmsv_rconv<span class="argument">, data</span></code></a></dt>
            <dd class="small"></dd>
          
            <dt class="syntax"><a href="#cmsv_rhdata"><code>cmsv_rhdata<span class="argument">, block</span><span class="argument">, pointer</span><span class="argument">, data</span><span class="argument">, index</span><span class="argument">, offsets</span><span class="argument">, pdata</span><span class="argument">, unit=<span class="var">unit</span></span><span class="argument">, offset=<span class="var">offset</span></span><span class="argument">, status=<span class="var">status</span></span><span class="argument">, errmsg=<span class="var">errmsg</span></span></code></a></dt>
            <dd class="small"></dd>
          
            <dt class="syntax"><a href="#cmsv_rdata"><code>cmsv_rdata<span class="argument">, block</span><span class="argument">, pointer</span><span class="argument">, sz</span><span class="argument">, data</span><span class="argument">, offset=<span class="var">offset</span></span><span class="argument">, unit=<span class="var">unit</span></span><span class="argument">, template=<span class="var">template</span></span><span class="argument">, status=<span class="var">status</span></span><span class="argument">, errmsg=<span class="var">errmsg</span></span><span class="argument">, start=<span class="var">start</span></span><span class="argument">, temporary=<span class="var">temporary</span></span><span class="argument">, bytelong=<span class="var">bytelong</span></span><span class="argument">, bcstring40=<span class="var">bcstring40</span></span><span class="argument">, ptr_offsets=<span class="var">ptr_offsets</span></span><span class="argument">, ptr_callback=<span class="var">ptr_callback</span></span><span class="argument">, ptr_index=<span class="var">ptr_index</span></span><span class="argument">, ptr_data=<span class="var">ptr_data</span></span></code></a></dt>
            <dd class="small"></dd>
          
        </dl>
      </div>
      


      
      <div id="routine-details">
        <h2>Routine details</h2>

        
        <div class="routine-details details" id="cmsv_rconv">
          <h2 class="routine-name"><a href="#root" class="top">top</a> <a href="cmsv_rdata-code.html#cmsv_rconv:source" class="top">source</a> cmsv_rconv<span class="routine-attributes"></span></h2>

          

          <p class="syntax"><code>cmsv_rconv<span class="argument">, <a href="#cmsv_rconv:p:data">data</a></span></code></p>

          

          

          
          <h3>Parameters</h3>
            <dl>
              
              <dt id="cmsv_rconv:p:data">data <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
            </dl>
          

          

          

          

          

          

        </div>
        
        <div class="routine-details details" id="cmsv_rhdata">
          <h2 class="routine-name"><a href="#root" class="top">top</a> <a href="cmsv_rdata-code.html#cmsv_rhdata:source" class="top">source</a> cmsv_rhdata<span class="routine-attributes"></span></h2>

          

          <p class="syntax"><code>cmsv_rhdata<span class="argument">, <a href="#cmsv_rhdata:p:block">block</a></span><span class="argument">, <a href="#cmsv_rhdata:p:pointer">pointer</a></span><span class="argument">, <a href="#cmsv_rhdata:p:data">data</a></span><span class="argument">, <a href="#cmsv_rhdata:p:index">index</a></span><span class="argument">, <a href="#cmsv_rhdata:p:offsets">offsets</a></span><span class="argument">, <a href="#cmsv_rhdata:p:pdata">pdata</a></span><span class="argument">, <a href="#cmsv_rhdata:k:unit">unit</a>=<span class="var">unit</span></span><span class="argument">, <a href="#cmsv_rhdata:k:offset">offset</a>=<span class="var">offset</span></span><span class="argument">, <a href="#cmsv_rhdata:k:status">status</a>=<span class="var">status</span></span><span class="argument">, <a href="#cmsv_rhdata:k:errmsg">errmsg</a>=<span class="var">errmsg</span></span></code></p>

          

          

          
          <h3>Parameters</h3>
            <dl>
              
              <dt id="cmsv_rhdata:p:block">block <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rhdata:p:pointer">pointer <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rhdata:p:data">data <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rhdata:p:index">index <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rhdata:p:offsets">offsets <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rhdata:p:pdata">pdata <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
            </dl>
          

          
          <h3>Keywords</h3>
            <dl>
              
              <dt id="cmsv_rhdata:k:unit">unit <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rhdata:k:offset">offset <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rhdata:k:status">status <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rhdata:k:errmsg">errmsg <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
            </dl>
          

          

          

          

          

        </div>
        
        <div class="routine-details details" id="cmsv_rdata">
          <h2 class="routine-name"><a href="#root" class="top">top</a> <a href="cmsv_rdata-code.html#cmsv_rdata:source" class="top">source</a> cmsv_rdata<span class="routine-attributes"></span></h2>

          

          <p class="syntax"><code>cmsv_rdata<span class="argument">, <a href="#cmsv_rdata:p:block">block</a></span><span class="argument">, <a href="#cmsv_rdata:p:pointer">pointer</a></span><span class="argument">, <a href="#cmsv_rdata:p:sz">sz</a></span><span class="argument">, <a href="#cmsv_rdata:p:data">data</a></span><span class="argument">, <a href="#cmsv_rdata:k:offset">offset</a>=<span class="var">offset</span></span><span class="argument">, <a href="#cmsv_rdata:k:unit">unit</a>=<span class="var">unit</span></span><span class="argument">, <a href="#cmsv_rdata:k:template">template</a>=<span class="var">template</span></span><span class="argument">, <a href="#cmsv_rdata:k:status">status</a>=<span class="var">status</span></span><span class="argument">, <a href="#cmsv_rdata:k:errmsg">errmsg</a>=<span class="var">errmsg</span></span><span class="argument">, <a href="#cmsv_rdata:k:start">start</a>=<span class="var">start</span></span><span class="argument">, <a href="#cmsv_rdata:k:temporary">temporary</a>=<span class="var">temporary</span></span><span class="argument">, <a href="#cmsv_rdata:k:bytelong">bytelong</a>=<span class="var">bytelong</span></span><span class="argument">, <a href="#cmsv_rdata:k:bcstring40">bcstring40</a>=<span class="var">bcstring40</span></span><span class="argument">, <a href="#cmsv_rdata:k:ptr_offsets">ptr_offsets</a>=<span class="var">ptr_offsets</span></span><span class="argument">, <a href="#cmsv_rdata:k:ptr_callback">ptr_callback</a>=<span class="var">ptr_callback</span></span><span class="argument">, <a href="#cmsv_rdata:k:ptr_index">ptr_index</a>=<span class="var">ptr_index</span></span><span class="argument">, <a href="#cmsv_rdata:k:ptr_data">ptr_data</a>=<span class="var">ptr_data</span></span></code></p>

          

          

          
          <h3>Parameters</h3>
            <dl>
              
              <dt id="cmsv_rdata:p:block">block <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:p:pointer">pointer <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:p:sz">sz <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:p:data">data <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
            </dl>
          

          
          <h3>Keywords</h3>
            <dl>
              
              <dt id="cmsv_rdata:k:offset">offset <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:unit">unit <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:template">template <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:status">status <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:errmsg">errmsg <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:start">start <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:temporary">temporary <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:bytelong">bytelong <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:bcstring40">bcstring40 <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:ptr_offsets">ptr_offsets <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:ptr_callback">ptr_callback <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:ptr_index">ptr_index <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
              <dt id="cmsv_rdata:k:ptr_data">ptr_data <span class="smaller"></span></dt>
              <dd class="small"></dd>
              
            </dl>
          

          

          

          

          

        </div>
        

      </div>
      

      <div id="attributes">
        <h2>File attributes</h2>

        <table class="attribute small" summary="File attributes">
          <tr>
            <td class="name">Modification date:</td>
            <td>Thu Nov 18 06:05:26 2010</td>
          </tr>

          <tr>
            <td class="name">Lines:</td>
            <td>584</td>
          </tr>

          
        </table>
      </div>

      
    </div>

    <div class="footer">
    
      <table class="smaller" summary="footer">
        <tr>
          <td class="left">Produced by IDLdoc 3.5.1 on Thu Jul  4 16:01:32 2013</td>
          <td class="right"><a target="_top" href="http://idldoc.idldev.com">IDLdoc project information</a></td>
        </tr>
      </table>
    
    </div>
  </body>
</html>