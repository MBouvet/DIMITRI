<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:50:44 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dimitri_cloud_screening.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dimitri_cloud_screening.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      DIMITRI_CLOUD_SCREENING       </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      THIS ROUTINE TAKES ANY INPUT SENSOR L1B TOA REFLECTANCE AND SENDS IT TO THE </span>
<span class="comments">;*      REQUIRED CLOUD SCREENING ALGORITHM. THE PERCENTAGE CLOUD OF THE SUPPLEID PIXELS </span>
<span class="comments">;*      IS RETURNED.</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = DIMITRI_CLOUD_SCREENING(SENSOR,SITE_TYPE,TOA_RHO,TOA_GEO,CS_ALGO)    </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      SENSOR     - A STRING OF THE INPUT SENSOR      </span>
<span class="comments">;*      SITE_TYPE  - A STRING OF THE DIMITRI VALIDATION SITE TYPE (E.G. 'OCEANIC')'</span>
<span class="comments">;*      TOA_RHO    - A FLOAT ARRAY CONTAINING THE SENSORS TOA REFLECTANCE (NUM_PIXELS,NUM_BANDS)</span>
<span class="comments">;*      TOA_GEO    - A 3 OR 4 ELEMENT ARRAY CONTAINING THE SZA AND VZA VALUES AND EITHER</span>
<span class="comments">;*                   RAA OR SAA AND VAA</span>
<span class="comments">;*      CS_ALGO    - A STRING OF THE CLOUD SCREENING ALGORITHM NAME </span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      VERBOSE    - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      CLOUD_PERCENTAGE - THE PERCENTAGE CLOUD COVER RETURNED FROM THE REQUESTED SPECTRUM</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      07 APR 2011 - C KENT   - DIMITRI-2 V1.0</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      12 APR 2011 - C KENT   - NOMINAL COMPILATION AND OPERATION ON WINDOWS 32BIT </span>
<span class="comments">;*                               IDL 7.1 AND LINUX 64BIT IDL 8.0</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION DIMITRI_CLOUD_SCREENING,SENSOR,SITE_TYPE,TOA_RHO,TOA_GEO,CS_ALGO,VERBOSE=VERBOSE

<span class="comments">;------------------------</span>
<span class="comments">; GET SENSOR BANDS AND CS INDEX BANDS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_CLOUD_SCREENING: STARTING CLOUD SCREENING FOR ALGORITHM -',STRUPCASE(CS_ALGO)
    
  SENS_BANDS  = SENSOR_BAND_INFO(SENSOR,VERBOSE=VERBOSE)
  CS_BANDS    = CS_BAND_INFO(CS_ALGO,VERBOSE=VERBOSE)

<span class="comments">;------------------------</span>
<span class="comments">; COMPUTE NUMBER OF PIXELS AND GET MATCHING SENSOR RHO</span>
  
  NB_PIXELS   = N_ELEMENTS(TOA_RHO[*,0])
  NB_CS_BANDS = N_ELEMENTS(CS_BANDS)
  CS_RHO      = MAKE_ARRAY(NB_PIXELS,NB_CS_BANDS,/FLOAT)
  EXCEPTION_RAISED = 0
  MODISA_FLAG = 0

<span class="comments">;------------------------</span>
<span class="comments">; ADD MODIS LCCA EXCEPTION</span>

  IF  SENSOR EQ 'MODISA' AND $
      CS_ALGO EQ 'LCCA' THEN BEGIN
    
      CS_BANDS = [12,20,21,18,22]
      CS_FACT  = [1.08,0.92,0.95,0.90,1.]

    FOR CLOUDI=0,NB_CS_BANDS-1 DO CS_RHO[*,CLOUDI] = TOA_RHO[*,CS_BANDS[CLOUDI]]*CS_FACT[CLOUDI]
    EXCEPTION_RAISED = 1
    MODISA_FLAG = 1
  ENDIF
  IF NOT EXCEPTION_RAISED THEN BEGIN 
  FOR CLOUDI=0,NB_CS_BANDS-1 DO BEGIN
    BID = GET_SENSOR_BAND_INDEX(SENSOR,CS_BANDS[CLOUDI])
    IF BID GE 0 THEN CS_RHO[*,CLOUDI] = TOA_RHO[*,BID] ELSE BEGIN
       PRINT, 'DIMITRI_CLOUD_SCREENING: ERROR, REQUIRED WAVELENGTHS NOT FOUND, RETURNING -1.0'
      RETURN,-1.0
    ENDELSE
  ENDFOR
  ENDIF

<span class="comments">;------------------------</span>
<span class="comments">; CALL THE REQUIRED CLOUD SCREENING ALGORITHM</span>

  CASE STRUPCASE(CS_ALGO) OF 
    'VGT'         : CLOUD_MASK = CLOUD_MODULE_VGT(SITE_TYPE,CS_RHO,VERBOSE=VERBOSE)
    'GLOBCARBON'  : CLOUD_MASK = CLOUD_MODULE_GLOBCARBON(SITE_TYPE,CS_RHO,TOA_GEO,VERBOSE=VERBOSE)
    'GLOBCARBON_P': CLOUD_MASK = CLOUD_MODULE_GLOBCARBON_P(SITE_TYPE,CS_RHO,TOA_GEO,VERBOSE=VERBOSE)
    'LCCA'        : CLOUD_MASK = CLOUD_MODULE_LCCA(CS_RHO,VERBOSE=VERBOSE,MODISA=MODISA_FLAG)
  ENDCASE

<span class="comments">;--------------------------</span>
<span class="comments">; CALCULATE PERCENTAGE CLOUD</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'DIMITRI_CLOUD_SCREENING: COMPUTING STATISTICS'  
  VALID_PIXELS      = WHERE(TOA_RHO[*,0] GT 0.0,NUM_PIX)
  CS_MASK           = WHERE(CLOUD_MASK EQ 1,NUM_CS)
  CLOUD_PERCENTAGE  = FLOAT(NUM_CS)/FLOAT(NUM_PIX)
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'DIMITRI_CLOUD_SCREENING: CLOUD_PERCENTAGE = ',100.0*CLOUD_PERCENTAGE 

<span class="comments">;--------------------------</span>
<span class="comments">; RETURN THE CLOUD PERCENTAGE</span>

  RETURN, CLOUD_PERCENTAGE

END
</code>
    </div>
  </body>
</html>