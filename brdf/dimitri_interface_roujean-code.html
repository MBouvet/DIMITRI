<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:50:43 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dimitri_interface_roujean.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dimitri_interface_roujean.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;      DIMITRI_INTERFACE_ROUJEAN       </span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;*      INTERFACES BETWEEN THE DIMITRI HMI AND THE ROUJEAN_BRDF FUNCTION</span>
<span class="comments">;* </span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;*      RES = DIMITRI_INTERFACE_ROUJEAN(OUTPUT_FOLDER,IB_REGIONS,IB_REF_SENSORS,IB_REF_VERS)</span>
<span class="comments">;* </span>
<span class="comments">; INPUTS:</span>
<span class="comments">;*      OUTPUT_FOLDER     - THE FULL PATH OF THE OUTPUT FOLDER  </span>
<span class="comments">;*      IB_REGION         - A STRING ARRAY OF VALIDAITON SITE NAMES (E.G. ['Uyuni'])]</span>
<span class="comments">;*      REF_SENSORS       - A STRING ARRAY CONTAINING THE SENSOR NAMES TO BE TREATED AS </span>
<span class="comments">;*                          REFERENCE SENSORS DURING BRDF COMPUTATION</span>
<span class="comments">;*      REF_PROC_VERS     - A STRING ARRAY OF THE REFERENCE SENSOR PROCESSING VERSIONS</span>
<span class="comments">;*</span>
<span class="comments">; KEYWORDS:</span>
<span class="comments">;*      BRDF_BIN          - AN INTEGER OF THE BINNING PERIOD REQUIRED (E.G. 5 = 5 DAY BINS)</span>
<span class="comments">;*      NO_PLOTS          - SET TO STOP THE ROUTINE GENERATING BRDF PLOTS FOR EACH BAND AND EACH BIN</span>
<span class="comments">;*      ALL               - SET TO RUN BRDF COMPUTATION ON ALL COMBINATIONS OF REF-CAL </span>
<span class="comments">;*                          SENSOR PROVIDED. IF NOT SET THEN REF_SENSORS AND CAL_SENSORS </span>
<span class="comments">;*                          MUST BE THE SAME DIMENSIONS</span>
<span class="comments">;*      VERBOSE           - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;*      STATUS            - 1: NO ERRORS REPORTED, (-1) OR 0: ERRORS DURING INGESTION </span>
<span class="comments">;*</span>
<span class="comments">; COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;*                    - M BOUVET  - PROTOTYPE DIMITRI VERSION</span>
<span class="comments">;*        25 JAN 2011 - C KENT    - DIMITRI-2 V1.0</span>
<span class="comments">;*        22 MAR 2011 - C KENT    - ADDED CONFIGURAITON FILE DEPENDENCE</span>
<span class="comments">;*        15 APR 2011 - C KENT    - MINOR BUG FIXES</span>
<span class="comments">;*</span>
<span class="comments">; VALIDATION HISTORY:</span>
<span class="comments">;*        15 APR 2011 - C KENT    - WINDOWS 32-BIT IDL 7.1 AND LINUX 64-BIT IDL 8.0 NOMINAL</span>
<span class="comments">;*                                  COMPILATION AND OPERATION. TESTED ON MERIS 2ND REPROCESSING </span>
<span class="comments">;*                                  WITH MERIS 3RD REPROCESSING AND MODISA COLLECTION 5 </span>
<span class="comments">;-</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION DIMITRI_INTERFACE_ROUJEAN,OUTPUT_FOLDER,IB_REGIONS,IB_REF_SENSORS,IB_REF_VERS,$
                                   BRDF_BIN=BRDF_BIN,BRDF_LIM=BRDF_LIM,NO_PLOTS=NO_PLOTS,ALL=ALL,VERBOSE=VERBOSE

<span class="comments">;-----------------------------------------</span>
<span class="comments">; CHECK OUTPUT_FOLDER EXISTS </span>
  
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_ROUJEAN: STARTING INTERFACE MODULE'
  RES = FILE_INFO(OUTPUT_FOLDER)
  IF RES.EXISTS EQ 0 THEN BEGIN
    PRINT,"DIMITRI_INTERFACE_ROUJEAN: OUTPUT FOLDER DOESN'T EXIST"
    RETURN,-1
  ENDIF

<span class="comments">;----------------------------------------</span>
<span class="comments">; CHECK BRDF BIN SUPPLIED</span>
  
  CFIG_DATA = GET_DIMITRI_CONFIGURATION() 
  
  IF N_ELEMENTS(BRDF_BIN) EQ 0 THEN BEGIN
    PRINT,"DIMITRI_INTERFACE_ROUJEAN: NO BRDF BIN PERIOD SUPPLIED, USING DEFAULT OF 5 DAYS"
    BRDF_BIN = CFIG_DATA.(1)[10]
  ENDIF
  
  N_REFS = N_ELEMENTS(IB_REF_SENSORS)
  N_REFP = N_ELEMENTS(IB_REF_VERS)
  N_REGS = N_ELEMENTS(IB_REGIONS)
 
  IF NOT KEYWORD_SET(ALL) AND $
    (N_REFS+N_REFP)/2 NE N_REFS THEN BEGIN
    PRINT,'DIMITRI_INTERFACE_ROUJEAN: ERROR, INPUT SENSOR ARRAYS NOT CONSISTENT
    RETURN,-1 
  ENDIF
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_ROUJEAN: INPUT SENSOR ARRAYS NOMINAL'

<span class="comments">;-----------------------------------------</span>
<span class="comments">; CREATE NEW ARRAYS TO CONTAIN SENSOR INFORMATION</span>
  
  IF NOT KEYWORD_SET(ALL) THEN BEGIN
    RREFS = IB_REF_SENSORS & RREFP = IB_REF_VERS & RREGS = IB_REGIONS
  ENDIF ELSE BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_ROUJEAN: ALL COMBINATIONS KEYWORD SET, CREATING NEW ARRAYS'
    N_COM = N_REFS*N_REFP*N_REGS
    RREFS = STRARR(N_COM) & RREFP = STRARR(N_COM) & RREGS = STRARR(N_COM)
    REF_COUNT=0
    FOR NR=0,N_REGS-1 DO BEGIN
      FOR NS=0,N_REFS-1 DO BEGIN
        FOR NP=0,N_REFP-1 DO BEGIN
          RREGS[REF_COUNT] = IB_REGIONS[NR]
          RREFS[REF_COUNT] = IB_REF_SENSORS[NS]
          RREFP[REF_COUNT] = IB_REF_VERS[NP]
          REF_COUNT++
        ENDFOR
      ENDFOR
    ENDFOR
  ENDELSE

<span class="comments">;-----------------------------------------</span>
<span class="comments">; LOOP OVER THE REQUIRED COMBINATIONS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_ROUJEAN: STARTING LOOP ON REQUIRED SENSOR COMBINATIONS'
  FOR DI_BRDF = 0,N_ELEMENTS(RREFS)-1 DO BEGIN
      RES = ROUJEAN_BRDF(OUTPUT_FOLDER,RREGS[DI_BRDF],RREFS[DI_BRDF],RREFP[DI_BRDF],$
                         BRDF_BIN,NO_PLOTS=NO_PLOTS,NB_ACQUI_LIMIT=BRDF_LIM,VERBOSE=VERBOSE)
     
      IF RES EQ -1 THEN BEGIN
        PRINT,'DIMITRI_INTERFACE_ROUJEAN: FATAL ERROR ENCOUNTERED'
        RETURN,-1
      ENDIF
  ENDFOR

<span class="comments">;----------------------------------------</span>
<span class="comments">; RETURN NO FATAL ERRORS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_ROUJEAN: COMPLETED RECALIBRATION, NO FATAL ERRORS IDENTIFIED'  
  RETURN,1

END
</code>
    </div>
  </body>
</html>