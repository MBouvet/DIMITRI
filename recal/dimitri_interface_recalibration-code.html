<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:51:05 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dimitri_interface_recalibration.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dimitri_interface_recalibration.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      DIMITRI_INTERFACE_RECALIBRATION       </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      INTERFACES BETWEEN THE DIMITRI HMI AND THE RECALIBRATE_DOUBLETS FUNCTION</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = DIMITRI_INTERFACE_RECALIBRATION(OUTPUT_FOLDER,IC_REGION,REF_SENSORS,REF_PROC_VERS, $</span>
<span class="comments">;*                                            CAL_SENSORS,CAL_PROC_VERS)      </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      OUTPUT_FOLDER     - THE FULL PATH OF THE OUTPUT FOLDER  </span>
<span class="comments">;*      IC_REGION         - THE VALIDATION SITE NAME E.G. 'Uyuni'</span>
<span class="comments">;*      REF_SENSORS       - A STRING ARRAY CONTAINING THE SENSOR NAMES TO BE TREATED AS </span>
<span class="comments">;*                          REFERENCE SENSORS DURING INTERCALIBRATION</span>
<span class="comments">;*      REF_PROC_VERS     - A STRING ARRAY OF THE REFERENCE SENSOR PROCESSING VERSIONS</span>
<span class="comments">;*      CAL_SENSORS       - A STRING ARRAY CONTAINING THE SENSOR NAMES TO BE </span>
<span class="comments">;*                          INTERCALIBRATED AGAINST THE REFERENCE SENSORS</span>
<span class="comments">;*      CAL_PROC_VERS     - A STRING ARRAY OF THE CALIBRATION SENSOR PROCESSING VERSIONS</span>
<span class="comments">;*      VZA_MIN           - THE MINIMUM VIEWING ZENITH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      VZA_MAX           - THE MAXIMUM VIEWING ZENITH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      VAA_MIN           - THE MINIMUM VIEWING AZIMUTH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      VAA_MAX           - THE MAXIMUM VIEWING AZIMUTH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      SZA_MIN           - THE MINIMUM SOLAR ZENITH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      SZA_MAX           - THE MAXIMUM SOLAR ZENITH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      SAA_MIN           - THE MINIMUM SOLAR AZIMUTH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;*      SAA_MAX           - THE MAXIMUM SOLAR AZIMTUH ANGLE ALLOWED FOR AN OBSERVATION</span>
<span class="comments">;</span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      ALL               - SET TO RUN INTERCALIBRATION ON ALL COMBINATIONS OF REF-CAL </span>
<span class="comments">;*                          SENSOR PROVIDED. IF NOT SET THEN REF_SENSORS AND CAL_SENSORS </span>
<span class="comments">;*                          MUST BE THE SAME DIMENSIONS</span>
<span class="comments">;*      VERBOSE           - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      STATUS            - 1: NO ERRORS REPORTED, (-1) OR 0: ERRORS DURING INGESTION </span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*                  - M BOUVET  - PROTOTYPE DIMITRI VERSION</span>
<span class="comments">;*      22 JAN 2011 - C KENT    - DIMITRI-2 V1.0</span>
<span class="comments">;*      02 JUL 2011 - C KENT    - ADDED ABSOLUTE ANGULAR CRITERIA</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      13 APR 2011 - C KENT    - WINDOWS 32-BIT MACHINE IDL 8.0 AND LINUX 64-BIT MACHINE </span>
<span class="comments">;*                                  IDL 8.0, NOMINAL COMPILATION AND OPERATION. TESTED FOR </span>
<span class="comments">;*                                  MERIS VS MERIS AND MERIS VS MODIS </span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION DIMITRI_INTERFACE_RECALIBRATION,OUTPUT_FOLDER,IC_REGION,REF_SENSORS,REF_PROC_VERS, $
                     CAL_SENSORS,CAL_PROC_VERS,CLOUD_PERCENTAGE,ROI_PERCENTAGE,             $
                     VZA_MIN,VZA_MAX,VAA_MIN,VAA_MAX,SZA_MIN,SZA_MAX,SAA_MIN,SAA_MAX,       $
                     ALL=ALL,VERBOSE=VERBOSE

<span class="comments">;-----------------------------------------</span>
<span class="comments">; CHECK OUTPUT_FOLDER EXISTS </span>
  
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_RECAL: STARTING INTERFACE MODULE'
  RES = FILE_INFO(OUTPUT_FOLDER)
  IF RES.EXISTS EQ 0 THEN BEGIN
    PRINT,"DIMITRI_INTERFACE_RECAL: OUTPUT FOLDER DOESN'T EXIST"
    RETURN,-1
  ENDIF

<span class="comments">;-----------------------------------------</span>
<span class="comments">; CHECKS OFFSET AND PERCENTAGES ARE OK</span>

  CP_LIMIT = FLOAT(CLOUD_PERCENTAGE)*.01
  RP_LIMIT = FLOAT(ROI_PERCENTAGE)*.01

  IF  CP_LIMIT  GT 1.0 OR CP_LIMIT  LT 0.0 OR $
      RP_LIMIT  GT 1.0 OR RP_LIMIT  LT 0.0 THEN BEGIN
    PRINT, 'DIMITRI_INTERFACE_RECAL: ERROR, CLOUD/ROI PERCENTAGES OUT OF RANGE'
    RETURN,-1
  ENDIF

<span class="comments">;-----------------------------------------</span>
<span class="comments">; CHECK ARRAYS ARE THER SAME SIZE UNLESS 'ALL' </span>
<span class="comments">; KEYWORD SET</span>

  N_REFS = N_ELEMENTS(REF_SENSORS)
  N_REFP = N_ELEMENTS(REF_PROC_VERS)
  N_CALS = N_ELEMENTS(CAL_SENSORS)
  N_CALP = N_ELEMENTS(CAL_PROC_VERS)

  IF NOT KEYWORD_SET(ALL) AND $
    (N_REFS+N_REFP+N_CALS+N_CALP)/4 NE N_REFS THEN BEGIN
    PRINT,'DIMITRI_INTERFACE_RECAL: ERROR, INPUT SENSOR ARRAYS NOT CONSISTENT
    RETURN,-1 
  ENDIF
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_RECAL: INPUT SENSOR ARRAYS NOMINAL'

<span class="comments">;-----------------------------------------</span>
<span class="comments">; CREATE NEW ARRAYS TO CONTAIN SENSOR INFORMATION</span>
  
  IF NOT KEYWORD_SET(ALL) THEN BEGIN
    RREFS = REF_SENSORS & RREFP = REF_PROC_VERS & RCALS = CAL_SENSORS & RCALP = CAL_PROC_VERS
  ENDIF ELSE BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_RECAL: ALL COMBINATIONS KEYWORD SET, CREATING NEW ARRAYS'
    N_COM = N_REFS*N_CALS
    RREFS = STRARR(N_COM) & RREFP = STRARR(N_COM) & RCALS = STRARR(N_COM) & RCALP = STRARR(N_COM)
    REF_COUNT=0
    FOR NR=0,N_REFS-1 DO BEGIN
      FOR NC=0,N_CALS-1 DO BEGIN
        RREFS[REF_COUNT] = REF_SENSORS[NR]
        RREFP[REF_COUNT] = REF_PROC_VERS[NR]
        RCALS[REF_COUNT] = CAL_SENSORS[NC]
        RCALP[REF_COUNT] = CAL_PROC_VERS[NC]  
        REF_COUNT++
      ENDFOR
    ENDFOR
  ENDELSE

<span class="comments">;-----------------------------------------</span>
<span class="comments">; LOOP OVER THE REQUIRED REF_SENSOR-CAL_SENSOR </span>
<span class="comments">; COMBINATIONS FOR RECALIBRATION</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_RECAL: STARTING LOOP ON REQUIRED SENSOR COMBINATIONS'
  FOR DI_RCAL = 0,N_ELEMENTS(RREFS)-1 DO BEGIN
      RES = RECALIBRATE_DOUBLETS(OUTPUT_FOLDER,IC_REGION,RREFS[DI_RCAL],RREFP[DI_RCAL],RCALS[DI_RCAL],$
                                 RCALP[DI_RCAL],CP_LIMIT,RP_LIMIT                                    ,$
                                 VZA_MIN,VZA_MAX,VAA_MIN,VAA_MAX,SZA_MIN,SZA_MAX,SAA_MIN,SAA_MAX     ,$
                                 VERBOSE=VERBOSE)
      IF RES EQ -1 THEN BEGIN
        PRINT,'DIMITRI_INTERFACE_RECAL: FATAL ERROR ENCOUNTERED'
        RETURN,-1
      ENDIF
  ENDFOR

<span class="comments">;-----------------------------------------</span>
<span class="comments">; CALL FUNCTION TO CONCATENATE ALL DATA INTO A SUPER SENSOR</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_RECAL: STARTING LOOP TO GENERATE SUPERSENSORS'
  FOR DI_RCAL = 0,N_ELEMENTS(RREFS)-1 DO BEGIN
    RES = CONCATENATE_TOA_REFLECTANCE(OUTPUT_FOLDER,IC_REGION,RREFS[DI_RCAL],RREFP[DI_RCAL],VERBOSE=VERBOSE)
  ENDFOR
  
<span class="comments">;----------------------------------------</span>
<span class="comments">; RETURN NO FATAL ERRORS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_INTERFACE_RECAL: COMPLETED RECALIBRATION, NO FATAL ERRORS IDENTIFIED'  
  RETURN,1

END
</code>
    </div>
  </body>
</html>