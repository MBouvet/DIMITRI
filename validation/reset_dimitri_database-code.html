<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:56 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>reset_dimitri_database.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="reset_dimitri_database.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">PRO REMOVE_NIGHT_PRODUCTS

<span class="comments">; DEFINE DATABASE FILE</span>
  
  <span class="comments">;DL          = GET_DIMITRI_LOCATION('DL')  </span>
  <span class="comments">;DB_FILE     = GET_DIMITRI_LOCATION('DATABASE')</span>
  <span class="comments">;DB_TEMPLATE = GET_DIMITRI_TEMPLATE(1,/TEMPLATE,VERBOSE=VERBOSE)</span>
  DB_DATA     = READ_ASCII(DB_FILE,TEMPLATE=DB_TEMPLATE)

<span class="comments">; DEFINE INPUT FOLDER</span>
  
  <span class="comments">;IFOLDER     = GET_DIMITRI_LOCATION('INPUT')</span>

<span class="comments">; DEFINE WHICH SITE</span>
  
  IREGIONS     = ['SIO','SPG']

<span class="comments">; DEFINE WHICH PROCESSORS AND PROCVERS</span>

  ISENSORS     = [           'AATSR',             'ATSR2',             'MERIS',           'MERIS',      'MODISA']
  IPROCV       = ['2nd_Reprocessing', 'Reprocessing_2008',  '2nd_Reprocessing','3rd_Reprocessing','Collection_5']
  NOVAL        = -1.0
  PCOUNTER     = 0
  CD,CURRENT=CDIR

  FOR IR=0,N_ELEMENTS(IREGIONS)-1 DO BEGIN <span class="comments">;LOOP OVER EACH SITE</span>
    FOR IS = 0,N_ELEMENTS(ISENSORS)-1 DO BEGIN <span class="comments">;LOOP OVER EACH SENSOR/PROCV</span>

      IDX = WHERE(  DB_DATA.REGION EQ IREGIONS[IR]            AND $
                    DB_DATA.SENSOR EQ ISENSORS[IS]            AND $
                    DB_DATA.PROCESSING_VERSION EQ IPROCV[IS]  AND $
                    FIX(ABS(DB_DATA.NUM_ROI_PX-NOVAL)) EQ 0, COUNT)  

      IF COUNT EQ 0 THEN CONTINUE
    
      FOR II = 0,count-1 DO BEGIN <span class="comments">;LOOP OVER EACH BAD PRODUCT</span>
    
        TYEAR = STRTRIM(STRING(DB_DATA.YEAR[IDX[II]]),2)
        TFILE = DB_DATA.FILENAME[IDX[II]]
        SSTR = STRING(STRMID(TFILE,0,STRLEN(TFILE)-5)+'*')
        TFOLD = IFOLDER+'Site_'+IREGIONS[IR]+DL+ISENSORS[IS]+dl+'Proc_'+IPROCV[IS]+DL+TYEAR+DL
    
        CD,TFOLD
        FSRC = FILE_SEARCH(SSTR)

        IF FSRC[0] EQ '' THEN CONTINUE
        FOR JJ=0,N_ELEMENTS(FSRC)-1 DO FILE_DELETE,TFOLD+FSRC[JJ]
        PCOUNTER++

      ENDFOR <span class="comments">;LOOP OVER EACH BAD PRODUCT</span>
    ENDFOR <span class="comments">;LOOP OVER EACH SENSOR/PROCV</span>
  ENDFOR <span class="comments">;LOOP OVER EACH SITE</span>

  CD,CDIR
  PRINT, '-----------------------------------------'
  PRINT, 'DELETED A TOTAL OF ',STRTRIM(STRING(PCOUNTER),2),' PRODUCTS'
  PRINT, '-----------------------------------------'

END

<span class="comments">;**********************************************************************************************************************</span>
<span class="comments">;**********************************************************************************************************************</span>

PRO REMOVE_DIMITRI_SAVS

  CD,CURRENT=CDIR
  IFOLDER = '/mnt/Projects/MEREMSII/DIMITRI/20120305/DIMITRI_2.0/Input/'
  DL = PATH_SEP()
  
  TREGIONS = ['Amazon','BOUSSOLE','DomeC','Libya4','SIO','SPG','TuzGolu','Uyuni']
  TSENS = ['AATSR'           ,             'ATSR2',             'MERIS',           'MERIS',      'MODISA',      'PARASOL',          'VEGETATION']
  TPROC = ['2nd_Reprocessing', 'Reprocessing_2008',  '2nd_Reprocessing','3rd_Reprocessing','Collection_5','Calibration_1','Calibration_1']

  FOR I=0,N_ELEMENTS(TREGIONS)-1 DO BEGIN
      for jj=0,n_elements(tsens)-1 do begin
   
   tmp = IFOLDER+DL+'Site_'+TREGIONS[I]+DL+TSENS[jj]+DL+'Proc_'+TPROC[jj]
if file_test(tmp,/directory) eq 0 then continue
CD, tmp

  RES = FILE_SEARCH('*'+TSENS[JJ]+'_*')
  IF RES[0] NE '' THEN FOR J=0,N_ELEMENTS(RES)-1 DO FILE_DELETE,RES[J]
  endfor  
  ENDFOR 
  
  CD,CDIR

END

<span class="comments">;**********************************************************************************************************************</span>
<span class="comments">;**********************************************************************************************************************</span>

PRO BATCH_INGEST_ALL

  TREGIONS  = ['Amazon','BOUSSOLE','DomeC','Libya','SIO','SPG','TuzGolu','Uyuni']
  TSENS     = ['AATSR'           ,             'ATSR2',             'MERIS',           'MERIS',      'MODISA']
  TPROC     = ['2nd_Reprocessing', 'Reprocessing_2008',  '2nd_Reprocessing','3rd_Reprocessing','Collection_5']
  YEARS     = ['2002','2003','2004','2005','2006','2007','2008','2009','2010','2011']

  FOR IR = 0,N_ELEMENTS(TREGIONS)-1 DO BEGIN
    FOR IS = 0,N_ELEMENTS(TSENS)-1 DO BEGIN
      FOR IY = 0,N_ELEMENTS(TYEARS)-1 DO BEGIN
stop
       <span class="comments">; RES = DIMITRI_INTERFACE_INGEST(TREGIONS[IR],TSENS[IS],TPROC[IS], COLOUR_TABLE=39,PLOT_XSIZE=700,PLOT_YSIZE=400,YEAR=YEARS[IY],/verbose)</span>

      ENDFOR
    ENDFOR 
  ENDFOR

END

<span class="comments">;**********************************************************************************************************************</span>
<span class="comments">;**********************************************************************************************************************</span>

PRO RESET_DIMITRI_DATABASE

<span class="comments">;STEPS TO CLEAN TYHE DIMITRI DATABASE AND OTHER FILES</span>

<span class="comments">; idl> CD,''</span>
<span class="comments">; idl> @compile_dimitri</span>

<span class="comments">;1) REMOVE EMPTY PRODUCTS FROM SIO AND SPG</span>

  PRINT, 'RDD STATUS ',SYSTIME(),': STARTING REMOVAL OF NIGHT PRODUCTS'
  REMOVE_NIGHT_PRODUCTS
  PRINT, 'RDD STATUS ',SYSTIME(),': COMPLETED REMOVAL OF NIGHT PRODUCTS'

<span class="comments">;2) REMOVE SAV FILES</span>

  PRINT, 'RDD STATUS ',SYSTIME(),': STARTING REMOVAL OF DIMITRI SAVS'
  REMOVE_DIMITRI_SAVS
  PRINT, 'RDD STATUS ',SYSTIME(),': COMPLETED REMOVAL OF DIMITRI SAVS'

<span class="comments">;3) BACKUP AND REMOVE DATABASE FILE</span>

  PRINT, 'RDD STATUS ',SYSTIME(),': STARTING BACKUP OF DIMITRI DATABASE'
  DB_FILE  = GET_DIMITRI_LOCATION('DATABASE')
  FILE_COPY,DB_FILE,DB_FILE+'_RESET_BACKUP'
  FILE_DELETE,DB_FILE
  PRINT, 'RDD STATUS ',SYSTIME(),': COMPLETED BACKUP OF DIMITRI DATABASE'

<span class="comments">;4) REPROESS ALL SITES/SENSOR COMBINATIONS</span>

  PRINT, 'RDD STATUS ',SYSTIME(),': STARTING REPROCESSING OF ALL DIMITRI DATA'
  BATCH_INGEST_ALL
  PRINT, 'RDD STATUS ',SYSTIME(),': COMPLETED REPROCESSING OF ALL DIMITRI DATA'

END
</code>
    </div>
  </body>
</html>