<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:51:08 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>statistical_cloud_screening.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="statistical_cloud_screening.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">PRO STATISTICAL_CLOUD_SCREENING
<span class="comments">; STATISTICALLY SCREEN DATA USING A THRESHOLD ON THE STDDEV VALUES</span>

  SENSOR  = 'ATSR2'
  PROCVR  = 'Reprocessing_2008'
  SITES   = ['Amazon','BOUSSOLE','DomeC','Libya4','SIO','SPG','TuzGolu','Uyuni']
  BIDX    = 7 <span class="comments">;REMEMBER TO INCLUDE REFLEACTANCE AND STDEV INDEXS; STARTS FROM 0, 15 FOR MERIS WOULD BE STDEV OF 412NM</span>
  THRESH  = 0.01

<span class="comments">;--------------------------</span>
<span class="comments">; RESTORE DATABASE</span>
  
  DB_TEMPLATE  = GET_DIMITRI_TEMPLATE(1,/TEMPLATE)
  DB_DATA      = READ_ASCII(GET_DIMITRI_LOCATION('DATABASE'),TEMPLATE=DB_TEMPLATE)
  IFOLDER      = GET_DIMITRI_LOCATION('INPUT')
  DL           = PATH_SEP()

  FOR II=0,N_ELEMENTS(SITES)-1 DO BEGIN

<span class="comments">;--------------------------  </span>
<span class="comments">; RESTORE TIME SERIES DATA</span>
    
    TEMP = IFOLDER+DL+'Site_'+SITES[II]+DL+SENSOR+DL+'Proc_'+PROCVR+DL+SENSOR+'_TOA_REF.dat'
    IF FILE_TEST(TEMP) EQ 0 THEN CONTINUE
    RESTORE,TEMP

<span class="comments">;-------------------------- </span>
<span class="comments">; FIND DATES WHERE ROI COVERED, </span>
<span class="comments">; MAN_CS IS NOT DEFINED</span>

    RES = WHERE(  DB_DATA.REGION EQ SITES[II] AND $
                  DB_DATA.SENSOR EQ SENSOR AND $
                  DB_DATA.PROCESSING_VERSION EQ PROCVR AND $
                  DB_DATA.ROI_COVER EQ 1 AND $
                  DB_DATA.MANUAL_CS LT 0,COUNT)
    IF COUNT EQ 0 THEN CONTINUE

<span class="comments">;--------------------------</span>
<span class="comments">; LOOP OVER EACH DATE</span>

    FOR JJ=0L,COUNT-1 DO BEGIN
    PRINT, JJ, ' OUT OF ',COUNT
    
    <span class="comments">;A = REBIN(ABS(SENSOR_L1B_REF[0,*]-DB_DATA.DECIMAL_YEAR[RES[JJ]]),N_ELEMENTS(SENSOR_L1B_REF[0,*])</span>
      TT = WHERE(ABS(SENSOR_L1B_REF[0,*]-DB_DATA.DECIMAL_YEAR[RES[JJ]]) LT 0.00005D,RES2)
      IF RES2 LT 1 THEN STOP
      TT2 = WHERE(SENSOR_L1B_REF[5+12+BIDX,TT] LT THRESH,AA)
      IF AA GT 0 THEN DB_DATA.MANUAL_CS[RES[JJ]]=0
    ENDFOR

<span class="comments">;--------------------------</span>
<span class="comments">; SORT OUT NETCDFS</span>

    RES = WHERE(DB_DATA.REGION EQ SITES[II] AND $
                DB_DATA.SENSOR EQ SENSOR AND $
                DB_DATA.PROCESSING_VERSION EQ PROCVR,COUNT)
    IF COUNT  GT 0 THEN BEGIN     
    
      NEWVAR = DB_DATA.MANUAL_CS[RES]
      REL = UPDATE_DIMITRI_EXTRACT_TOA_NCDF(SITES[II],SENSOR,PROCVR,'cloud_fraction_manual',NEWVAR)
    ENDIF
  ENDFOR

<span class="comments">;--------------------------  </span>
<span class="comments">; UPDATE DATABASE</span>

  RES = SAVE_DIMITRI_DATABASE(DB_DATA)
  
END
</code>
    </div>
  </body>
</html>