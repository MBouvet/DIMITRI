<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:57 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>validate_cloud_screening.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="validate_cloud_screening.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">PRO VALIDATE_CLOUD_SCREENING
<span class="comments">;RESTORES DIMITRI TOA TIME SERIES, PLOTS THE FIRST BAND AND OUTPUTS A SAV AND CSV FILE FOR CHECKING</span>

<span class="comments">;------------------------</span>
<span class="comments">; DEFINE SETUP</span>

  DEVICE,DECOMPOSED=0
  LOADCT,39
  CP_LIMIT  = 0.
  RP_LIMIT  = 1.
  ROICOVER  = 1
  PX_THRESH = 1  
  SENSORS   = ['PARASOL']<span class="comments">;['MERIS','MERIS','MODISA','AATSR','ATSR2'];,'VEGETATION']</span>
  PROCVER   = ['Calibration_1']<span class="comments">;['2nd_Reprocessing','3rd_Reprocessing','Collection_5','2nd_Reprocessing','Reprocessing_2008'];,'Calibration_1']</span>
  SITES     = ['Amazon','BOUSSOLE','Libya4','DomeC','SIO','SPG','TuzGolu','Uyuni']
  OFOLDER   = '/mnt/Projects/MEREMSII/DIMITRI/20120305/DIMITRI_2.0/Source/validation/'

  DID = 0
  BID = 12+5
  TOL = 0.00005

<span class="comments">;------------------------</span>
<span class="comments">; READ DATABASE</span>

  DB_FILE   = GET_DIMITRI_LOCATION('DATABASE')
  IFOLDER   = GET_DIMITRI_LOCATION('INPUT')
  DL        = PATH_SEP()
  DB_DATA   = READ_ASCII(DB_FILE,TEMPLATE=GET_DIMITRI_TEMPLATE(1,/TEMPLATE))

<span class="comments">;------------------------ </span>
<span class="comments">; LOOP OVER EACH SENSOR + PROCV AND EACH SITE</span>

  FOR II=0L,N_ELEMENTS(SENSORS)-1 DO BEGIN
  FOR KK=0L,N_ELEMENTS(SITES)-1 DO BEGIN

<span class="comments">;------------------------ </span>
<span class="comments">; RESTORE TOA_REF</span>

    S1_IFILE = STRING(IFOLDER+DL+'Site_'+SITES[KK]+DL+SENSORS[II]+DL+'Proc_'+PROCVER[II]+DL+SENSORS[II]+'_TOA_REF.dat')
    IF NOT FILE_TEST(S1_IFILE) THEN CONTINUE
    RESTORE,S1_IFILE

<span class="comments">;------------------------ </span>
<span class="comments">; FIND ALL DATA WHICH IS CLASSED </span>
<span class="comments">; AS CLOUD FREE AND ROI COVERED</span>

    RES = WHERE(STRCMP(DB_DATA.REGION,SITES[KK])               EQ 1 AND $
                STRCMP(DB_DATA.SENSOR,SENSORS[II])             EQ 1 AND $
                STRCMP(DB_DATA.PROCESSING_VERSION,PROCVER[II]) EQ 1 AND $
                DB_DATA.ROI_COVER  GE ROICOVER                 AND $
                DB_DATA.NUM_ROI_PX GE PX_THRESH)

<span class="comments">;----------------------------------------</span>
<span class="comments">; GET A LIST OF DATES IN WHICH DATA IS ALSO </span>
<span class="comments">; WITHIN THE CLOUD PERCENTAGE </span>

    GD_DATE = 0.0
    FOR I_CS=0L,N_ELEMENTS(RES)-1 DO BEGIN
      IF DB_DATA.MANUAL_CS[RES[I_CS]]  GE 1.0 THEN CONTINUE
      IF (DB_DATA.MANUAL_CS[RES[I_CS]] EQ 0.0) OR $
         (DB_DATA.AUTO_CS[RES[I_CS]]   LE CP_LIMIT AND DB_DATA.AUTO_CS[RES[I_CS]] GT -1.0) THEN GD_DATE = [GD_DATE,DB_DATA.DECIMAL_YEAR[RES[I_CS]]]
    ENDFOR<span class="comments">;END OF LOOP ON GOOD DATES</span>
    GD_DATE = GD_DATE[1:N_ELEMENTS(GD_DATE)-1]
    GD_IDX = MAKE_ARRAY(N_ELEMENTS(SENSOR_L1B_REF[0,*]),/INTEGER,VALUE=0)
    FOR GD=0L,N_ELEMENTS(GD_DATE)-1 DO BEGIN
      RES = WHERE(ABS(SENSOR_L1B_REF[0,*]-GD_DATE[GD]) LE TOL AND SENSOR_L1B_REF[BID,*] GT 0.0 AND SENSOR_L1B_REF[BID,*] lT 5.0)                  
      GD_IDX[RES]=1
    ENDFOR <span class="comments">;END OF LOOP ON GOOD DATES TO FIND INDEX IN ALL_DATA ARRAY</span>
    RES = WHERE(GD_IDX EQ 1)
    DATA = SENSOR_L1B_REF[*,RES]

    data = data[*,where(data[BID,*] GT 0.0)]  
  

<span class="comments">;------------------------</span>
<span class="comments">; PLOT THE DATA AND SAVE AS IDL SAV</span>

    WINDOW,1,XSIZE=700,YSIZE=400
    PLOT,DATA[DID,*],DATA[BID,*],/NODATA,COLOR=0,BACKGROUND=255,$
    XTITLE='DATE',YTITLE='TOA_RHO',TITLE=SITES[KK]+'_'+SENSORS[II]+'_'+PROCVER[II]
    OPLOT,DATA[DID,*],DATA[BID,*],COLOR=60,THICK=2
    IMG = TVRD(/TRUE)
    WRITE_PNG,OFOLDER+'plots'+DL+SENSORS[II]+'_'+PROCVER[II]+'_'+SITES[KK]+'.png',IMG
    WDELETE,1
    SAVE,DATA,FILENAME=OFOLDER+'SAVS'+DL+SENSORS[II]+'_'+PROCVER[II]+'_'+SITES[KK]+'.sav'

<span class="comments">;------------------------</span>
<span class="comments">; PRINT AS CSV</span>

    OPENW,OUTF,OFOLDER+'csv'+DL+SENSORS[II]+'_'+PROCVER[II]+'_'+SITES[KK]+'.csv',/GET_LUN
    PRINTF,OUTF,'DATE;RHO1'
    FOR LL=0L,N_ELEMENTS(DATA[BID,*])-1 DO PRINTF,OUTF,DATA[DID,LL],DATA[BID,LL],FORMAT='( 1(D15.7,1H;),1(D15.7))'
    FREE_LUN,OUTF

  ENDFOR
  ENDFOR
  
END
</code>
    </div>
  </body>
</html>