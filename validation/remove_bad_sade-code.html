<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:51:08 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>remove_bad_sade.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="remove_bad_sade.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="remove_bad_sade:source"></a>pro remove_bad_sade,site,sensor,proc_ver,prodfile

<span class="comments">;definitions</span>
ifol = '/mnt/Projects/MEREMSII/WG_Reference_Dataset/'
dl = path_sep()
ouputfile = ifol+site+dl+site+'_'+sensor+'_'+Proc_ver+'_cleaned.SADE'

case sensor of
'AATSR'       : NBANDS=7 
'MERIS'       : NBANDS=15 
'MODISA'      : NBANDS=10 
'PARASOL'     : NBANDS=9 
'VEGETATION'  : NBANDS=4 
endcase

<span class="comments">;read in sade txt</span>
sadefile = ifol+site+dl+site+'_'+sensor+'_'+Proc_ver+'.SADE'
sadedata = read_sade_txt(sadefile,sensor)

<span class="comments">;read in prodfile</span>
proddata = read_sade_prodfile_text(prodfile)

<span class="comments">;create an array of number elements of sade text</span>
badindx = make_array(n_elements(sadedata.jpg),/integer,value=0)

<span class="comments">;loop over each prodfile product</span>
for ii=0,n_elements(proddata.badprod)-1 do begin

  <span class="comments">;  find which sadetext jpgs match, set these indeiceses to 1</span>
  res = where(sadedata.jpg eq proddata.badprod[ii],count)
  if count gt 0 then begin
  badindx[res] = 1
  <span class="comments">;  delete the quicklooks</span>
  for jj=0,count-1 do begin
    if file_test(ifol+site+dl+sensor+dl+sadedata.jpg[res[jj]]) then file_delete,ifol+site+dl+sensor+dl+sadedata.jpg[res[jj]]
    endfor
  endif

<span class="comments">;endloop</span>
endfor

<span class="comments">;print out sade data from indices of 0 and not jpg file info</span>
openw,outf,ouputfile,/get_lun
for kk=0,n_elements(sadedata.jpg)-1 do begin
if badindx[kk] then continue

for ival = 0,3 do begin
  temp = 0.0
  for iband=0,nbands-1 do begin
  temp = [temp,sadedata.(4+iband+ival*nbands)[kk]]
  endfor
  temp = temp[1:nbands]
  case ival of
  0 : toa_ref = temp 
  1 : toa_std = temp
  2 : vza = temp
  3 : vaa = temp
  endcase
  endfor

if TOA_REF[0] gt 1.0 then continue

PRINTF,OUTF,string(SENSOR+'_'+proc_ver),sadedata.ACQdate[kk],sadedata.PROCdate[kk],SITE,TOA_REF,TOA_STD,$
      VZA,VAA,sadedata.nPIXs[kk],sadedata.LAT[kk],sadedata.LON[kk],sadedata.SZA[kk],sadedata.SAA[kk],$
      FORMAT = '(4(A,1H ),'+STRTRIM(FIX(4*nBANDS),2)+'(F11.6,1H ),1(i10,1H ),2(F10.3,1H ),1(F10.6,1H ),1(f10.6))'
endfor
free_lun,outf
print, 'finished...'
end
</code>
    </div>
  </body>
</html>