<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:55 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>distance_from_land.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="distance_from_land.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">FUNCTION DISTANCE_FROM_LAND,PIXEL_LAT,PIXEL_LON

<span class="comments">;*****************************************************************************</span>
<span class="comments">;* THIS FUNCTION COMPUTES DISTANCE FROM LAND A PIXEL IS GIVEN IT'S GEOLOCATION</span>
<span class="comments">;*</span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*    PIXEL_LAT - THE PIXELS LATITUDE</span>
<span class="comments">;*    PIXEL_LON - THE PIXELS LONGITUDE</span>
<span class="comments">;*</span>
<span class="comments">;* VERISON: </span>
<span class="comments">;*    1.0 : C. KENT. ARGANS LTD, JUNE 2011 </span>
<span class="comments">;*</span>
<span class="comments">;* NOTES:</span>
<span class="comments">;*    VALID DISTANCES ARE FROM 0 (LAND) TO 50 (KM FROM LAND), 999 MEANS </span>
<span class="comments">;*    IT'S GREATER THAN 50 KM, AND -1 MEANS AN INTERNAL ERROR HAS OCCURED</span>
<span class="comments">;****************************************************************************</span>

<span class="comments">;---------------------------</span>
<span class="comments">; LANDMASK DATA IS A STRUCTURE OF DST,LATS,LONS</span>

COMMON LANDMASK, LANDMASK_DATA 

<span class="comments">;---------------------------</span>
<span class="comments">; DEFINE PARAMETERS</span>

  DST_TOL   = 0.05 <span class="comments">;OF A DEGREE, VERY VERY VERY APPROXIMATELY 5KM</span>
  SLOOP     = 0
  ELOOP     = 10
  FLTOL     = 0.000001
  MAX_VAL   = 50
  FIL_VAL   = 999
  BAD_VAL   = -1
  DST_EX    = 0

<span class="comments">;---------------------------</span>
<span class="comments">; START LOOP</span>

  FOR LMI = SLOOP,ELOOP DO BEGIN 

<span class="comments">;---------------------------</span>
<span class="comments">; SEARCH FOR LATS WITHIN RANGE</span>

    LMTOL = DST_TOL*FLOAT(LMI)
    LAT_ID = WHERE(LANDMASK_DATA.LATS GT PIXEL_LAT-LMTOL AND LANDMASK_DATA.LATS LT PIXEL_LAT+LMTOL,LATCOUNT)
    IF LATCOUNT EQ 0 THEN CONTINUE

<span class="comments">;---------------------------</span>
<span class="comments">;  IF FOUND SOME THEN FIND LONS WITHIN RANGE</span>

    GOOD_LATS = LANDMASK_DATA.LATS[LAT_ID]
    LON_ID = WHERE(LANDMASK_DATA.LONS[LAT_ID] GT PIXEL_LON-LMTOL AND LANDMASK_DATA.LONS[LAT_ID] LT PIXEL_LON+LMTOL,LONCOUNT)  
    IF LONCOUNT EQ 0 THEN CONTINUE

<span class="comments">;---------------------------</span>
<span class="comments">; IF LONS FOUND THEN FIND WHERE THE DISTANCE FROM OUR POINT IS THE SMALLEST</span>

    GOOD_LONS = LANDMASK_DATA.LONS[LAT_ID[LON_ID]]
    GOOD_LATS = GOOD_LATS[LON_ID]

    GEO_DISTANCE = SQRT((GOOD_LONS-PIXEL_LON)^2+(GOOD_LATS-PIXEL_LAT)^2)
    GEO_MATCH_ID = WHERE(GEO_DISTANCE-MIN(GEO_DISTANCE) LT FLTOL)

    MATCH_LAT = GOOD_LATS[GEO_MATCH_ID[0]]
    MATCH_LON = GOOD_LONS[GEO_MATCH_ID[0]]
    DST_EX = 1
  
  ENDFOR

<span class="comments">;---------------------------</span>
<span class="comments">; MAKE SURE THAT WE'VE FOUND SOMETHING</span>

  IF DST_EX THEN BEGIN
  
<span class="comments">;---------------------------</span>
<span class="comments">; GET ID'S IN MAIN LANDMASK DATASET</span>

    PY_ID = WHERE(LANDMASK_DATA.LATS-MATCH_LAT LT FLTOL)
    PX_ID = WHERE(LANDMASK_DATA.LONS-MATCH_LON LT FLTOL)

<span class="comments">;---------------------------</span>
<span class="comments">; GET CORRESPONDING DST VALUE</span>

    DFL = LANDMASK_DATA.DST[PX_ID[0],PY_ID[0]]
    IF DFL GT MAX_VAL THEN DFL = FIL_VAL ELSE DFL = FIX(DFL)

  ENDIF ELSE DFL = BAD_VAL

<span class="comments">;---------------------------</span>
<span class="comments">; RETURN DISTANCE FROM LAND</span>

  RETURN,DFL

END
</code>
    </div>
  </body>
</html>