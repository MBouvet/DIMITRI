<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:51:08 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>remove_bad_parasol.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="remove_bad_parasol.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="remove_bad_parasol:source"></a>pro remove_bad_parasol

regions = ['Amazon','BOUSSOLE','DomeC','Libya4','SIO','SPG','TuzGolu','Uyuni']
proc = 'Proc_Calibration_1'
years = ['2002','2003','2004','2005','2006','2007','2008','2009','2010','2011']

ifolder = '/mnt/USB_drive/DIMITRI/DIMITRI_2.0/Input/Site_'
dl = '/'
sensor = 'PARASOL'
STR = 'P*KD*0'
count=0
outlog = '/mnt/Projects/MEREMSII/PARASOL_log/bad_products_log.txt'
openw,outf,outlog,/append,/get_lun

<span class="comments">; loop over each validation site</span>
for isite=0,N_elements(regions)-1 do begin
count=0

<span class="comments">; loop over each year</span>
for iyear=0,N_elements(years)-1 do begin

nfol = ifolder+regions[isite]+dl+sensor+dl+proc+dl+years[iyear]

if not file_test(nfol,/directory) then goto, nofol

<span class="comments">;find all parasol products</span>
cd,nfol
files = file_search(str)
if files[0] eq '' then goto,nofol

<span class="comments">; loop over parasol products</span>
for ifile=0l,n_elements(files)-1 do begin

<span class="comments">;   get expected number of pixels </span>
npixs = get_parasol_num_pixels(files[ifile])
esize = (npixs*738l)+180l

<span class="comments">;   get file size in bytes</span>
temp = file_info(files[ifile])
fsize = temp.size

<span class="comments">;   if not equal then begin - remove product and xounter product, append filename to list</span>
  if esize ne fsize then begin
  count++
  printf,outf,regions[isite],' ',files[ifile]
  print,regions[isite],' ',files[ifile]

  fname = files[ifile]
  file_delete,fname
  STRPUT,fname,'L',15
  file_delete,fname
  endif

<span class="comments">;  endloop</span>
endfor
<span class="comments">;  endloop</span>
nofol:
endfor
<span class="comments">;  endloop</span>
print, count, ' removals for ',regions[isite]
endfor

free_lun,outf

end


<a id="get_parasol_num_pixels:source"></a>function get_parasol_num_pixels,filename

ENDIAN_SIZE = GET_ENDIAN_SIZE()

<span class="comments">;------------------------------------------------</span>
<span class="comments">; OPEN THE PRODUCT AND READ NUMBER AND SIZE OF RECORDS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B DATA: OPENING AND READING THE PRODUCT LOG'
  OPENR,IN_PARA,FILENAME,/GET_LUN
  TEMP = BYTARR(52)
  NUM_RECS = ULONG(1)
  REC_SIZE = ULONG(1)
  READU,IN_PARA,TEMP
  READU,IN_PARA,NUM_RECS
  READU,IN_PARA,REC_SIZE 
free_lun,in_para
<span class="comments">;------------------------------------------------</span>
<span class="comments">; SWAP ENDIAN IF NEEDED - DATA IS BIG ENDIAN</span>

  IF ENDIAN_SIZE EQ 0 THEN BEGIN
    NUM_RECS = SWAP_ENDIAN(NUM_RECS)
    REC_SIZE = SWAP_ENDIAN(REC_SIZE)
  ENDIF
  
  return,num_recs
  
end
  
</code>
    </div>
  </body>
</html>