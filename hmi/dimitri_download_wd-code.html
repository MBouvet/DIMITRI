<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:39 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dimitri_download_wd.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dimitri_download_wd.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      DIMITRI_DOWNLOAD_WD    </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      THIS PROGRAM DISPLAYS A WIDGET ALLOWING AUTOMATED CALLING OF A WEB BROWSER </span>
<span class="comments">;*      TO THE SENSOR DOWNLOAD AREAS FOR DIMITRI. tHE PROGRAM USES SMALLER ROUTINES </span>
<span class="comments">;*      FOR THE BUTTON AND OPTION ACTIONS </span>
<span class="comments">;*</span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      DIMITRI_DOWNLOAD_WD      </span>
<span class="comments">;*</span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      GROUP_LEADER - THE ID OF ANOTHER WIDGET TO BE USED AS THE GROUP LEADER</span>
<span class="comments">;*      VERBOSE - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      17 FEB 2011 - C KENT    - DIMITRI-2 V1.0</span>
<span class="comments">;*      21 FEB 2011 - C KENT    - UPDATED CODE HEADER INFORMATION</span>
<span class="comments">;*      25 FEB 2010 - C KENT    - ADDED GROUP_LEADER KEYWORD</span>
<span class="comments">;*      21 MAR 2011 - C KENT    - UPDATED FIREFOX CALLING ON LINUX</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      17 FEB 2011 - C KENT    - WINDOWS 32-BIT MACHINE IDL 7.1/IDL 8.0: NOMINAL </span>
<span class="comments">;*      18 FEB 2011 - C KENT    - LINUX 64-BIT MACHINE IDL 8.0: NOMINAL BEHAVIOUR</span>
<span class="comments">;*      14 APR 2011 - C KENT    - WINDOWS 32-BIT IDL 7.1 AND LINUX 64-BIT IDL 8.0 NOMINAL</span>
<span class="comments">;*                                COMPILATION AND OPERATION</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

PRO DOWNLOAD_MOD_SITE,EVENT

  WIDGET_CONTROL, EVENT.TOP,  GET_UVALUE=DL_INFO, /NO_COPY
  WIDGET_CONTROL, EVENT.ID,   GET_UVALUE=ACTION

  IF DL_INFO.IVERBOSE EQ 1 THEN PRINT,'DIMITRI_DOWNLOAD_WD->SITE: STARTING SITE BUTTON ACTION'

<span class="comments">;----------------------------</span>
<span class="comments">; IF NO ACTION (E.G. DUE </span>
<span class="comments">; TO RESIZING THEN DO NOTHING</span>

  IF N_ELEMENTS(ACTION) EQ 0 THEN GOTO,NO_DOWNLOAD

<span class="comments">;----------------------------</span>
<span class="comments">; FIND WHICH BUTTON HAS </span>
<span class="comments">; BEEN PRESSED </span>
  
  RES = WHERE(DL_INFO.SENSORS EQ ACTION,COUNT)
  IF COUNT EQ 0 THEN BEGIN
    PRINT, 'DIMITRI_DOWNLOAD_WD->SITE: FATAL INTERNAL ERROR'
    GOTO,NO_DOWNLOAD
  ENDIF

<span class="comments">;----------------------------</span>
<span class="comments">; SAVE THE CURRENT DIRECTORY </span>
<span class="comments">; AND CHANGE TO OS DEPENDENT FOLDER</span>

  IF DL_INFO.IVERBOSE EQ 1 THEN PRINT,'DIMITRI_DOWNLOAD_WD->SITE: STORING CURRENT DIRECTORY AND CHANGIN TO LOCATION OF BROWSER'
  CD,CURRENT=CURRENT_DIR
  CD,DL_INFO.BROWSE_STR
  COMMAND = DL_INFO.BROWSER+' '+DL_INFO.S_WEBS[RES]

<span class="comments">;----------------------------</span>
<span class="comments">; SPAWN THE COMMAND TO OPEN </span>
<span class="comments">; THE WEB BROWSER</span>

  IF DL_INFO.IVERBOSE EQ 1 THEN PRINT,'DIMITRI_DOWNLOAD_WD->SITE: SPAWNING THE COMMAND'
  CASE STRUPCASE(!VERSION.OS_FAMILY) OF 
    'WINDOWS' : SPAWN,COMMAND,/NOWAIT,/NOSHELL
    'UNIX'    : SPAWN,COMMAND+'&'
  ENDCASE

<span class="comments">;----------------------------</span>
<span class="comments">; RESET TO THE CURRENT DIRECTORY </span>
<span class="comments">; AND RETURN TO THE WIDGET</span>

  IF DL_INFO.IVERBOSE EQ 1 THEN PRINT,'DIMITRI_DOWNLOAD_WD->SITE: RESETTING THE DIRECTORY AND RELOADING THE WIDGET'
  CD,CURRENT_DIR
  NO_DOWNLOAD:
  WIDGET_CONTROL,EVENT.TOP,SET_UVALUE=DL_INFO,/NO_COPY

END

<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

PRO DOWNLOAD_MOD_OPTION,EVENT

  WIDGET_CONTROL, EVENT.TOP,  GET_UVALUE=DL_INFO, /NO_COPY
  WIDGET_CONTROL, EVENT.ID,   GET_UVALUE=ACTION

  IF DL_INFO.IVERBOSE EQ 1 THEN PRINT,'DIMITRI_DOWNLOAD_WD->OPTION: STARTING OPTION WIDGET'

<span class="comments">;----------------------------</span>
<span class="comments">; IF NO ACTION (E.G. DUE </span>
<span class="comments">; TO RESIZING THEN DO NOTHING</span>

  IF N_ELEMENTS(ACTION) EQ 0 THEN GOTO,NO_OPTION

<span class="comments">;----------------------------</span>
<span class="comments">; DEPENDING ON ACTION SELECTED, </span>
<span class="comments">; EITHER CLOSE THE WIDGET OR </span>
<span class="comments">; LOAD THE USER MANUAL</span>

  CASE ACTION OF
    'CLOSE':BEGIN
    IF DL_INFO.IVERBOSE EQ 1 THEN PRINT,'DIMITRI_DOWNLOAD_WD->OPTION: CLOSING THE DOWNLOAD WIDGET'
              WIDGET_CONTROL, EVENT.TOP, /DESTROY
              RETURN
            END
  
    'HELP': BEGIN
    IF DL_INFO.IVERBOSE EQ 1 THEN PRINT,'DIMITRI_DOWNLOAD_WD->SITE: LOADING THE USER MANUAL'
            <span class="comments">;SPAWN THE HELP FILE (PDF IF WINDOWS, EMACS/GEDIT TXT FILE)</span>
            <span class="comments">;</span>
            END
  ENDCASE

  IF DL_INFO.IVERBOSE EQ 1 THEN PRINT,'DIMITRI_DOWNLOAD_WD->SITE: RELOADING THE WIDGET'
  NO_OPTION:
  WIDGET_CONTROL, EVENT.TOP,SET_UVALUE=DL_INFO,/NO_COPY

END

<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

PRO DIMITRI_DOWNLOAD_WD,VERBOSE=VERBOSE,GROUP_LEADER=GROUP_LEADER

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_DOWNLOAD_WD: STARTING MODULE'

<span class="comments">;----------------------------</span>
<span class="comments">; SET INITIAL PARAMETERS</span>

  IF KEYWORD_SET(VERBOSE) THEN IVERBOSE = 1 ELSE IVERBOSE = 0
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_DOWNLOAD_WD: DEFINING WEBSITE PARAMETERS'
  MATCH   = 0
  DRIVES  = ['A','B','C','D']
  SENSORS = ['CAL/VAL PORTAL','AATSR','ATSR2','MERIS','MODISA','PARASOL','VEGETATION']
  S_WEBS  = [$
          'http://calvalportal.ceos.org/cvp/web/guest/home',$
          'http://ats-merci-uk.eo.esa.int:8080/merci/welcome.do',$
          'http://ats-merci-uk.eo.esa.int:8080/merci/welcome.do',$
          'http://merci-srv.eo.esa.int/merci/welcome.do',$
          'http://ladsweb.nascom.nasa.gov/data/search.html',$
          'http://polder.cnes.fr/',$
          'http://suvweb.vgt.vito.be/suv/index.jsp'$
          ] 

  S_TEXT  = [$
          ': The CEOS CAL/VAL Portal',$
          ': The AATSR MERCI Catalogue',$
          ': The ATSR2 MERCI Catalogue',$
          ': The MERIS MERCI Catalogue',$
          ': The LAADS L1 Data Ordering Webpage',$
          ': The PARASOL Product Distribution Centre',$
          ': The VEGETATION User Services Website'$
          ] 

<span class="comments">;----------------------------</span>
<span class="comments">; FIND WEB BROWSERS DEPENDING ON OS TYPE,</span>
<span class="comments">; WINDOWS--> IEXPLORE</span>
<span class="comments">; LINUX-->FIREFOX</span>
<span class="comments">; MAC-->SAFARI</span>

  CASE STRUPCASE(!VERSION.OS_FAMILY) OF 
  'WINDOWS':begin
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_DOWNLOAD_WD: WINDOWS USER, FINDING IEXPLORE'
              TT = 0
              WHILE MATCH EQ 0 DO BEGIN
                BROWSE_STR = DRIVES[TT]+':\Program Files\Internet Explorer\'      
                BROWSER = 'iexplore.exe'
                RES = FILE_INFO(BROWSE_STR)
                IF RES.DIRECTORY EQ 1 THEN MATCH=1
                TT++
                IF TT EQ N_ELEMENTS(DRIVES) THEN GOTO,NO_MATCH
              ENDWHILE
            END
  'UNIX':   BEGIN
            CASE STRUPCASE(!VERSION.OS) OF 
              'LINUX':  BEGIN
                          IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_DOWNLOAD_WD: LINUX USER, FINDING FIREFOX'
                          CD,CURRENT=CDIR
                          BROWSE_STR = CDIR
                          BROWSER = 'firefox'
                          <span class="comments">;RES = FILE_SEARCH(BROWSE_STR,/TEST_DIRECTORY)</span>
                          <span class="comments">;IF RES[0] EQ '' THEN GOTO, NO_MATCH</span>
                          <span class="comments">;BROWSE_STR = RES[N_ELEMENTS(RES)-1]+'/'</span>
                          MATCH=1
              
                        END
              'DARWIN': BEGIN
                          IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_DOWNLOAD_WD: MAC USER, USING "OPEN"'
                          CD,CURRENT=CDIR
                          BROWSE_STR = CDIR
                          BROWSER = 'open'
                          MATCH=1
          
                        END
      
            ENDCASE
            END
  ENDCASE

  NO_MATCH:
  IF MATCH EQ 0 THEN BEGIN
    PRINT, 'DIMITRI_DOWNLOAD_WD: NO MATCHES FOUND, WIDGET WILL NOT BE DISPLAYED'
    RETURN
  ENDIF

<span class="comments">;----------------------------</span>
<span class="comments">; DEFINE DIMENSIONS OF WIDGET</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_DOWNLOAD_WD: DEFINING DIMENSIONS OF WIDGET'
  DIMS  = GET_SCREEN_SIZE()
  XSIZE = 370
  YSIZE = 180
  XLOC  = (DIMS[0]/2)-(XSIZE/2)
  YLOC  = (DIMS[1]/2)-(YSIZE/2)
  TITLE = 'DIMITRI V2.0: DATA DOWNLOAD'
  BTSIZE = 120

<span class="comments">;----------------------------</span>
<span class="comments">; DEFINE WIDGET BASE</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_DOWNLOAD_WD: CREATING WIDGET AND BUTTONS'
  DWNL_TLB       = WIDGET_BASE(COL=1,XOFFSET=XLOC,YOFFSET=YLOC,TITLE=TITLE)
  DWNL_TLB_LINK  = WIDGET_BASE(DWNL_TLB,ROW=7,FRAME=1)

<span class="comments">;----------------------------</span>
<span class="comments">; CREATE BUTTONS FOR EACH SENSOR</span>

  FOR I=0,N_ELEMENTS(SENSORS)-1 DO BEGIN 
    TEMP = WIDGET_BUTTON(DWNL_TLB_LINK,VALUE=SENSORS[I],UVALUE=SENSORS[I],XSIZE=BTSIZE,EVENT_PRO='DOWNLOAD_MOD_SITE')
    TEMP = WIDGET_LABEL( DWNL_TLB_LINK,VALUE=S_TEXT[I])
  ENDFOR

<span class="comments">;----------------------------</span>
<span class="comments">; ADD THE HELP AND CLOSE BUTTONS</span>

  DWNL_TLB_OPTIONS = WIDGET_BASE(DWNL_TLB,ROW=1,/ALIGN_RIGHT)
  <span class="comments">;TEMP = WIDGET_BUTTON(DWNL_TLB_OPTIONS,VALUE='Help',UVALUE='HELP',XSIZE=BTSIZE,EVENT_PRO='DOWNLOAD_MOD_OPTION')</span>
  TEMP = WIDGET_BUTTON(DWNL_TLB_OPTIONS,VALUE='Close',UVALUE='CLOSE',XSIZE=BTSIZE-20,EVENT_PRO='DOWNLOAD_MOD_OPTION')

<span class="comments">;----------------------------</span>
<span class="comments">; STORE ALL INFO</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_DOWNLOAD_WD: CREATE STRUCTURE TO CONTAIN ALL DATA'
  DL_INFO = {$
              SENSORS:SENSORS         ,$
              S_WEBS:S_WEBS           ,$
              S_TEXT:S_TEXT           ,$
              BROWSER:BROWSER         ,$
              IVERBOSE:IVERBOSE       ,$
              BROWSE_STR:BROWSE_STR       $
            }

<span class="comments">;----------------------------</span>
<span class="comments">; REALISE THE WIDGET AND REGISTER </span>
<span class="comments">; IT WITH THE X-MANAGER</span>
  
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_DOWNLOAD_WD: REALISING THE WIDGET AND REGISTERING WITH XMANAGER'  
  IF KEYWORD_SET(GROUP_LEADER) THEN WIDGET_CONTROL, DWNL_TLB, /REALIZE, SET_UVALUE=DL_INFO, /NO_COPY,GROUP_LEADER=GROUP_LEADER $
    ELSE WIDGET_CONTROL, DWNL_TLB, /REALIZE, SET_UVALUE=DL_INFO, /NO_COPY
  XMANAGER,'DOWNLOAD_OBJECT', DWNL_TLB

END
</code>
    </div>
  </body>
</html>