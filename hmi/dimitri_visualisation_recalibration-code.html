<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:50:53 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dimitri_visualisation_recalibration.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dimitri_visualisation_recalibration.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      DIMITRI_VISUALISATION_RECALIBRATION     </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      THIS PROGRAM AUTOMATICALLY SEARCHES AND RETRIEVES THE RECALIBRATED REFLECTANCE </span>
<span class="comments">;*      OUTPUT BY DIMITRI GIVEN AN OUTPUT FOLDER, REFERENCE SENSOR CONFIGURATION.</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = DIMITRI_VISUALISATION_RECALIBRATION(RC_FOLDER,VR_REGION,DIMITRI_BAND,$</span>
<span class="comments">;*                            REF_SENSOR,REF_PROC_VER,NB_XELEMENTS,SENS_CONFIGS)      </span>
<span class="comments">;*</span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      RC_FOLDER     - A STRING OF THE FULL PATH FOR THE DOUBLET_EXTRACTION OUTPUT FOLDER</span>
<span class="comments">;*      VR_REGION     - A STRING OF THE DIMITRI VALIDATION SITE REQUESTED</span>
<span class="comments">;*      DIMITRI_BAND  - THE REQUIRED DIMITRI BAND INDEX (STARTS FROM 0)</span>
<span class="comments">;*      REF_SENSOR    - A STRING OF THE REFERENCE SENSOR UTILISED FOR PROCESSING</span>
<span class="comments">;*      REF_PROC_VER  - A STRING OF THE REFERENCE SENSOR'S PROCESSING VERSION </span>
<span class="comments">;*      NB_XELEMENTS  - THE TOTAL NUMBER OF X ELEMENTS ALLOWED TO BE RETURNED</span>
<span class="comments">;*      SENS_CONFIGS  - A STRING ARRAY OF THE SENSOR CONFIGURATIONS RETURNED BY</span>
<span class="comments">;*                      DIMITRI_VISUALISATION_REFLECTANCE.pro</span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      VERBOSE - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      A STRUCTURE WITH THE FOLLOWING TAGS:</span>
<span class="comments">;*      ERROR             - THE ERROR STATUS CODE, 0 = NOMINAL, 1 OR -1 = ERROR</span>
<span class="comments">;*      DATA              - AN ARRAY CONTAINING ALL RECALIBRATED DATA</span>
<span class="comments">;*      SENS_CONFIG_ABLE  - AN INTEGER ARRAY DESCRIBING IF DATA IS AVAILABLE FOR A</span>
<span class="comments">;*                          CERTAIN SENSOR CONFIGURATION</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      08 FEB 2011 - C KENT    - DIMITRI-2 V1.0</span>
<span class="comments">;*      04 JUL 2011 - C KENT    - ADDED AUX INFO TO INTERNAL SAV</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      08 FEB 2011 - C KENT    - WINDOWS 32-BIT MACHINE IDL 7.1/IDL 8.0: NOMINAL </span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION DIMITRI_VISUALISATION_RECALIBRATION,RC_FOLDER,VR_REGION,DIMITRI_BAND,REF_SENSOR,REF_PROC_VER,$
                                             SENS_CONFIGS,VERBOSE=VERBOSE

  NB_XELEMENTS = 100000L
  NUM_NON_REFS = 5+12

<span class="comments">;--------------------------------</span>
<span class="comments">; FIND ALL CORRESPONDING DOUBLET </span>
<span class="comments">; EXTRACTION FILES </span>

  CAL_STR = 'RECAL_'+VR_REGION+'_*_REF_'+REF_SENSOR+'_'+REF_PROC_VER+'.dat'

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_RCAL: SEARCHING FOR RECAL DATA'
  CAL_FILES = FILE_SEARCH(RC_FOLDER,CAL_STR)

<span class="comments">;-----------------------------------------</span>
<span class="comments">; RETRIEVE THE SITE TYPE</span>

  SITE_TYPE = GET_SITE_TYPE(VR_REGION)

<span class="comments">;--------------------------------  </span>
<span class="comments">; CREATE AN ARRAY TO HOLD ALL TIME </span>
<span class="comments">; AND REFLECTANCE DATA FOR EACH </span>
<span class="comments">; SENSOR CONFIGURATION</span>

  NUM_SENS_CONFIGS  = N_ELEMENTS(SENS_CONFIGS)
  RCAL_DATA         = MAKE_ARRAY(NB_XELEMENTS,NUM_SENS_CONFIGS,2,/DOUBLE)
  SENS_CONFIG_ABLE  = MAKE_ARRAY(N_ELEMENTS(SENS_CONFIGS),/INTEGER,VALUE=0)

  IF STRCMP(CAL_FILES[0],'') EQ 1 THEN BEGIN
    PRINT, 'DIMITRI_VISU_RCAL: NO RECAL DATA FOUND, RETURNING'
    RETURN,{ERROR:1,DATA:RCAL_DATA,SENS_CONFIG_ABLE:SENS_CONFIG_ABLE}
  ENDIF

<span class="comments">;-------------------------------- </span>
<span class="comments">; RESTORE CAL FILES AND STORE </span>
<span class="comments">; THE DATA  </span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_RCAL: STARTING LOOP ON ALL CAL-SENSOR FILES'
  FOR I=0,N_ELEMENTS(CAL_FILES)-1 DO BEGIN

<span class="comments">;-------------------------------- </span>
<span class="comments">; GET SENSOR CONFIGURATION FROM FILENAME</span>

    POS   = STRPOS(CAL_FILES[I],VR_REGION,/REVERSE_SEARCH)+STRLEN(VR_REGION)+1
    POS1  = STRPOS(CAL_FILES[I],'REF',/REVERSE_SEARCH)-1
    TMP   = STRMID(CAL_FILES[I],POS,POS1-POS)
    RESTORE,CAL_FILES[I] 

    POS = WHERE(STRCMP(SENS_CONFIGS,TMP) EQ 1)
    IF POS[0] EQ -1 OR N_ELEMENTS(POS) GT 1 THEN GOTO,NEXT_FILE
    SENS_CONFIG_ABLE[POS] = 1

<span class="comments">;--------------------------------</span>
<span class="comments">; GET SENSOR BAND INDEX</span>

    SENS_NAME = STRSPLIT(TMP,'_',/EXTRACT)
    SENS_NAME = SENS_NAME[0]

<span class="comments">;-----------------------------------------</span>
<span class="comments">; MODISA SURFACE DEPENDANCE EXCEPTION</span>

  IF SENS_NAME EQ 'MODISA' THEN BEGIN
    IF STRUPCASE(SITE_TYPE) EQ 'OCEAN' THEN TEMP_SENSOR = SENS_NAME+'_O' ELSE TEMP_SENSOR = SENS_NAME+'_L'
  ENDIF ELSE TEMP_SENSOR = SENS_NAME

    IDX = GET_SENSOR_BAND_INDEX(TEMP_SENSOR,DIMITRI_BAND)
    IF IDX lt 0 THEN GOTO,NEXT_FILE

<span class="comments">;--------------------------------</span>
<span class="comments">; STORE TIME AND REFLECTANCE DATA</span>

    TEMP_ELEMENTS = N_ELEMENTS(CAL_DATA[0,*])
    TMP_DATE = DOUBLE(CAL_DATA[0,*])
    TMP_REFL = DOUBLE(CAL_DATA[NUM_NON_REFS+IDX,*])
    SORT_IDX = SORT(TMP_DATE)

    RCAL_DATA[0:TEMP_ELEMENTS-1,POS,0] = TMP_DATE[SORT_IDX]
    RCAL_DATA[0:TEMP_ELEMENTS-1,POS,1] = TMP_REFL[SORT_IDX]
 
    NEXT_FILE:
  ENDFOR

<span class="comments">;--------------------------------      </span>
<span class="comments">; RETURN ALL DATA IN A STRUCTURE</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_RCAL: RETURNING RECAL DATA STRUCTURE'  
  VISU_RCAL = {                                             $
              ERROR:0                                       ,$
              DATA:RCAL_DATA                                ,$
              SENS_CONFIG_ABLE:SENS_CONFIG_ABLE             $
              }

  RETURN,VISU_RCAL

END
</code>
    </div>
  </body>
</html>