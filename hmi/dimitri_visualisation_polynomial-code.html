<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:40 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dimitri_visualisation_polynomial.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dimitri_visualisation_polynomial.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      DIMITRI_VISUALISATION_POLYNOMIAL     </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      THIS PROGRAM AUTOMATICALLY SERACHES AND RETRIEVES THE POLYNOMIAL COEFICIENTS </span>
<span class="comments">;*      OUTPUT BY DIMITRI GIVEN AN OUTPUT FOLDER AND REFERENCE SENSOR CONFIGURATION.</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = DIMITRI_VISUALISATION_POLYNOMIAL(IC_FOLDER,IC_REGION,DIMITRI_WL,REF_SENSOR,$</span>
<span class="comments">;*                                       REF_PROC_VER,NEW_X_INFO,SENS_CONFIGS)      </span>
<span class="comments">;*</span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      IC_FOLDER     - A STRING OF THE FULL PATH FOR THE DOUBLET_EXTRACTION OUTPUT FOLDER</span>
<span class="comments">;*      IC_REGION     - A STRING OF THE DIMITRI VALIDATION SITE REQUESTED</span>
<span class="comments">;*      DIMITRI_WL    - A STRING OF THE DIMITRI WAVELENGTH (E.G. '555')</span>
<span class="comments">;*      REF_SENSOR    - A STRING OF THE REFERENCE SENSOR UTILISED FOR PROCESSING</span>
<span class="comments">;*      REF_PROC_VER  - A STRING OF THE REFERENCE SENSOR'S PROCESSING VERSION </span>
<span class="comments">;*      NEW_X_INFO    - A FLOAT ARRAY OF THE X DATA TO BE USED TO GENERATE THE POLYNOMIAL Y DATA</span>
<span class="comments">;*      SENS_CONFIGS  - A STRING ARRAY OF THE SENSOR CONFIGURATIONS RETURNED BY</span>
<span class="comments">;*                      DIMITRI_VISUALISATION_REFLECTANCE.pro</span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      VERBOSE - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      A STRUCTURE WITH THE FOLLOWING TAGS:</span>
<span class="comments">;*      ERROR             - THE ERROR STATUS CODE, 0 = NOMINAL, 1 OR -1 = ERROR</span>
<span class="comments">;*      DATA              - AN ARRAY CONTAINING ALL POLYNOMINAL DATA</span>
<span class="comments">;*      SENS_CONFIG_ABLE  - AN INTEGER ARRAY DESCRIBING IF DATA IS AVAILABLE FOR A</span>
<span class="comments">;*                          CERTAIN SENSOR CONFIGURATION</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      08 FEB 2011 - C KENT    - DIMITRI-2 V1.0</span>
<span class="comments">;*      08 JUL 2011 - C KENT    - MAJOR UPDATES, NOW READS OUTPUT INTERCAL SAV WHICH CONTAINS TIME, </span>
<span class="comments">;*                                DIFFERENCE TO REFERENCE SENSOR AND POLYNOMIAL DIFFERENCE</span>
<span class="comments">;*      25 JUL 2011 - C KENT    - MINOR BUG FIX DURING POLYNOMIAL DATA RETRIEVAL</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      08 FEB 2011 - C KENT    - WINDOWS 32-BIT MACHINE IDL 7.1/IDL 8.0: NOMINAL </span>
<span class="comments">;*      14 APR 2011 - C KENT    - WINDOWS 32-BIT IDL 7.1 AND LINUX 64-BIT IDL 8.0 NOMINAL</span>
<span class="comments">;*                                COMPILATION AND OPERATION</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION DIMITRI_VISUALISATION_POLYNOMIAL,IC_FOLDER,IC_REGION,DIMITRI_WL,REF_SENSOR,$
                                          REF_PROC_VER,NEW_X_INFO,SENS_CONFIGS,VERBOSE=VERBOSE

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_POLY: STARTING RETRIEVAL OF DIMITRI POLYNOMIAL DATA'
  
<span class="comments">;--------------------------------  </span>
<span class="comments">; GET RELATED SENSOR INDEX BASED </span>
<span class="comments">; ON DIMITRI BAND ID</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_POLY: SEARCHING FOR POLYNOMIAL DATA'    
  <span class="comments">;CAL_STR   = STRING('ICOEF_'+IC_REGION+'*REF_'+REF_SENSOR+'_'+REF_PROC_VER+'_'+DIMITRI_WL+'.dat')</span>
  CAL_STR   = STRING('ICDIF_'+IC_REGION+'*REF_'+REF_SENSOR+'_'+REF_PROC_VER+'_'+DIMITRI_WL+'.dat')
  <span class="comments">;ERR_STR   = STRING('ICERR_'+IC_REGION+'*REF_'+REF_SENSOR+'_'+REF_PROC_VER+'_'+DIMITRI_WL+'.dat')</span>
  CAL_FILES = FILE_SEARCH(IC_FOLDER,CAL_STR)
  <span class="comments">;ERR_FILES = FILE_SEARCH(IC_FOLDER,ERR_STR)</span>

<span class="comments">;-------------------------------- </span>
<span class="comments">; GET LIST OF ALL SENSOR CONFIGS </span>
<span class="comments">; AND CREATE ARRAY TO HOLD DATA</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_POLY: DEFINING ARRAY TO HOLD ALL DATA'
  NUM_SENS_CONFIGS  = N_ELEMENTS(SENS_CONFIGS)
  SENS_CONFIG_ABLE  = MAKE_ARRAY(N_ELEMENTS(SENS_CONFIGS),/INTEGER,VALUE=0)
<span class="comments">;  diff_DATA         = MAKE_ARRAY(N_ELEMENTS(NEW_X_INFO),NUM_SENS_CONFIGS)</span>
<span class="comments">;  POLY_DATA         = MAKE_ARRAY(N_ELEMENTS(NEW_X_INFO),NUM_SENS_CONFIGS,2)</span>
  DIFF_DATA         = MAKE_ARRAY(5000,NUM_SENS_CONFIGS,2)
  POLY_DATA         = MAKE_ARRAY(5000,NUM_SENS_CONFIGS,2)
  POLYMIN           = 0
  POLYMAX           = 1

<span class="comments">;-------------------------------- </span>
<span class="comments">; IF NO POLYNOMIAL DATA FOUND </span>
<span class="comments">; THEN RETURN</span>
  
  IF STRCMP(CAL_FILES[0],'') EQ 1 THEN BEGIN
    PRINT, 'DIMITRI_VISU_POLY: NO POLYNOMIAL DATA FOUND, RETURNING'
    RETURN,{ERROR:0,POLY_DATA:POLY_DATA,DIFF_DATA:DIFF_DATA,SENS_CONFIG_ABLE:SENS_CONFIG_ABLE,POLYMIN:POLYMIN,POLYMAX:POLYMAX}
  ENDIF

<span class="comments">;--------------------------------  </span>
<span class="comments">; RESTORE THE DIFFERENCE AND NEW </span>
<span class="comments">; POLYNOMIAL DATA</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_POLY: STARTING LOOP ON ALL CAL-SENSOR FILES'
  FOR I=0,N_ELEMENTS(CAL_FILES)-1 DO BEGIN
  
<span class="comments">;-------------------------------- </span>
<span class="comments">; GET SENSOR CONFIGURATION FROM FILENAME</span>

    POS   = STRPOS(CAL_FILES[I],IC_REGION,/REVERSE_SEARCH)+STRLEN(IC_REGION)+1
    POS1  = STRPOS(CAL_FILES[I],'REF',/REVERSE_SEARCH)-1
    TMP   = STRMID(CAL_FILES[I],POS,POS1-POS)

    POS = WHERE(STRCMP(SENS_CONFIGS,TMP) EQ 1)
    IF POS[0] EQ -1 OR N_ELEMENTS(POS) GT 1 THEN GOTO,NEXT_FILE
    SENS_CONFIG_ABLE[POS] = 1
    RESTORE,CAL_FILES[I]

    TMP = N_ELEMENTS(ICDIFF_DATA[*,0])
    DIFF_DATA[0:TMP-1,POS,0] = ICDIFF_DATA[*,0]
    DIFF_DATA[0:TMP-1,POS,1] = ICDIFF_DATA[*,1]
    POLY_DATA[0:TMP-1,POS,0] = ICDIFF_DATA[*,0]
    POLY_DATA[0:TMP-1,POS,1] = ICDIFF_DATA[*,2]

    TMIN = MIN([ICDIFF_DATA[*,1],ICDIFF_DATA[*,2]])
    TMAX = MAX([ICDIFF_DATA[*,1],ICDIFF_DATA[*,2]])
    
    IF TMIN LT POLYMIN THEN POLYMIN = TMIN 
    IF TMAX GT POLYMAX THEN POLYMAX = TMAX 


<span class="comments">;    POLY_DATA[*,POS] = POLY_COEFS[0]+POLY_COEFS[1]*NEW_X_INFO+POLY_COEFS[2]*(NEW_X_INFO)^2</span>
<span class="comments">;</span>
<span class="comments">;    RESTORE,ERR_FILES[I]</span>
<span class="comments">;    TMP = N_ELEMENTS(ERRORS_OUTPUT[*,0])</span>
<span class="comments">;    POLY_ERR_DATA[0:TMP-1,POS,0] = ERRORS_OUTPUT[*,0]</span>
<span class="comments">;    POLY_ERR_DATA[0:TMP-1,POS,1] = ERRORS_OUTPUT[*,1]  </span>
    
    NEXT_FILE:
  ENDFOR

<span class="comments">;--------------------------------  </span>
<span class="comments">; RETURN ALL DATA IN A STRUCTURE</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_POLY: RETURNING POLYNOMIAL DATA STRUCTURE'
  VISU_POLY = {                                              $
              ERROR:0                                       ,$
              POLY_DATA:POLY_DATA                           ,$
              DIFF_DATA:DIFF_DATA                           ,$
              POLYMIN:POLYMIN                               ,$
              POLYMAX:POLYMAX                               ,$
              SENS_CONFIG_ABLE:SENS_CONFIG_ABLE              $
              }

  RETURN,VISU_POLY

END
</code>
    </div>
  </body>
</html>