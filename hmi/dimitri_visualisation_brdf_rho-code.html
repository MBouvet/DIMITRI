<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:50:53 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dimitri_visualisation_brdf_rho.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dimitri_visualisation_brdf_rho.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      DIMITRI_VISUALISATION_BRDF_RHO     </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      THIS PROGRAM AUTOMATICALLY SERACHES AND RETRIEVES THE SIMULATED RHO VALUES </span>
<span class="comments">;*      OUTPUT BY DIMITRI GIVEN AN OUTPUT FOLDER AND REFERENCE SENSOR CONFIGURATION.</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = DIMITRI_VISUALISATION_BRDF_RHO(SR_FOLDER,SR_REGION,REF_SENSOR, $</span>
<span class="comments">;*                                            REF_PROC_VER,DIMITRI_BAND)      </span>
<span class="comments">;*</span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      SR_FOLDER     - A STRING OF THE FULL PATH FOR THE DOUBLET_EXTRACTION OUTPUT FOLDER</span>
<span class="comments">;*      SR_REGION     - A STRING OF THE DIMITRI VALIDATION SITE REQUESTED</span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      VERBOSE - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      A STRUCTURE WITH THE FOLLOWING TAGS:</span>
<span class="comments">;*      ERROR             - THE ERROR STATUS CODE, 0 = NOMINAL, 1 OR -1 = ERROR</span>
<span class="comments">;*      DATA              - AN ARRAY CONTAINING ALL POLYNOMINAL DATA</span>
<span class="comments">;*      NUM_SENS_CONFIGS  - THE NUMBER OF FOUND VIEWING GEOMETRY CONFIGURATIONS</span>
<span class="comments">;*      SENSOR_CONFIGS    - A STRING ARRAY OF THE VIEWING GEOMTRY CONFIGURATIONS</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      09 FEB 2011 - C KENT    - DIMITRI-2 V1.0</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      09 FEB 2011 - C KENT    - WINDOWS 32-BIT MACHINE IDL 7.1/IDL 8.0: NOMINAL </span>
<span class="comments">;*      14 APR 2011 - C KENT    - WINDOWS 32-BIT IDL 7.1 AND LINUX 64-BIT IDL 8.0 NOMINAL</span>
<span class="comments">;*                               COMPILATION AND OPERATION</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION DIMITRI_VISUALISATION_BRDF_RHO,SR_FOLDER,SR_REGION,REF_SENSOR,REF_PROC_VER,DIMITRI_BAND

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_BRDF: STARTING RETRIEVAL OF SIMULATED DATA'

<span class="comments">;--------------------------------</span>
<span class="comments">; FIND ALL CORRESPONDING TOA </span>
<span class="comments">; SIMULATION FILES </span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_BRDF: SEARCHING FOR SIMULATED DATA'
  RHO_STR   = STRING('ROUJEAN_TOA_SPECTRUM_'+SR_REGION+'_'+REF_SENSOR+'_'+REF_PROC_VER+'*.dat')
  RHO_FILES = FILE_SEARCH(SR_FOLDER,RHO_STR)

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_BRDF: DEFINING ARRAY TO HOLD ALL DATA'  
  NB_BRDF_CONFIGS = N_ELEMENTS(RHO_FILES)
  NB_X            = 7300
  BRDF_RHO        = MAKE_ARRAY(NB_X,NB_BRDF_CONFIGS,2,/DOUBLE)
  BRDF_CONFIGS    = STRARR(NB_BRDF_CONFIGS)
  MAX_X           = 0

<span class="comments">;-------------------------------- </span>
<span class="comments">; IF NO simulated DATA FOUND </span>
<span class="comments">; THEN RETURN</span>
  
  IF STRCMP(RHO_FILES[0],'') EQ 1 THEN BEGIN
    PRINT, 'DIMITRI_VISU_BRDF: NO DATA FOUND, RETURNING'
    RETURN,{ERROR:1,DATA:BRDF_RHO,NUM_SENS_CONFIGS:NB_BRDF_CONFIGS,SENSOR_CONFIGS:BRDF_CONFIGS}
  ENDIF

<span class="comments">;--------------------------------  </span>
<span class="comments">; GET RELATED SENSOR INDEX BASED </span>
<span class="comments">; ON DIMITRI BAND ID</span>

  IF KEYWORD_SET(VERBOSE) THEN SENSOR_INDEX = GET_SENSOR_BAND_INDEX(REF_SENSOR,DIMITRI_BAND,/VERBOSE) $
    ELSE SENSOR_INDEX = GET_SENSOR_BAND_INDEX(REF_SENSOR,DIMITRI_BAND)

<span class="comments">;-------------------------------- </span>
<span class="comments">; LOOP OVER EACH FILE, EXTRACT THE </span>
<span class="comments">; VIEWING GEOMETRY CONFIGURATION </span>
<span class="comments">; AND STORE THE SORTED DATE AND </span>
<span class="comments">; REFLECTANCE INFORMATION</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_BRDF: STARTING LOOP TO RESTORE SIMULATED DATA'
  FOR I=0,NB_BRDF_CONFIGS-1 DO BEGIN

    POS             = STRPOS(RHO_FILES[I],REF_PROC_VER,/REVERSE_SEARCH)+STRLEN(REF_PROC_VER)+1
    POS_END         = STRPOS(RHO_FILES[I],'.dat',/REVERSE_SEARCH)
    BRDF_CONFIGS[I] = STRMID(RHO_FILES[I],POS,POS_END-POS)

    RESTORE,RHO_FILES[I]
    TEMP_DATE = TOA_SPECTRUM[0,*]
    TEMP_RHO  = TOA_SPECTRUM[4+SENSOR_INDEX,*]
    SORT_IDX  = SORT(TEMP_DATE)
    TMP       = N_ELEMENTS(TEMP_DATE)
    IF TMP GT MAX_X THEN MAX_X = TMP

    BRDF_RHO[0:TMP-1,I,0] = TEMP_DATE[SORT_IDX]
    BRDF_RHO[0:TMP-1,I,1] = TEMP_RHO[SORT_IDX]

  ENDFOR

<span class="comments">;-------------------------------- </span>
<span class="comments">; CUT DOWN THE DATA ARRAY TO THE </span>
<span class="comments">; MAXIMUM DATE RANGE</span>

  BRDF_RHO = BRDF_RHO[0:MAX_X-1,*,*]

<span class="comments">;-------------------------------- </span>
<span class="comments">; RETURN THE TOA RHO ARRAY</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DIMITRI_VISU_BRDF: RETURNING SIMULATED DATA STRUCTURE' 
  VISU_BRDF = {                                             $
              ERROR:0                                      ,$
              DATA:BRDF_RHO                                ,$
              NUM_SENS_CONFIGS:NB_BRDF_CONFIGS             ,$
              SENSOR_CONFIGS:BRDF_CONFIGS                  $
              }

  RETURN,VISU_BRDF

END
</code>
    </div>
  </body>
</html>