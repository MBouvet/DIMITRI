<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:50:50 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>dhmi_cs_setup.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="dhmi_cs_setup.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      DHMI_CS_SETUP     </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      THIS PROGRAM GENERATES AN INTERFACE WIDGET ALLOWING SELECTION OF PARAMETERS FOR </span>
<span class="comments">;*      THE DIMITRI CLOUD SCREENING MODULE. THE WIDGET USES THE USER SELECTED SITE, REGION, </span>
<span class="comments">;*      PROCESSING VERSION AND YEAR AND SEARCHES FOR THE CORRESPONDING FILES WITHIN THE </span>
<span class="comments">;*      DIMITRI DATABASE. THIS INDEX IS THEN PASSED TO THE DIMITRI CLOUD SREENING MODULE </span>
<span class="comments">;*      ALONG WITH THE DATABASE DATA</span>
<span class="comments">;*</span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      DHMI_CS_SETUP     </span>
<span class="comments">;*</span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      GROUP_LEADER  - ID OF THE WIDGET TO BE USED AS THE GROUP LEADER</span>
<span class="comments">;*      VERBOSE       - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      DHMI_DATABASE - CONTAINS THE DATABASE DATA FOR THE DIMITRI HMI</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      12 MAR 2011 - C KENT    - DIMITRI-2 V1.0</span>
<span class="comments">;*      13 MAR 2011 - C KENT    - ADDED VERBOSE COMMENTS</span>
<span class="comments">;*      21 MAR 2011 - C KENT    - MODIFIED FILE DEFINITION TO USE GET_DIMITRI_LOCATION</span>
<span class="comments">;*      06 JUL 2011 - C KENT    - ADDED DATABASE COMMON BLOCK TO DIMITRI HMI</span>
<span class="comments">;*      30 AUG 2011 - C KENT    - REMOVE 'ALL' OPTION FROM SITE/SENSOR/PROCV</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      14 APR 2011 - C KENT    - WINDOWS 32-BIT IDL 7.1 AND LINUX 64-BIT IDL 8.0 NOMINAL</span>
<span class="comments">;*                                COMPILATION AND OPERATION</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

PRO DHMI_CS_SETUP_EXIT,EVENT

<span class="comments">;--------------------------</span>
<span class="comments">; GET EVENT AND WIDGET INFO</span>

  WIDGET_CONTROL, EVENT.TOP,  GET_UVALUE=DHMI_CS_SETUP_INFO, /NO_COPY

<span class="comments">;--------------------------</span>
<span class="comments">; CLEAN UP OBJECTS</span>

  IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->EXIT: DESTROYING FSC OBJECTS'
  OBJ_DESTROY,DHMI_CS_SETUP_INFO.FSCSITE
  OBJ_DESTROY,DHMI_CS_SETUP_INFO.FSCSENS
  OBJ_DESTROY,DHMI_CS_SETUP_INFO.FSCPROC
  OBJ_DESTROY,DHMI_CS_SETUP_INFO.FSCYEAR

<span class="comments">;--------------------------</span>
<span class="comments">; DESTROY THE WIDGET</span>

  IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->EXIT: DESTORYING THE SETUP WIDGET'
  WIDGET_CONTROL,EVENT.TOP,/DESTROY

END

<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

PRO DHMI_CS_SETUP_START,EVENT

COMMON DHMI_DATABASE

<span class="comments">;--------------------------</span>
<span class="comments">; GET EVENT AND WIDGET INFO</span>

  WIDGET_CONTROL, EVENT.TOP,  GET_UVALUE=DHMI_CS_SETUP_INFO, /NO_COPY

<span class="comments">;--------------------------</span>
<span class="comments">; READ UPDATED DATABASE</span>

  IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->START: RETRIEVING LATEST DATABASE VERSION'

<span class="comments">;--------------------------</span>
<span class="comments">; GET SITE, SENSOR,PROCV AND </span>
<span class="comments">; YEAR VALUES</span>

  IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->START: RETRIEVING SITE, SENSOR, PROCV AND YEAR VALUES'
  DHMI_CS_SETUP_INFO.FSCSITE->GETPROPERTY,VALUE=SITE
  DHMI_CS_SETUP_INFO.FSCSENS->GETPROPERTY,VALUE=SENSOR
  DHMI_CS_SETUP_INFO.FSCPROC->GETPROPERTY,VALUE=PROCV
  DHMI_CS_SETUP_INFO.FSCYEAR->GETPROPERTY,VALUE=YEAR
  
  CSITE   = SITE
  CSENSOR = SENSOR
  CPROCV  = PROCV
  IF YEAR   EQ 'ALL' THEN CYEAR   ='*' ELSE CYEAR   = YEAR

<span class="comments">;--------------------------  </span>
<span class="comments">; GET INDEX OF WHERE IN DB_DATA </span>
<span class="comments">; THESE VALUES EXIST</span>

  IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->START: FINDING INDEX OF MATCHING DATABASE RECORDS'
  DB_IDX = WHERE(STRMATCH(DHMI_DB_DATA.REGION,CSITE)              AND $
              STRMATCH(DHMI_DB_DATA.SENSOR,CSENSOR)               AND $
              STRMATCH(DHMI_DB_DATA.PROCESSING_VERSION,CPROCV)    AND $
              STRMATCH(STRTRIM(STRING(DHMI_DB_DATA.YEAR),2),CYEAR)    $
              )

<span class="comments">;-------------------------- </span>
<span class="comments">; SEND DATA TO CLOUD SCREENING MODULE</span>

  IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->START: LOADING THE CLOUD SCREENING MODULE'  
  DHMI_CLOUD_SCREENING,DB_IDX,GROUP_LEADER=EVENT.TOP,VERBOSE=VERBOSE
  <span class="comments">;DHMI_CLOUD_SCREENING,DHMI_CS_SETUP_INFO.DB_DATA,DB_IDX,GROUP_LEADER=EVENT.TOP,VERBOSE=VERBOSE</span>

<span class="comments">;--------------------------</span>
<span class="comments">; RETURN TO THE WIDGET</span>

  WIDGET_CONTROL, EVENT.TOP, SET_UVALUE=DHMI_CS_SETUP_INFO, /NO_COPY

END

<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

PRO DHMI_CS_SETUP_CHANGE,EVENT

COMMON DHMI_DATABASE
  WIDGET_CONTROL, EVENT.TOP,  GET_UVALUE=DHMI_CS_SETUP_INFO, /NO_COPY
  WIDGET_CONTROL, EVENT.ID,   GET_UVALUE=ACTION

<span class="comments">;--------------------------</span>
<span class="comments">; GET THE ACTION TYPE</span>

  ACTION_TYPE = STRMID(ACTION,0,1)

<span class="comments">;--------------------------</span>
<span class="comments">; UPDATE SENSOR VALUE</span>

  IF ACTION_TYPE EQ 'V' THEN BEGIN
    IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->CHANGE: UPDATING THE SITE FIELD AND INDEX'
    CASE ACTION OF
      'VSITE&lt;':DHMI_CS_SETUP_INFO.ISITE = DHMI_CS_SETUP_INFO.ISITE-1
      'VSITE>':DHMI_CS_SETUP_INFO.ISITE = DHMI_CS_SETUP_INFO.ISITE+1
    ENDCASE
    IF DHMI_CS_SETUP_INFO.ISITE LT 0 THEN DHMI_CS_SETUP_INFO.ISITE = DHMI_CS_SETUP_INFO.NASITE-1
    IF DHMI_CS_SETUP_INFO.ISITE EQ DHMI_CS_SETUP_INFO.NASITE THEN DHMI_CS_SETUP_INFO.ISITE = 0 
    
    DHMI_CS_SETUP_INFO.FSCSITE->SETPROPERTY, VALUE=DHMI_CS_SETUP_INFO.ASITE[DHMI_CS_SETUP_INFO.ISITE]

<span class="comments">;--------------------------</span>
<span class="comments">; GET AVAILABLE SENSORS WITHIN REGION</span>

    IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->CHANGE: UPDATING THE SENSOR FIELD AND INDEX'
    CSITE=DHMI_CS_SETUP_INFO.ASITE[DHMI_CS_SETUP_INFO.ISITE]
     
    TEMP = DHMI_DB_DATA.SENSOR[WHERE(STRMATCH(DHMI_DB_DATA.REGION,CSITE))]
    TEMP = TEMP[UNIQ(TEMP,SORT(TEMP))]
    DHMI_CS_SETUP_INFO.ASENS[0:N_ELEMENTS(TEMP)-1] = TEMP<span class="comments">;,'ALL']</span>
    DHMI_CS_SETUP_INFO.NASENS = N_ELEMENTS(TEMP)<span class="comments">;+1</span>
    DHMI_CS_SETUP_INFO.ISENS  = 0
    DHMI_CS_SETUP_INFO.FSCSENS->SETPROPERTY, VALUE=DHMI_CS_SETUP_INFO.ASENS[DHMI_CS_SETUP_INFO.ISENS]  
 
    GOTO,UPDATE_PROC
    
  ENDIF

<span class="comments">;--------------------------</span>
<span class="comments">; UPDATE SENSOR VALUE</span>

  IF ACTION_TYPE EQ 'S' THEN BEGIN
    IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->CHANGE: UPDATING THE SENSOR FIELD AND INDEX'
    CASE ACTION OF
      'SENS&lt;':DHMI_CS_SETUP_INFO.ISENS = DHMI_CS_SETUP_INFO.ISENS-1
      'SENS>':DHMI_CS_SETUP_INFO.ISENS = DHMI_CS_SETUP_INFO.ISENS+1
    ENDCASE
    IF DHMI_CS_SETUP_INFO.ISENS LT 0 THEN DHMI_CS_SETUP_INFO.ISENS = DHMI_CS_SETUP_INFO.NASENS-1
    IF DHMI_CS_SETUP_INFO.ISENS EQ DHMI_CS_SETUP_INFO.NASENS THEN DHMI_CS_SETUP_INFO.ISENS = 0 
    
    DHMI_CS_SETUP_INFO.FSCSENS->SETPROPERTY, VALUE=DHMI_CS_SETUP_INFO.ASENS[DHMI_CS_SETUP_INFO.ISENS]

<span class="comments">;--------------------------</span>
<span class="comments">; GET AVAILABLE PROC_VERS </span>
<span class="comments">; FOR SITE AND SENSOR</span>
    
    UPDATE_PROC:
    IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->CHANGE: UPDATING THE PROCESSING VERSION FIELD AND INDEX'
    CSITE = DHMI_CS_SETUP_INFO.ASITE[DHMI_CS_SETUP_INFO.ISITE]
    CSENS = DHMI_CS_SETUP_INFO.ASENS[DHMI_CS_SETUP_INFO.ISENS]   
  
    TEMP = DHMI_DB_DATA.PROCESSING_VERSION[WHERE($
                                                 STRMATCH(DHMI_DB_DATA.REGION,CSITE) AND $
                                                 STRMATCH(DHMI_DB_DATA.SENSOR,CSENS))]
    TEMP = TEMP[UNIQ(TEMP,SORT(TEMP))]
    DHMI_CS_SETUP_INFO.APROC[0:N_ELEMENTS(TEMP)-1] = TEMP<span class="comments">;,'ALL']</span>
    DHMI_CS_SETUP_INFO.NAPROC = N_ELEMENTS(TEMP)<span class="comments">;+1</span>
    DHMI_CS_SETUP_INFO.IPROC  = 0
    DHMI_CS_SETUP_INFO.FSCPROC->SETPROPERTY, VALUE=DHMI_CS_SETUP_INFO.APROC[DHMI_CS_SETUP_INFO.IPROC]  
 
    GOTO,UPDATE_YEAR
    
  ENDIF

<span class="comments">;--------------------------</span>
<span class="comments">; UPDATE PROC VALUE</span>

  IF ACTION_TYPE EQ 'P' THEN BEGIN
    IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->CHANGE: UPDATING THE PROCESSING VERSION FIELD AND INDEX'
    CASE ACTION OF
      'PROC&lt;':DHMI_CS_SETUP_INFO.IPROC = DHMI_CS_SETUP_INFO.IPROC-1
      'PROC>':DHMI_CS_SETUP_INFO.IPROC = DHMI_CS_SETUP_INFO.IPROC+1
    ENDCASE
    IF DHMI_CS_SETUP_INFO.IPROC LT 0 THEN DHMI_CS_SETUP_INFO.IPROC = DHMI_CS_SETUP_INFO.NAPROC-1
    IF DHMI_CS_SETUP_INFO.IPROC EQ DHMI_CS_SETUP_INFO.NAPROC THEN DHMI_CS_SETUP_INFO.IPROC = 0 
    
    DHMI_CS_SETUP_INFO.FSCPROC->SETPROPERTY, VALUE=DHMI_CS_SETUP_INFO.APROC[DHMI_CS_SETUP_INFO.IPROC]

<span class="comments">;--------------------------</span>
<span class="comments">; GET AVAILABLE YEARS FOR SITE,</span>
<span class="comments">; SENSOR AND PROC VERSION</span>
    
    UPDATE_YEAR:
    IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->CHANGE: UPDATING THE YEAR FIELD AND INDEX'
    CSITE = DHMI_CS_SETUP_INFO.ASITE[DHMI_CS_SETUP_INFO.ISITE]
    CSENS = DHMI_CS_SETUP_INFO.ASENS[DHMI_CS_SETUP_INFO.ISENS]   
    CPROC = DHMI_CS_SETUP_INFO.APROC[DHMI_CS_SETUP_INFO.IPROC]
 
    TEMP = STRTRIM(STRING(DHMI_DB_DATA.YEAR[WHERE($
                                                  STRMATCH(DHMI_DB_DATA.REGION,CSITE)       AND $
                                                  STRMATCH(DHMI_DB_DATA.SENSOR,CSENS)       AND $
                                                  STRMATCH(DHMI_DB_DATA.PROCESSING_VERSION,CPROC))]),2)
    TEMP = TEMP[UNIQ(TEMP,SORT(TEMP))]
    DHMI_CS_SETUP_INFO.AYEAR[0:N_ELEMENTS(TEMP)] = [TEMP,'ALL']
    DHMI_CS_SETUP_INFO.NAYEAR = N_ELEMENTS(TEMP)+1
    DHMI_CS_SETUP_INFO.IYEAR=0
    DHMI_CS_SETUP_INFO.FSCYEAR->SETPROPERTY, VALUE=DHMI_CS_SETUP_INFO.AYEAR[DHMI_CS_SETUP_INFO.IYEAR]  
    
  ENDIF

<span class="comments">;--------------------------</span>
<span class="comments">; UPDATE YEAR VALUE</span>

  IF ACTION_TYPE EQ 'Y' THEN BEGIN
    IF DHMI_CS_SETUP_INFO.IVERBOSE EQ 1 THEN PRINT,'DHMI_CS_SETUP->CHANGE: UPDATING THE YEAR FIELD AND INDEX'
    CASE ACTION OF
      'YEAR&lt;':DHMI_CS_SETUP_INFO.IYEAR = DHMI_CS_SETUP_INFO.IYEAR-1
      'YEAR>':DHMI_CS_SETUP_INFO.IYEAR = DHMI_CS_SETUP_INFO.IYEAR+1
    ENDCASE
    IF DHMI_CS_SETUP_INFO.IYEAR LT 0 THEN DHMI_CS_SETUP_INFO.IYEAR = DHMI_CS_SETUP_INFO.NAYEAR-1
    IF DHMI_CS_SETUP_INFO.IYEAR EQ DHMI_CS_SETUP_INFO.NAYEAR THEN DHMI_CS_SETUP_INFO.IYEAR = 0 
    
    DHMI_CS_SETUP_INFO.FSCYEAR->SETPROPERTY, VALUE=DHMI_CS_SETUP_INFO.AYEAR[DHMI_CS_SETUP_INFO.IYEAR]
  ENDIF

<span class="comments">;--------------------------</span>
<span class="comments">; RETRUN TO THE WIDGET</span>

  WIDGET_CONTROL, EVENT.TOP, SET_UVALUE=DHMI_CS_SETUP_INFO, /NO_COPY

END

<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

PRO DHMI_CS_SETUP,GROUP_LEADER=GROUP_LEADER,VERBOSE=VERBOSE

COMMON DHMI_DATABASE

<span class="comments">;;--------------------------</span>
<span class="comments">;; FIND MAIN DIMITRI FOLDER AND DELIMITER</span>
<span class="comments">;</span>
  IF KEYWORD_SET(VERBOSE) THEN BEGIN
    PRINT,'DHMI_CS_SETUP: STARTING HMI VISUALISATION ROUTINE'
    IVERBOSE=1
  ENDIF ELSE IVERBOSE=0
  IF STRUPCASE(!VERSION.OS_FAMILY) EQ 'WINDOWS' THEN WIN_FLAG = 1 ELSE WIN_FLAG = 0
  DL            =  GET_DIMITRI_LOCATION('DL')

<span class="comments">;--------------------------</span>
<span class="comments">; GET LIST OF ALL OUTPUT FOLDERS, </span>
<span class="comments">; SITES, SENSORS AND PROCESSING VERSIONS</span>

  ASITES = DHMI_DB_DATA.REGION[UNIQ(DHMI_DB_DATA.REGION,SORT(DHMI_DB_DATA.REGION))]<span class="comments">;,'ALL']</span>
  USENSS = DHMI_DB_DATA.SENSOR[UNIQ(DHMI_DB_DATA.SENSOR,SORT(DHMI_DB_DATA.SENSOR))]
  UPROCV = DHMI_DB_DATA.PROCESSING_VERSION[UNIQ(DHMI_DB_DATA.PROCESSING_VERSION,$
                                       SORT(DHMI_DB_DATA.PROCESSING_VERSION))]
  UYEARS = DHMI_DB_DATA.YEAR[UNIQ(DHMI_DB_DATA.YEAR,SORT(DHMI_DB_DATA.YEAR))]

<span class="comments">;--------------------------  </span>
<span class="comments">; SELECT FIRST SITE AND GET </span>
<span class="comments">; AVAILABLE SENSORS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DHMI_CS_SETUP: RETRIEVING AVAILABLE SITES AND SENSORS'
  ASENS = MAKE_ARRAY(N_ELEMENTS(USENSS),/STRING,VALUE='')
  APROC = MAKE_ARRAY(N_ELEMENTS(UPROCV),/STRING,VALUE='')
  AYEAR = MAKE_ARRAY(N_ELEMENTS(UYEARS)+1,/STRING,VALUE='')

  NASITE = N_ELEMENTS(ASITES)
  CSITE  = ASITES[0]
  TEMP   = DHMI_DB_DATA.SENSOR[WHERE(DHMI_DB_DATA.REGION EQ CSITE)]
  TEMP   = TEMP[UNIQ(TEMP,SORT(TEMP))]
  ASENS[0:N_ELEMENTS(TEMP)-1] = TEMP<span class="comments">;,'ALL']</span>
  NASENS = N_ELEMENTS(TEMP)<span class="comments">;+1</span>
  CSENS  = ASENS[0]

<span class="comments">;--------------------------  </span>
<span class="comments">; GET AVAILABLE PROCESSING VERSIONS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DHMI_CS_SETUP: RETRIEVING AVAILABLE PROCESSING VERSIONS'
  TEMP    = DHMI_DB_DATA.PROCESSING_VERSION[WHERE(DHMI_DB_DATA.REGION EQ CSITE AND $
                                                  DHMI_DB_DATA.SENSOR EQ CSENS)]
  TEMP    = TEMP[UNIQ(TEMP,SORT(TEMP))]
  APROC[0:N_ELEMENTS(TEMP)-1] = TEMP<span class="comments">;,'ALL']</span>
  NAPROC  = N_ELEMENTS(TEMP)<span class="comments">;+1</span>
  CPROC   = APROC[0]

<span class="comments">;--------------------------  </span>
<span class="comments">; GET AVAILABLE YEARS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DHMI_CS_SETUP: RETRIEVING AVAILABLE YEARS'  
  TEMP    = STRTRIM(STRING(DHMI_DB_DATA.YEAR[WHERE(DHMI_DB_DATA.REGION EQ CSITE AND $
                                              DHMI_DB_DATA.SENSOR EQ CSENS AND $
                                              DHMI_DB_DATA.PROCESSING_VERSION EQ CPROC)]),2)
  TEMP    = TEMP[UNIQ(TEMP,SORT(TEMP))]
  AYEAR[0:N_ELEMENTS(TEMP)] = [TEMP,'ALL']
  CYEAR   = AYEAR[0]
  NAYEAR  = N_ELEMENTS(TEMP)+1

<span class="comments">;--------------------------</span>
<span class="comments">; DEFINE THE MAIN WIDGET INCLUDING </span>
<span class="comments">; FSC_FIELDS AND DROPLIST</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DHMI_CS_SETUP: RETRIEVING SCREEN DIMENSIONS FOR WIDGET'
  DIMS  = GET_SCREEN_SIZE()
  OPT_BTN = 60
  IF WIN_FLAG THEN XSIZE = 350 ELSE XSIZE = 380
  YSIZE = 500
  XLOC  = (DIMS[0]/2)-(XSIZE/2)
  YLOC  = (DIMS[1]/2)-(YSIZE/2)

  DHMI_CS_SETUP_TLB = WIDGET_BASE(COLUMN=1,TITLE='DIMITRI V2.0: CLOUD SCREENING SETUP',XSIZE=XSIZE,$
                                  XOFFSET=XLOC,YOFFSET=YLOC)

  DHMI_CS_SETUP_VAL     = WIDGET_BASE(DHMI_CS_SETUP_TLB,ROW=5,FRAME=1)
  DHMI_CS_SETUP_VAL_LBL = WIDGET_LABEL(DHMI_CS_SETUP_VAL,VALUE='Cloud Screening Parameters:')
  DHMI_CS_SETUP_VAL_LBL = WIDGET_LABEL(DHMI_CS_SETUP_VAL,VALUE='')
  DHMI_CS_SETUP_VAL_LBL = WIDGET_LABEL(DHMI_CS_SETUP_VAL,VALUE='')

<span class="comments">;--------------------------</span>
<span class="comments">; DEFINE WIDGET FSC FIELDS AND BUTTONS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DHMI_CS_SETUP: DEFINING THE FSC_FIELDS AND BUTTONS'
  IF WIN_FLAG THEN DHMI_CS_SETUP_VAL_VID  = FSC_FIELD(DHMI_CS_SETUP_VAL,TITLE='Region        : ', VALUE=CSITE,OBJECT=FSCSITE,/NOEDIT) $
    ELSE DHMI_CS_SETUP_VAL_VID  = FSC_FIELD(DHMI_CS_SETUP_VAL,TITLE='Region     : ', VALUE=CSITE,OBJECT=FSCSITE,/NOEDIT)
  DHMI_CS_SETUP_VAL_TMP  = WIDGET_BUTTON(DHMI_CS_SETUP_VAL,VALUE='&lt;',UVALUE='VSITE&lt;',$
                                          EVENT_PRO='DHMI_CS_SETUP_CHANGE')
  DHMI_CS_SETUP_VAL_TMP  = WIDGET_BUTTON(DHMI_CS_SETUP_VAL,VALUE='>',UVALUE='VSITE>',$
                                          EVENT_PRO='DHMI_CS_SETUP_CHANGE')

  IF WIN_FLAG THEN DHMI_CS_SETUP_VAL_SID  = FSC_FIELD(DHMI_CS_SETUP_VAL,TITLE='Sensor        : ', VALUE=CSENS,OBJECT=FSCSENS,/NOEDIT) $
    ELSE DHMI_CS_SETUP_VAL_SID  = FSC_FIELD(DHMI_CS_SETUP_VAL,TITLE='Sensor     : ', VALUE=CSENS,OBJECT=FSCSENS,/NOEDIT)
  DHMI_CS_SETUP_VAL_TMP  = WIDGET_BUTTON(DHMI_CS_SETUP_VAL,VALUE='&lt;',UVALUE='SENS&lt;',$
                                          EVENT_PRO='DHMI_CS_SETUP_CHANGE')
  DHMI_CS_SETUP_VAL_TMP  = WIDGET_BUTTON(DHMI_CS_SETUP_VAL,VALUE='>',UVALUE='SENS>',$
                                          EVENT_PRO='DHMI_CS_SETUP_CHANGE')

  IF WIN_FLAG THEN DHMI_CS_SETUP_VAL_PID  = FSC_FIELD(DHMI_CS_SETUP_VAL,TITLE='Processing  : ',VALUE=CPROC,OBJECT=FSCPROC,/NOEDIT) $
    ELSE DHMI_CS_SETUP_VAL_PID  = FSC_FIELD(DHMI_CS_SETUP_VAL,TITLE='Processing : ',VALUE=CPROC,OBJECT=FSCPROC,/NOEDIT)
  DHMI_CS_SETUP_VAL_TMP  = WIDGET_BUTTON(DHMI_CS_SETUP_VAL,VALUE='&lt;',UVALUE='PROC&lt;',$
                                          EVENT_PRO='DHMI_CS_SETUP_CHANGE')
  DHMI_CS_SETUP_VAL_TMP  = WIDGET_BUTTON(DHMI_CS_SETUP_VAL,VALUE='>',UVALUE='PROC>',$
                                          EVENT_PRO='DHMI_CS_SETUP_CHANGE')
  
  IF WIN_FLAG THEN DHMI_CS_SETUP_VAL_YID  = FSC_FIELD(DHMI_CS_SETUP_VAL,TITLE='Year            : ',VALUE=CYEAR,OBJECT=FSCYEAR,/NOEDIT) $
    ELSE DHMI_CS_SETUP_VAL_YID  = FSC_FIELD(DHMI_CS_SETUP_VAL,TITLE='Year       : ',VALUE=CYEAR,OBJECT=FSCYEAR,/NOEDIT)
  DHMI_CS_SETUP_VAL_TMP  = WIDGET_BUTTON(DHMI_CS_SETUP_VAL,VALUE='&lt;',UVALUE='YEAR&lt;',$
                                          EVENT_PRO='DHMI_CS_SETUP_CHANGE')
  DHMI_CS_SETUP_VAL_TMP  = WIDGET_BUTTON(DHMI_CS_SETUP_VAL,VALUE='>',UVALUE='YEAR>',$
                                          EVENT_PRO='DHMI_CS_SETUP_CHANGE')

<span class="comments">;--------------------------</span>
<span class="comments">; DEFINE WIDGET BASE IN MAIN</span>

  DHMI_CS_SETUP_TLB_OPT  = WIDGET_BASE(DHMI_CS_SETUP_TLB,ROW=1,/ALIGN_RIGHT)

<span class="comments">;--------------------------</span>
<span class="comments">; DEFINE TWO BUTTONS FOR START AND CLOSE</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DHMI_CS_SETUP: DEFINING THE START AND EXCIT BUTTONS'
  DHMI_CS_SETUP_TLB_OPT_BTN  = WIDGET_BUTTON(DHMI_CS_SETUP_TLB_OPT,VALUE='Start',UVALUE='START',$
                                              EVENT_PRO='DHMI_CS_SETUP_START',XSIZE=OPT_BTN)
  DHMI_CS_SETUP_TLB_OPT_BTN  = WIDGET_BUTTON(DHMI_CS_SETUP_TLB_OPT,VALUE='Close',UVALUE='EXIT',$
                                              EVENT_PRO='DHMI_CS_SETUP_EXIT',XSIZE=OPT_BTN)

  IF NOT KEYWORD_SET(GROUP_LEADER) THEN GROUP_LEADER = DHMI_CS_SETUP_TLB

<span class="comments">;--------------------------</span>
<span class="comments">; STORE WIDGET INFORMATION IN A STRUCTURE</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DHMI_CS_SETUP: STORING WIDGET INFO IN A STRUCTURE'
  DHMI_CS_SETUP_INFO = {                            $
                        IVERBOSE    : IVERBOSE      ,$
                        GROUP_LEADER: GROUP_LEADER  ,$ 
                        ASITE       : ASITES        ,$
                        NASITE      : NASITE        ,$
                        ASENS       : ASENS         ,$
                        NASENS      : NASENS        ,$
                        APROC       : APROC         ,$
                        NAPROC      : NAPROC        ,$
                        AYEAR       : AYEAR         ,$
                        NAYEAR      : NAYEAR        ,$
                        FSCSITE     : FSCSITE       ,$
                        FSCSENS     : FSCSENS       ,$
                        FSCPROC     : FSCPROC       ,$
                        FSCYEAR     : FSCYEAR       ,$
                        ISITE       : 0             ,$
                        ISENS       : 0             ,$
                        IPROC       : 0             ,$
                        IYEAR       : 0             $
                        }

<span class="comments">;--------------------------</span>
<span class="comments">; REALISE THE WIDGET AND </span>
<span class="comments">; REGISTER WITH THE XMANAGER</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'DHMI_CS_SETUP: REALISING THE WIDGET AND REGISTERING WITH XMANAGER'
  WIDGET_CONTROL,DHMI_CS_SETUP_TLB,/REALIZE,/NO_COPY,SET_UVALUE=DHMI_CS_SETUP_INFO,GROUP_LEADER=GROUP_LEADER
  XMANAGER,'DHMI_CS_SETUP', DHMI_CS_SETUP_TLB

END
</code>
    </div>
  </body>
</html>