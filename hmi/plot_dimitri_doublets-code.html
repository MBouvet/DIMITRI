<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:50:53 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>plot_dimitri_doublets.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="plot_dimitri_doublets.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source">PRO PLOT_DIMITRI_DOUBLETS,OUTPUT_FOLDER,DIMITRI_BAND,Region,DB_REF_SENSOR,DB_REF_PROC_VERSION

<span class="comments">;-----------------------------------------</span>
<span class="comments">; CHECK OFOLDER EXISTS </span>
  
  RES = FILE_INFO(OUTPUT_FOLDER)
  IF RES.EXISTS EQ 0 THEN BEGIN
    PRINT,"PLOT_DIMITRI_DOUBLETS: OUTPUT FOLDER DOESN'T EXIST"
    RETURN,-1
  ENDIF
  
  RES = STRSPLIT(OFOLDER,'\',/EXTRACT)
  IF N_ELEMENTS(RES) EQ 1 THEN DL = '/' ELSE DL = '\' 

<span class="comments">; FIND ALL CORRESPONDING DOUBLET EXTRACTION FILES </span>
  str1 = 'ED_'+region+'_'+DB_REF_SENSOR+'_'+DB_REF_PROC_VERSION+'*.dat'
  str2 = 'ED_'+region+'_*'+DB_REF_SENSOR+'_'+DB_REF_PROC_VERSION+'.dat'

  RES = FILE_SEARCH(ed_folder,str1)
  res2 = FILE_SEARCH(ed_folder,str2)
  if res[0] eq '' or res2[0] eq '' then return,-1
  if n_elements(res) ne n_elements(res2) then return,-1

<span class="comments">;get sensor index correcponding to dimitri index</span>

<span class="comments">;start creating arrays</span>
  tmp_date= 0.0
  tmp_vza = 0.0
  tmp_vaa = 0.0
  tmp_sza = 0.0
  tmp_saa = 0.0
  tmp_ref = 0.0

<span class="comments">; get time series of reference sensor</span>
  for i=0,n_elements(res)-1 do begin
    restore,res[i]
    tmp_date= [tmp_date,ED_SENSOR1_SENSOR2[0,*]]
    tmp_vza = [tmp_date,ED_SENSOR1_SENSOR2[1,*]]
    tmp_vaa = [tmp_date,ED_SENSOR1_SENSOR2[2,*]]
    tmp_sza = [tmp_date,ED_SENSOR1_SENSOR2[3,*]]
    tmp_saa = [tmp_date,ED_SENSOR1_SENSOR2[4,*]]
    tmp_ref = [tmp_date,ED_SENSOR1_SENSOR2[5+sensor_index,*]]
  endfor
  
 <span class="comments">;sort out arrays</span>
 temp = n_elements(tmp_date)
 tmp_date=tmp_date[1:temp-1]
 tmp_vza =tmp_vza[1:temp-1]
 tmp_vaa =tmp_vaa[1:temp-1]
 tmp_sza =tmp_sza[1:temp-1]
 tmp_saa =tmp_saa[1:temp-1]
 tmp_ref =tmp_ref[1:temp-1]
 
 temp = UNIQ(tmp_date, SORT(tmp_date))
 tmp_date=tmp_date[temp]
 tmp_vza =tmp_vza[temp]
 tmp_vaa =tmp_vaa[temp]
 tmp_sza =tmp_sza[temp]
 tmp_saa =tmp_saa[temp]
 tmp_ref =tmp_ref[temp]
 n_dates = n_elements(tmp_date)
 
 
   <span class="comments">;get cal sensors and proc versions</span>
  sens_ver = strarr(n_elements(res2)+1)
  sens_ver[0] = string(DB_REF_SENSOR+'_'+DB_REF_PROC_VERSION)
    
  <span class="comments">;define array to hold all data (ndates in reference sensor,n_cal sensors + 1,2)</span>
  all_data = make_array(n_dates,n_elements(res2)+1,6)
  
  all_data[*,0,0] = tmp_date
  all_data[*,0,1] = tmp_vza
  all_data[*,0,2] = tmp_vaa
  all_data[*,0,3] = tmp_sza
  all_data[*,0,4] = tmp_saa
  all_data[*,0,5] = tmp_ref
  
  
  for i=0,n_elements(res2)-1 do begin
  temp = string(dl+'_')
  temp = strsplit(res2[i],temp,/extract)
  tmp = n_elements(temp)
  sens_ver[i] = string(temp[tmp-4]+'_'+temp[tmp-3])
  restore,res2[i]

  <span class="comments">;get idx relating to dimitri band</span>
  idx=0<span class="comments">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>

  tt = n_elements(ED_SENSOR2_SENSOR1[0,*])
  all_data[0:tt-1,i+1,0] = ED_SENSOR2_SENSOR1[0,*]
  all_data[0:tt-1,i+1,1] = ED_SENSOR2_SENSOR1[1,*]
  all_data[0:tt-1,i+1,2] = ED_SENSOR2_SENSOR1[2,*]
  all_data[0:tt-1,i+1,3] = ED_SENSOR2_SENSOR1[3,*]
  all_data[0:tt-1,i+1,4] = ED_SENSOR2_SENSOR1[4,*]
  all_data[0:tt-1,i+1,5] = ED_SENSOR2_SENSOR1[5+idx,*]
  endfor

<span class="comments">;create an object array for all sensor configurations</span>

  obj_test = objarr(5,n_elements(res2)+1,2)
  plot_type = intarr(5)<span class="comments">;0-3 for angles, 4 for reflectance</span>
  
  <span class="comments">;get colours for number of sensors</span>
  sensor_colours = bytarr(3*n_elements(res2)+1)
  sensor_colours = reform(sensor_colours,3,n_elements(res2)+1)

<span class="comments">;SET UP PLOT PARAMETERS</span>
  xtmp = min(all_data[*,0,0],max=xtmp2)
  RSR_XRANGE  = [xtmp,xtmp2]
  ytmp = min(all_data[*,*,5],max=ytmp2)
  ytmp = ytmp>0.0&lt<span class="comments">;100.0</span>
  ytmp2= ytmp2>0.0&lt<span class="comments">;100.0</span>
<span class="comments">;  RSR_YRANGE  = [tmp,tmp2]</span>
  XMAJTICKS   = (1+(xtmp2-xtmp)*0.05)&lt<span class="comments">;11</span>
  YMAJTICKS   = 1+(ytmp2-ytmp)

<span class="comments">;need a y range of 2 columns and 5 lines</span>
RSR_yrange = fltarr(2,5)
for i=0,4 do begin
ytmp = min(all_data[*,*,i+1],max=ytmp2)
  RSR_yrange[0,i] = ytmp>0.0&lt<span class="comments">;100.0</span>
  RSR_yrange[1,i]= ytmp2>0.0&lt<span class="comments">;100.0</span>
endif

<span class="comments">;------------------------------------ </span>
<span class="comments">; CREATE THE PALETTE OBJECT</span>
  
  COLORTABLE  = 39
  RSR_PALETTE = OBJ_NEW('IDLGRPALETTE')
  RSR_PALETTE->LOADCT, COLORTABLE


xtitle = OBJ_NEW('IDLGRTEXT',"Date",RECOMPUTE_DIMENSION=1)
ytitles = objarr(5)
tt = ['vza','vaa','sza','vza','reflectance']
for i=0,4 do ytitles[i] = OBJ_NEW('IDLGRTEXT',tt[i],RECOMPUTE_DIMENSION=1)

<span class="comments">;------------------------------------ </span>
<span class="comments">; CREATE THE AXIS OBJECTS</span>

  RSR_XAXIS = OBJ_NEW('IDLGRAXIS', 0, TICKLEN=0.025, MAJOR=XMAJTICKS, TITLE=xtitle, $
                      RANGE=RSR_XRANGE, /EXACT, XCOORD_CONV=NORM_COORD(RSR_XRANGE))
  RSR_YAXIS = OBJ_NEW('IDLGRAXIS', 1, TICKLEN=0.025, MINOR=4, TITLE='unselected', $
                      RANGE=[0.0,1.0], /EXACT, YCOORD_CONV=NORM_COORD([0.0,1.0]))
  RSR_LEGEND = OBJ_NEW('IDLGRLEGEND',/SHOW_OUTLINE,/HIDE,BORDER_GAP=0.2)

<span class="comments">;------------------------------------  </span>
 <span class="comments">; CREATE THE PLOT MODEL</span>
 
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'RSR PLOT MODULE: CREATING THE PLOT AND LEGEND MODELS'
  RSR_MODEL = OBJ_NEW('IDLGRMODEL')
  RSR_MODEL->ADD,RSR_XAXIS
  RSR_MODEL->ADD,RSR_YAXIS
  RSR_LEGENDMODEL = OBJ_NEW('IDLGRMODEL')
  RSR_LEGENDMODEL->ADD,RSR_LEGEND

<span class="comments">;------------------------------------ </span>
<span class="comments">; CREATE THE PLOT VIEW</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'RSR PLOT MODULE: CREATING THE RSR_VIEW'
  RSR_VIEW = OBJ_NEW('IDLGRVIEW',/DOUBLE)
  RSR_VIEW->ADD,RSR_MODEL
  RSR_VIEW->ADD,RSR_LEGENDMODEL
  RSR_VIEW->SETPROPERTY, VIEWPLANE_RECT = [-0.1, -0.1, 1.2, 1.2]

<span class="comments">;--------------------------------------------------------------------------------------------------------------------</span>
<span class="comments">;------------------------------------ </span>
<span class="comments">; GET THE SCREEN DIMENSIONS</span>

  DIMS  = GET_SCREEN_SIZE()
  XSIZE = 700
  YSIZE = 450
  XLOC  = (DIMS[0]/2)-(XSIZE/2)
  YLOC  = (DIMS[1]/2)-(YSIZE/2)

<span class="comments">;------------------------------------ </span>
<span class="comments">; DEFINE THE BASE WIDGET FOR THE PLOT</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'RSR PLOT MODULE: DEFINING THE WIDGET AND BUTTONS'
  RSR_WD_TLB  = WIDGET_BASE(TITLE='DIMITRI: doublet extraction visualise',MBAR=MENUBASE,TLB_SIZE_EVENTS=1,$
                            COLUMN=1, BASE_ALIGN_CENTER=1,XOFFSET=XLOC, YOFFSET=YLOC)
  RSR_WD_DRAW = WIDGET_DRAW(RSR_WD_TLB, XSIZE=XSIZE, YSIZE=YSIZE, GRAPHICS_LEVEL=2, RETAIN=2)

<span class="comments">;;------------------------------------ </span>
<span class="comments">;; CREATE THE FILE MENU AND BUTTONS</span>
<span class="comments">;</span>
<span class="comments">;  RSR_WD_FILE = WIDGET_BUTTON(MENUBASE,     VALUE='File'      ,/MENU)</span>
<span class="comments">;  RSR_WD_IMPT = WIDGET_BUTTON(RSR_WD_FILE,  VALUE='Import'    ,UVALUE='IMPORT',EVENT_PRO='RSR_OBJECT_IMPORT')</span>
<span class="comments">;  RSR_WD_EXPT = WIDGET_BUTTON(RSR_WD_FILE,  VALUE='Save as...',/MENU)</span>
<span class="comments">;  RSR_WD_OUPT = WIDGET_BUTTON(RSR_WD_EXPT,  VALUE='JPG'       ,UVALUE='JPG'   ,EVENT_PRO='RSR_OBJECT_EXPORT')</span>
<span class="comments">;  RSR_WD_OUPT = WIDGET_BUTTON(RSR_WD_EXPT,  VALUE='PNG'       ,UVALUE='PNG'   ,EVENT_PRO='RSR_OBJECT_EXPORT')</span>
<span class="comments">;  RSR_WD_OUPT = WIDGET_BUTTON(RSR_WD_EXPT,  VALUE='CSV'       ,UVALUE='CSV'   ,EVENT_PRO='RSR_OBJECT_EXPORT')</span>
<span class="comments">;  RSR_WD_EXIT = WIDGET_BUTTON(RSR_WD_FILE, /SEPARATOR         ,VALUE ='Exit'  ,EVENT_PRO='RSR_OBJECT_EXIT')</span>
<span class="comments">;</span>
<span class="comments">;;------------------------------------ </span>
<span class="comments">;; CREATE THE OVERLAY MENU AND BUTTONS</span>
<span class="comments">;</span>
<span class="comments">;  RSR_WD_OVLY = WIDGET_BUTTON(MENUBASE,     VALUE='Overlay' ,/MENU)</span>
<span class="comments">;  RSR_WD_OPTS = WIDGET_BUTTON(RSR_WD_OVLY,  VALUE='Options' ,/MENU)</span>
<span class="comments">;  RSR_WD_REFS = WIDGET_BUTTON(RSR_WD_OPTS,  VALUE='Legend'  ,UVALUE='LEGEND', EVENT_PRO='RSR_OBJECT_OPTION')</span>
<span class="comments">;  RSR_WD_REFS = WIDGET_BUTTON(RSR_WD_OPTS,  VALUE='Reset'   ,UVALUE='RESET' , EVENT_PRO='RSR_OBJECT_OPTION')</span>
<span class="comments">;</span>
<span class="comments">;;------------------------------------ </span>
<span class="comments">;; LOOP OVER EACH SENSOR AND CREATE BUTTON</span>
<span class="comments">;  </span>
<span class="comments">;  IF KEYWORD_SET(VERBOSE) THEN PRINT,'RSR PLOT MODULE: STARTING LOOP TO DEFINE BUTTONS FOR EACH SENSOR'</span>
<span class="comments">;  FOR RSR_SENS=0,NUM_SENSORS-1 DO BEGIN</span>
<span class="comments">;    RSR_WD_SENS = WIDGET_BUTTON(RSR_WD_OVLY, VALUE=SENSOR_ID[RSR_SENS],$</span>
<span class="comments">;                                UVALUE=SENSOR_ID[RSR_SENS], EVENT_PRO='RSR_OBJECT_OPTION')</span>
<span class="comments">;  ENDFOR</span>

<span class="comments">;------------------------------------  </span>
<span class="comments">; REALIZE THE WIDGET</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'RSR PLOT MODULE: REALISING THE WIDGET'
  WIDGET_CONTROL, RSR_WD_TLB, /REALIZE
  WIDGET_CONTROL, RSR_WD_DRAW, GET_VALUE=RSR_WINDOW
 
<span class="comments">;------------------------------------  </span>
<span class="comments">; CREATE THE BLANK PLOT AND MOVE THE LEGEND</span>
 
  IF KEYWORD_SET(VERBOSE) THEN PRINT,'RSR PLOT MODULE: ADDING THE BLANK PLOT AND MOVING THE LEGEND'
  RSR_WINDOW->DRAW, RSR_VIEW
  DIMS = RSR_LEGEND->COMPUTEDIMENSIONS(RSR_WINDOW) 
  RSR_LEGENDMODEL->TRANSLATE, .92, .8, 0 
  RSR_WINDOW->SETPROPERTY, PALETTE=RSR_PALETTE
  RSR_WINDOW->DRAW, RSR_VIEW

<span class="comments">;------------------------------------  </span>
<span class="comments">; DEFINE THE INFO STRUCTURE TO CONTAIN </span>
<span class="comments">; ALL DATA AND OBJECTS</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT,'RSR PLOT MODULE: DEFINING SUPER STRUCTURE TO CONTAIN ALL DATA'
  RSR_INFO = {RSR_PALETTE:RSR_PALETTE, $
              RSR_WINDOW:RSR_WINDOW, $
              RSR_VIEW:RSR_VIEW, $
              RSR_LEGEND:RSR_LEGEND, $
              RSR_LEGENDMODEL:RSR_LEGENDMODEL,$
              RSR_XRANGE:RSR_XRANGE,$
              RSR_YRANGE:RSR_YRANGE,$
              RSR_YTITLE:RSR_YTITLE,$
              RSR_XTITLE:RSR_XTITLE,$
              RSR_XAXIS:RSR_XAXIS,$
              RSR_YAXIS:RSR_YAXIS,$
              RSR_DATA:RSR_DATA,$
              RSR_OBJ:RSR_OBJ,$
              WAVELENGTHS:WAVELENGTHS, $
              SENSOR_COLOURS:SENSOR_COLOURS,$
              SENSOR_ID:SENSOR_ID, $
              SENSOR_BANDS:SENSOR_BANDS, $
              SENS_ON:SENS_ON, $
              USR_DATA:USR_DATA,$
              USER_DATA_ON:[0],$
              USER_COLOUR:USER_COLOUR,$
              USER_DATA_NAME:'', $
              USERXDATA:PTR_NEW(0.0),$
              USERYDATA:PTR_NEW(0.0)$
             }

  WIDGET_CONTROL,RSR_WD_TLB,SET_UVALUE=RSR_INFO,/NO_COPY
  XMANAGER,'RSR_OBJECT', RSR_WD_TLB, GROUP_LEADER=GROUP,/NO_BLOCK

END
</code>
    </div>
  </body>
</html>