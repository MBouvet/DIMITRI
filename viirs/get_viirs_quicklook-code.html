<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:02:17 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>get_viirs_quicklook.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="get_viirs_quicklook.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><a id="GET_VIIRS_QUICKLOOK:source"></a>function GET_VIIRS_QUICKLOOK ,FILENAME, RGB=RGB, ROI=ROI, ICOORDS=ICOORDS, QL_QUALITY=QL_QUALITY, VERBOSE=VERBOSE
<span class="comments">;+</span>
<span class="comments">; :Name:</span>
<span class="comments">;      GET_MODISA_QUICKLOOK</span>
<span class="comments">;</span>
<span class="comments">; :Description:</span>
<span class="comments">;      outputs a rgb modisa quicklook with roi overlay if requested</span>
<span class="comments">;</span>
<span class="comments">; :Calling sequence:</span>
<span class="comments">;      RES = GET_MODISA_QUICKLOOK(FILENAME)</span>
<span class="comments">;</span>
<span class="comments">; :Params:</span>
<span class="comments">;      FILENAME :</span>
<span class="comments">;         A string containing the filename of the product for quicklook generation</span>
<span class="comments">;</span>
<span class="comments">; :Keywords:</span>
<span class="comments">;     RGB :</span>
<span class="comments">;       program generates an rgb colour quicklook (default is grayscale)</span>
<span class="comments">;     ROI :</span>
<span class="comments">;       Overlay coordinates of an roi in red (requires icoords)</span>
<span class="comments">;     ICOORDS :</span>
<span class="comments">;       A 4-element array of roi geolocation (n,s,e,w)</span>
<span class="comments">;     QL_QUALITY  :</span>
<span class="comments">;       Quality of jpeg generated (100 = max, 0 = lowest)</span>
<span class="comments">;     VERBOSE   :</span>
<span class="comments">;        Processing status outputs</span>
<span class="comments">;</span>
<span class="comments">; :Returns:</span>
<span class="comments">;     STATUS :</span>
<span class="comments">;       1: nominal, (-1) or 0: error</span>
<span class="comments">;       jpegs are automatically saved in filename folder</span>
<span class="comments">;</span>
<span class="comments">; :Common blocks:</span>
<span class="comments">;     NONE</span>
<span class="comments">;</span>
<span class="comments">; :History:</span>
<span class="comments">;      1 FJul 2013 - D Marrable</span>
<span class="comments">;-</span>
  
  
<span class="comments">;------------------------------------------------</span>
<span class="comments">; CHECK FILENAME IS NOMINAL</span>

IF FILENAME EQ '' THEN BEGIN
  PRINT, 'VIIRS L1B QUICKLOOK: ERROR, INPUT FILENAME INCORRECT'
  RETURN,-1
ENDIF

<span class="comments">;------------------------------------------------</span>
<span class="comments">; SET JPEG QUALITY IF NOT PROVIDED</span>

IF N_ELEMENTS(QL_QUALITY) EQ 0 THEN QL_QUALITY = 90
IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VIIRS L1B QUICKLOOK: JPEG QUALITY = ',QL_QUALITY

<span class="comments">;------------------------------------------------</span>
<span class="comments">; CHECK KEYWORD COMBINATIONS</span>

IF KEYWORD_SET(ROI) AND N_ELEMENTS(ICOORDS) LT 4 THEN BEGIN
  PRINT,'VIIRS L1B QUICKLOOK: ERROR, ROI KEYWORD IS SET BUT COORDINATES INCORRECT'
  RETURN,-1
ENDIF

<span class="comments">;------------------------------------------------</span>
<span class="comments">; DERIVE THE OUTPUT JPEG FILENAME</span>

IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VIIRS L1B QUICKLOOK: COMPUTING OUTPUT FILENAME'
QL_POS = STRPOS(FILENAME,'.',/REVERSE_SEARCH)
QL_VIIRS_JPG = FILENAME
STRPUT,QL_VIIRS_JPG,'_',QL_POS
QL_VIIRS_JPG = STRING(QL_VIIRS_JPG+'.jpg')
ORDER=0

<span class="comments">;------------------------------------------------</span>
<span class="comments">; GET VIIRS L1B RADIANCE DATA AND DERIVE QUICKLOOK IMAGE</span>

IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VIIRS L1B QUICKLOOK: RETRIEVING RADIANCE DATA'
IF KEYWORD_SET(RGB) THEN BEGIN
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VIIRS L1B QUICKLOOK: RGB JPEG SELECTED'
  QL_DATAR = GET_VIIRS_L1B_RADIANCE(FILENAME, 2, /VERBOSE)
  QL_DATAG = GET_VIIRS_L1B_RADIANCE(FILENAME, 3, /VERBOSE)
  QL_DATAB = GET_VIIRS_L1B_RADIANCE(FILENAME, 4, /VERBOSE)
ENDIF ELSE BEGIN
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VIIRS L1B QUICKLOOK: GRAYSCALE SELECTED'
  QL_DATAR  = GET_VIIRS_L1B_RADIANCE(FILENAME, 3, /VERBOSE)
ENDELSE
  
IF QL_DATAR[0] EQ -1 THEN BEGIN
  PRINT,'VIIRS L1B QUICKLOOK: ERROR, PROBLEM ENCOUNTERED DURING L1B RADIANCE RETRIEVAL, CHECK PRODUCTS IS A VIIRSS L1B PRODUCT'
  RETURN,-1
ENDIF 
 
IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MODISA L1B QUICKLOOK: GET PRODUCT DIMENSIONS AND DEFINE IMAGE ARRAY'
QL_DIMS  = SIZE(QL_DATAR)
QL_IMAGE = BYTARR(3,QL_DIMS[1],QL_DIMS[2])
  
<span class="comments">;-----------------------------------------------</span>
<span class="comments">; POPULATE THE QUICKLOOK IMAGE ARRAY</span>

IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VIIRS L1B QUICKLOOK: ADD RADIANCE DATA TO IMAGE ARRAY CHANNELS'
IF KEYWORD_SET(RGB) THEN BEGIN

  QL_IMAGE[0,*,*]=BYTSCL(QL_DATAR)
  QL_IMAGE[1,*,*]=BYTSCL(QL_DATAG)
  QL_IMAGE[2,*,*]=BYTSCL(QL_DATAB)
  
  <span class="comments">;----------------------------------------------</span>
  <span class="comments">; RELEASE MEMORY FOR GREEN AND BLUE CHANNELS</span>
  
  QL_DATAG = 0
  QL_DATAB = 0
  
ENDIF ELSE BEGIN

  QL_IMAGE[0,*,*]=BYTE(QL_DATAR)
  QL_IMAGE[1,*,*]=BYTE(QL_DATAR)
  QL_IMAGE[2,*,*]=BYTE(QL_DATAR)

ENDELSE 

<span class="comments">;---------------------------------------------------</span>
<span class="comments">; GET LAT/LON DATA FOR ROI PIXEL INDEX IF REQUESTED</span>

IF KEYWORD_SET(ROI) THEN BEGIN
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VIIRS L1B QUICKLOOK: OVERLAY OF ROI SELECTED'
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VIIRS L1B QUICKLOOK: RETRIEVING PRODUCT GEOLOCATION'
  QL_GEO = GET_VIIRS_LAT_LON(FILENAME)
  
  <span class="comments">;---------------------------------------------------</span>
  <span class="comments">; FIND LOCATION OF ROI</span>
  
  QL_ROI_IDX = WHERE($
    QL_GEO.LAT LT ICOORDS[0] AND $
    QL_GEO.LAT GT ICOORDS[1] AND $
    QL_GEO.LON LT ICOORDS[2] AND $
    QL_GEO.LON GT ICOORDS[3] )
    
  <span class="comments">;---------------------------------------------------</span>
  <span class="comments">; CONVERT ROI PIXELS TO A LIGHT RED OVERLAY</span>
  
  IF QL_ROI_IDX[0] GT -1 THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VIIRS L1B QUICKLOOK: MODIFYING RED CHANNEL FOR ROI OVERLAY'
    <span class="comments">;IF KEYWORD_SET(RGB) THEN BEGIN</span>
    <span class="comments">;QL_DATAR = BYTE(QL_DATAR)</span>
    QL_DATAR = QL_IMAGE[0,*,*]
    QL_DATAG = QL_IMAGE[1,*,*]
    QL_DATAB = QL_IMAGE[2,*,*]
    <span class="comments">;ENDIF ELSE QL_DATAR = BYTSCL(QL_DATAR,MAX=TEMP_MAX)</span>
    
    QL_DATAR[QL_ROI_IDX]=250
    QL_DATAG[QL_ROI_IDX]=bytscl(QL_DATAG[QL_ROI_IDX],top=75)
    QL_DATAB[QL_ROI_IDX]=bytscl(QL_DATAb[QL_ROI_IDX],top=75)
    QL_IMAGE[0,*,*] = QL_DATAR
    QL_IMAGE[1,*,*] = QL_DATAG
    QL_IMAGE[2,*,*] = QL_DATAB
    
    
  ENDIF
  
  IF (QL_GEO.LAT[2,QL_DIMS[2]-3]) GT (QL_GEO.LAT[2,2]) THEN ORDER=1 ELSE ORDER=0
  
ENDIF

<span class="comments">;---------------------------------------------------</span>
<span class="comments">; OUTPUT QUICKLOOK AS JPEG</span>

IF KEYWORD_SET(VERBOSE) THEN PRINT, 'VIIRS L1B QUICKLOOK: WRITING IMAGE TO JPEG'
WRITE_JPEG ,QL_VIIRS_JPG,REVERSE(REVERSE(QL_IMAGE,3),2),TRUE=1,ORDER=ORDER

<span class="comments">;---------------------------------------------------</span>
<span class="comments">; RETURN A POSITIVE VALUE INDICATING QL GENERATION OK</span>

RETURN, 1
  
END

  
  
</code>
    </div>
  </body>
</html>