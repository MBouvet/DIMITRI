<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:50:56 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>get_meris_timeseries_plots.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="get_meris_timeseries_plots.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      GET_MERIS_TIMESERIES_PLOTS       </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      GENERATES PLOTS FROM THE SUPPLIED TIME SERIES OF DIMITRI MERIS DATA.</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = GET_MERIS_TIMESERIES_PLOTS(OUTPUT_SAV)      </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      OUTPUT_SAV  -  STRING OF THE SENSOR/PROCESSING OUTPUT SAV      </span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      COLOUR_TABLE      - USER DEFINED IDL COLOUR TABLE INDEX (DEFAULT IS 39)</span>
<span class="comments">;*      PLOT_XSIZE        - WIDTH OF GENERATED PLOTS (DEFAULT IS 700PX)</span>
<span class="comments">;*      PLOT_YSIZE        - HEIGHT OF GENERATED PLOTS (DEFAULT IS 400PX)</span>
<span class="comments">;*      NO_ZBUFF          - IF SET THEN PLOTS ARE GENERATED IN WINDOWS AND NOT </span>
<span class="comments">;*                          WIHTIN THE Z-BUFFER.</span>
<span class="comments">;*      VERBOSE           - PROCESSING STATUS OUTPUTS      </span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      PLOTS OF TOA REFLECTANCE, REFLECTANCE EVOLUTION, SOLAR ZENITH ANGLE AND SENSOR </span>
<span class="comments">;*      ZENITH ANGLE AUTOMATICALLY SAVED.  </span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*      01 DEC 2010 - C KENT   - DIMITRI-2 V1.0</span>
<span class="comments">;*      02 DEC 2010 - C KENT   - UPDATED HEADER INFORMATION AND OUTPUT_SAV TEST</span>
<span class="comments">;*      03 DEC 2010 - C KENT   - UPDATED TO ACCOUNT FOR NO DATA VALUES WITHIN OUTPUT_SAV</span>
<span class="comments">;*      05 JAN 2011 - C KENT   - MINOR SPELLING CHANGES</span>
<span class="comments">;*      10 JAN 2011 - C KENT   - CHANGED INPUT VARIABLE TO SENSOR_L1B_REF</span>
<span class="comments">;*      12 JAN 2011 - C KENT   - UPDATED TO REFLECT CHANGES IN SENSORS_L1B_REF (INCLUDES VAA AND SAA)</span>
<span class="comments">;*      22 MAR 2011 - C KENT   - ADDED CONFIGURAITON FILE DEPENDENCE</span>
<span class="comments">;*      04 JUL 2011 - C KENT   - UPDATED TO INCLUDE AUX DATA INFORMATION IN SAV</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      01 DEC 2010 - C KENT   - WINDOWS 32-BIT MACHINE: COMPILATION SUCCESSFUL,</span>
<span class="comments">;*                               ZBUFFER AND NOMINAL PLOTS PRODUCED OK.</span>
<span class="comments">;*      05 JAN 2010 - C KENT   - LINUX 64-BIT MACHINE IDL 8.0: COMPILATION SUCCESSFUL,</span>
<span class="comments">;*                               NO DIFFERENCES OBSERVED AGAINST WINDOWS 32-BIT MACHINE</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION GET_MERIS_TIMESERIES_PLOTS,OUTPUT_SAV,NO_ZBUFF=NO_ZBUFF,COLOUR_TABLE=COLOUR_TABLE,PLOT_XSIZE=PLOT_XSIZE,PLOT_YSIZE=PLOT_YSIZE,VERBOSE=VERBOSE

<span class="comments">;-----------------------------------------------</span>
<span class="comments">; RESTORE THE L1B REFLECTANCE</span>

  TEMP = FILE_INFO(OUTPUT_SAV)
  IF TEMP.EXISTS EQ 1 THEN BEGIN
    RESTORE,OUTPUT_SAV
  ENDIF ELSE BEGIN
    PRINT, 'MERIS_TIMESERIES_PLOTS: ERROR, OUTPUT_SAV DOES NOT EXIST'
    RETURN,-1
  ENDELSE

<span class="comments">;-----------------------------------------------</span>
<span class="comments">; FIND ONLY THE GOOD DATA</span>

  NUM_NON_REF = 5+12 
  NB_BANDS = 15
  RES = WHERE(SENSOR_L1B_REF[NUM_NON_REF,*] GT 0.0 and SENSOR_L1B_REF[NUM_NON_REF,*] lt 1.0)
  IF RES[0] EQ -1 THEN RETURN,-1
  MERIS_L1B_REF_GD = SENSOR_L1B_REF[*,RES]

<span class="comments">;------------------------------------------------</span>
<span class="comments">; GET THE SIZE DIMENSIONS OF INPUT L1B TIMESERIES (NOTE, EXPECTING DIMITRI-MERIS VARIABLE STRUCTURE)</span>

  NB_COLS = num_non_ref+2*nb_bands
  RES = SIZE(MERIS_L1B_REF_GD)
  IF RES[1] NE NB_COLS THEN BEGIN
    PRINT, 'MERIS_TIMESERIES_PLOTS: ERROR, INPUT L1B VARIABLE STRUCTURE MUST BE IN DIMITRI FORMAT'
    RETURN, -1
  ENDIF 
 
<span class="comments">;------------------------------------------------</span>
<span class="comments">; SET PARAMETERS AND KEYWORD VALUES</span>

  NB_BANDS = 15
  CFIG_DATA = GET_DIMITRI_CONFIGURATION()
  IF NOT KEYWORD_SET(COLOUR_TABLE) THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: NO COLOR_TABLE SET, USING DEFAULT OF 39'
    COLOUR_TABLE = CFIG_DATA.(1)[2]
  ENDIF
  IF NOT KEYWORD_SET(PLOT_XSIZE) THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: PLOT_XSIZE NOT SET, USING DEFAULT OF 700'
    PLOT_XSIZE = CFIG_DATA.(1)[0]
  ENDIF
  IF NOT KEYWORD_SET(PLOT_YSIZE) THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: PLOT_YSIZE NOT SET, USING DEFAULT OF 400'
    PLOT_YSIZE = CFIG_DATA.(1)[1]
  ENDIF 
  
  YMIN = 0.0
  YMAX = 1.0

<span class="comments">;------------------------------------------------</span>
<span class="comments">; DEFINE OUTPUT FILENAMES BASED ON OUTPUT_SAV</span>

  OUTPUT_BASE = STRMID(OUTPUT_SAV,0,STRLEN(OUTPUT_SAV)-11)
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: OUTPUT_BASE = ',OUTPUT_BASE
 
<span class="comments">;------------------------------------------------</span>
<span class="comments">; SETUP WINDOW PROPERTIES</span>

  MACHINE_WINDOW = !D.NAME
  IF NOT KEYWORD_SET(NO_ZBUFF) THEN BEGIN
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: GENERATING PLOTS WITHIN Z-BUFFER'
  SET_PLOT, 'Z'
  DEVICE, SET_RESOLUTION=[PLOT_XSIZE,PLOT_YSIZE]<span class="comments">;;,set_pixel_depth=24</span>
  ERASE  
  ENDIF ELSE WINDOW,XSIZE = PLOT_XSIZE,YSIZE=PLOT_YSIZE
  <span class="comments">;; DEVICE, DECOMPOSED = 0</span>
  LOADCT, COLOUR_TABLE

<span class="comments">;------------------------------------------------</span>
<span class="comments">; PLOT REFLECTANCE DATA AGAINST DOY</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: PLOTTING TOA REFLECTANCE AGAINST DOY'
  PLOT,MERIS_L1B_REF_GD[0,*],MERIS_L1B_REF_GD[NUM_NON_REF,*],/NODATA,$
  COLOR = 0, BACKGROUND = 255,$
  YTITLE = 'TOA REFLECTANCE (DL)',$
  XTITLE = 'DECIMAL YEAR',$
  YRANGE = [YMIN,YMAX],$
  XTICKFORMAT='((F8.3))'

  FOR PLOT_BAND=0,NB_BANDS-1 DO BEGIN
    TT = WHERE(MERIS_L1B_REF_GD[NUM_NON_REF+PLOT_BAND,*] GT 0.0 AND MERIS_L1B_REF_GD[NUM_NON_REF+PLOT_BAND,*] LT 1.0)
    IF TT[0] GT -1 THEN OPLOT, MERIS_L1B_REF_GD[0,TT],MERIS_L1B_REF_GD[NUM_NON_REF+PLOT_BAND,TT],$
    COLOR = 250.*PLOT_BAND/15.
  ENDFOR

  TEMP = TVRD(TRUE=1)
  OUTPUT_IMAGE = STRING(OUTPUT_BASE+'TOA_REFLECTANCE.jpg')
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: REFLECTANCE OUTPUT AT ',OUTPUT_IMAGE
  WRITE_JPEG,OUTPUT_IMAGE,TEMP,TRUE=1,QUALITY=100
  ERASE

<span class="comments">;----------------------------------------------</span>
<span class="comments">;PLOT REFLECTANCE EVOLUTION AGAINST DOY</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: PLOTTING TOA REFLECTANCE EVOLUTION AGAINST DOY'
  PLOT,MERIS_L1B_REF_GD[0,*],100.0*(MERIS_L1B_REF_GD[NUM_NON_REF,*]-MERIS_L1B_REF_GD[NUM_NON_REF,0])/MERIS_L1B_REF_GD[NUM_NON_REF,0],/NODATA,$
  COLOR = 0, BACKGROUND = 255,$
  YTITLE = 'TOA REFLECTANCE EVOLUTION (%)',$
  XTITLE = 'DECIMAL YEAR',$
  XTICKFORMAT='((F8.3))'
 
  FOR PLOT_BAND=0,NB_BANDS-1 DO BEGIN
    TT = WHERE(MERIS_L1B_REF_GD[NUM_NON_REF+PLOT_BAND,*] GT 0.0 AND MERIS_L1B_REF_GD[NUM_NON_REF+PLOT_BAND,*] LT 1.0)
    IF TT[0] GT -1 THEN OPLOT, MERIS_L1B_REF_GD[0,TT],100.0*(MERIS_L1B_REF_GD[NUM_NON_REF+PLOT_BAND,TT]-MERIS_L1B_REF_GD[NUM_NON_REF+PLOT_BAND,0])/MERIS_L1B_REF_GD[NUM_NON_REF+PLOT_BAND,0],$
    COLOR = 250.*PLOT_BAND/15.
  ENDFOR

  TEMP = TVRD(/TRUE)
  OUTPUT_IMAGE = string(OUTPUT_BASE+'TOA_EVOLUTION.jpg')
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: EVOLUTION OUTPUT AT ',OUTPUT_IMAGE
  WRITE_JPEG,OUTPUT_IMAGE,TEMP,TRUE=1,QUALITY=100
  ERASE

<span class="comments">;-----------------------------------------------</span>
<span class="comments">; PLOT SENSOR ZENITH AGAINST DOY</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: PLOTTING SENSOR ZENITH AGAINST DOY' 
  PLOT,MERIS_L1B_REF_GD[0,*],MERIS_L1B_REF_GD[1,*],/NODATA,$
  COLOR = 0, BACKGROUND = 255,$
  YTITLE = 'SENSOR ZENITH OVER ROI (DEGREES)',$
  XTITLE = 'DECIMAL YEAR',$
  XTICKFORMAT='((F8.3))'
  
  OPLOT,MERIS_L1B_REF_GD[0,*],MERIS_L1B_REF_GD[1,*],$
  PSYM = 2,$
  COLOR = 250

  TEMP = TVRD(/TRUE)
  OUTPUT_IMAGE = STRING(OUTPUT_BASE+'SENSOR_ZENITH_ANGLE.jpg')
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: SENSOR ZENITH OUTPUT AT ',OUTPUT_IMAGE
  WRITE_JPEG,OUTPUT_IMAGE,TEMP,TRUE=1,QUALITY=100
  ERASE

<span class="comments">;-----------------------------------------------</span>
<span class="comments">; PLOT SOLAR ZENITH AGAINST DOY</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: PLOTTING SOLAR ZENITH AGAINST DOY' 
  PLOT,MERIS_L1B_REF_GD[0,*],MERIS_L1B_REF_GD[3,*],/NODATA,$
  COLOR = 0, BACKGROUND = 255,$
  YTITLE = 'SOLAR ZENITH OVER ROI (DEGREES)',$
  XTITLE = 'DECIMAL YEAR',$
  XTICKFORMAT='((F8.3))'
  
  OPLOT,MERIS_L1B_REF_GD[0,*],MERIS_L1B_REF_GD[3,*],$
  PSYM = 2,$
  COLOR = 70

  TEMP = TVRD(/TRUE)
  OUTPUT_IMAGE = STRING(OUTPUT_BASE+'SOLAR_ZENITH_ANGLE.jpg')
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: SOLAR ZENITH OUTPUT AT ',OUTPUT_IMAGE
  WRITE_JPEG,OUTPUT_IMAGE,TEMP,TRUE=1,QUALITY=100
  ERASE

<span class="comments">;-----------------------------------------------</span>
<span class="comments">; RETURN DEVISE WINDOW TO NOMINAL SETTING</span>
 
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'MERIS_TIMESERIES_PLOTS: RESETTING DEVICE WINDOW PROPERTIES'
  IF KEYWORD_SET(NO_ZBUFF) THEN WDELETE
  SET_PLOT, MACHINE_WINDOW
  RETURN,1

END
</code>
    </div>
  </body>
</html>