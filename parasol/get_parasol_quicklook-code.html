<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Tue Jul  2 12:51:05 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>get_parasol_quicklook.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="get_parasol_quicklook.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      GET_PARASOL_QUICKLOOK       </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      OUTPUTS A RGB/GRAYSCALE PARASOL QUICKLOOK WITH ROI OVERLAY IF REQUESTED</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = GET_PARASOL_QUICKLOOK(FILENAME)      </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      FILENAME - A SCALAR CONTAINING THE FILENAME OF THE PRODUCT FOR QUICKLOOK GENERATION </span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*     RGB          -  PROGRAM GENERATES AN RGB COLOUR QUICKLOOK (DEFAULT IS GRAYSCALE)</span>
<span class="comments">;*     ROI          -  OVERLAY COORDINATES OF AN ROI IN RED (REQUIRES ICOORDS)</span>
<span class="comments">;*     ICOORDS      -  A 4-ELEMENT ARRAY OF ROI GEOLOCATION (N,S,E,W) </span>
<span class="comments">;*     QL_QUALITY   -  QUALITY OF JPEG GENERATED (100 = MAX, 0 = LOWEST)</span>
<span class="comments">;*     ENDIAN_SIZE  -  MACHINE ENDIAN SIZE (0: LITTLE, 1: BIG)</span>
<span class="comments">;*     VERBOSE      -  PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*     STATUS       - 1: NOMINAL, (-1) OR 0: ERROR</span>
<span class="comments">;*     JPESG ARE AUTOMATICALLY SAVED IN FILENAME FOLDER    </span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*     NONE </span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*                  - M BOUVET - PROTOTYPE DIMITRI VERSION</span>
<span class="comments">;*      17 DEC 2010 - C KENT   - DIMITRI-2 V1.0</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      01 DEC 2010 - C KENT    - WINDOWS 32-BIT MACHINE: COMPILATION SUCCESSFUL,</span>
<span class="comments">;*                                RGB,ROI,ICOORDS AND QL_QUALITY KEYWORDS TESTED </span>
<span class="comments">;*                                SUCCESSFULLY USING UYUNI COORDINATES</span>
<span class="comments">;*                              - LINUX 64-BIT MACHINE, IDL 8.0: COMPILATION SUCESSFUL, </span>
<span class="comments">;*                                RESULTS EQUAL TO WINDOWS MACHINE</span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION GET_PARASOL_QUICKLOOK,FILENAME,RGB=RGB,ROI=ROI,ICOORDS=ICOORDS,QL_QUALITY=QL_QUALITY,ENDIAN_SIZE=ENDIAN_SIZE,VERBOSE=VERBOSE

<span class="comments">;------------------------------------------------</span>
<span class="comments">; CHECK FILENAME AND IN_BAND ARE NOMINAL</span>

  IF FILENAME EQ '' THEN BEGIN
    PRINT, 'PARASOL L1B QUICKLOOK: ERROR, INPUT FILENAME INCORRECT'
    RETURN,-1
  ENDIF

<span class="comments">;------------------------------------------------</span>
<span class="comments">; IF ENDIAN SIZE NOT PROVIDED THEN GET VALUE</span>

  IF N_ELEMENTS(ENDIAN_SIZE) EQ 0 THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN BEGIN
      PRINT, 'PARASOL L1B QUICKLOOK: NO ENDIAN SIZE PROVIDED, RETRIEVING...'
      ENDIAN_SIZE = GET_ENDIAN_SIZE(/VERBOSE)
    ENDIF ELSE ENDIAN_SIZE = GET_ENDIAN_SIZE()
  ENDIF
  
<span class="comments">;------------------------------------------------</span>
<span class="comments">; SET JPEG QUALITY IF NOT PROVIDED</span>

  IF N_ELEMENTS(QL_QUALITY) EQ 0 THEN QL_QUALITY = 90
  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: JPEG QUALITY = ',QL_QUALITY
  
<span class="comments">;------------------------------------------------</span>
<span class="comments">; CHECK KEYWORD COMBINATIONS</span>

  IF KEYWORD_SET(ROI) AND N_ELEMENTS(ICOORDS) LT 4 THEN BEGIN
    PRINT,'PARASOL L1B QUICKLOOK: ERROR, ROI KEYWORD IS SET BUT COORDINATES INCORRECT'
    RETURN,-1
  ENDIF

<span class="comments">;------------------------------------------------</span>
<span class="comments">; DERIVE THE OUTPUT JPEG FILENAME</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: COMPUTING OUTPUT FILENAME'
  QL_PARASOL_JPG = FILENAME
  QL_PARASOL_JPG = STRING(filename+'.jpg')

<span class="comments">;------------------------------------------------</span>
<span class="comments">; GET PARASOL L1B RADIANCE DATA AND DERIVE QUICKLOOK IMAGE</span>

  IF KEYWORD_SET(VERBOSE) THEN BEGIN
    PRINT, 'PARASOL L1B QUICKLOOK: RETRIEVING RGB RADIANCE DATA'
    L1B_DATA = GET_PARASOL_L1B_DATA(FILENAME,ENDIAN_SIZE=ENDIAN_SIZE,/VERBOSE)
  ENDIF ELSE L1B_DATA = GET_PARASOL_L1B_DATA(FILENAME,ENDIAN_SIZE=ENDIAN_SIZE) 
  
  DD = L1B_DATA[*].COLUMN
  IF N_ELEMENTS(DD) LT 5 THEN RETURN,-1
    
  TEMP_SZA = COS(L1B_DATA.SZA[5]*!DTOR)

  IF KEYWORD_SET(RGB) THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: RGB JPEG SELECTED'

    QL_DATAR = L1B_DATA.REF_865P[5]/TEMP_SZA
    QL_DATAG = L1B_DATA.REF_565NP[5]/TEMP_SZA
    QL_DATAB = L1B_DATA.REF_443NP[5]/TEMP_SZA
    
  ENDIF ELSE BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: RETRIEVING RADIANCE 13 DATA'
    QL_DATAR  = L1B_DATA.REF_865P[5]/TEMP_SZA
  ENDELSE
  
  IF QL_DATAr[0] EQ -1 THEN BEGIN
    PRINT,'PARASOL L1B QUICKLOOK: ERROR, PROBLEM ENCOUNTERED DURING L1B RADIANCE RETRIEVAL, CHECK PRODUCTS IS A PARASOL L1B PRODUCT'
    RETURN,-1
  ENDIF

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: GET PRODUCT DIMENSIONS AND DEFINE IMAGE ARRAY'
  QL_DIMS  = SIZE(QL_DATAR)

<span class="comments">;-----------------------------------------------  </span>
<span class="comments">; REGRID DATA A LARGER SIZE  </span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: REGRIDDING THE QUICKLOOK INTO A LARGER ARRAY'
  MFACT = 5.0
  QL_DATAR = CONGRID(QL_DATAR,MFACT*QL_DIMS[1],MFACT*QL_DIMS[2])
  IF KEYWORD_SET(RGB) THEN BEGIN 
  QL_DATAG = CONGRID(QL_DATAG,MFACT*QL_DIMS[1],MFACT*QL_DIMS[2]) 
  QL_DATAB = CONGRID(QL_DATAB,MFACT*QL_DIMS[1],MFACT*QL_DIMS[2]) 
  ENDIF
  
  QL_DIMS_NEW  = SIZE(QL_DATAR)
  QL_IMAGE = BYTARR(3,QL_DIMS_NEW[1],QL_DIMS_NEW[2])
  
<span class="comments">;-----------------------------------------------</span>
<span class="comments">; POPULATE THE QUICKLOOK IMAGE ARRAY  </span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: ADD RADIANCE DATA TO IMAGE ARRAY CHANNELS'
  TOP_RAD = 200.0
  IF KEYWORD_SET(RGB) THEN BEGIN 
   
    TEMP_MAX = MAX([MAX(QL_DATAR),MAX(QL_DATAG),MAX(QL_DATAB)])
    QL_IMAGE[0,*,*]=BYTSCL(QL_DATAR,MAX=TEMP_MAX,TOP=TOP_RAD)
    QL_IMAGE[1,*,*]=BYTSCL(QL_DATAG,MAX=TEMP_MAX,TOP=TOP_RAD)
    QL_IMAGE[2,*,*]=BYTSCL(QL_DATAB,MAX=TEMP_MAX,TOP=TOP_RAD)

<span class="comments">;----------------------------------------------</span>
<span class="comments">; RELEASE MEMORY FOR GREEN AND BLUE CHANNELS</span>
    
    QL_DATAG = 0
    QL_DATAB = 0
    
  ENDIF ELSE BEGIN
    QL_IMAGE[0,*,*]=BYTSCL(QL_DATAR,TOP=TOP_RAD)
    QL_IMAGE[1,*,*]=BYTSCL(QL_DATAR,TOP=TOP_RAD)
    QL_IMAGE[2,*,*]=BYTSCL(QL_DATAR,TOP=TOP_RAD)
  ENDELSE

<span class="comments">;---------------------------------------------------</span>
<span class="comments">; GET LAT/LON DATA FOR ROI PIXEL INDEX IF REQUESTED</span>

  IF KEYWORD_SET(ROI) THEN BEGIN
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: OVERLAY OF ROI SELECTED'
    IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: RETRIEVING PRODUCT GEOLOCATION'
     
<span class="comments">;---------------------------------------------------</span>
<span class="comments">; REVERSE GEOLOCATION ARRAYS INTO SAME ORIENTAITON AS RADIANCE</span>

    QL_GEO_LAT = CONGRID(L1B_DATA.LATITUDE,MFACT*QL_DIMS[1],MFACT*QL_DIMS[2])
    QL_GEO_LON = CONGRID(L1B_DATA.LONGITUDE,MFACT*QL_DIMS[1],MFACT*QL_DIMS[2])
           
    QL_ROI_IDX = WHERE($
          QL_GEO_LAT LT ICOORDS[0] AND $
          QL_GEO_LAT GT ICOORDS[1] AND $
          QL_GEO_LON LT ICOORDS[2] AND $
          QL_GEO_LON GT ICOORDS[3] )

<span class="comments">;---------------------------------------------------</span>
<span class="comments">; CONVERT ROI PIXELS TO A LIGHT RED OVERLAY</span>

    IF QL_ROI_IDX[0] GT -1 THEN BEGIN
          IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: MODIFYING RED CHANNEL FOR ROI OVERLAY'
          <span class="comments">;QL_DATAR = BYTSCL(QL_DATAR,TOP=TOP_RAD)</span>
          <span class="comments">;QL_DATAR[QL_ROI_IDX]=255</span>
          <span class="comments">;QL_IMAGE[0,*,*] = QL_DATAR</span>
            QL_DATAR = QL_IMAGE[0,*,*]
            QL_DATAG = QL_IMAGE[1,*,*]
            QL_DATAB = QL_IMAGE[2,*,*]
          
            QL_DATAR[QL_ROI_IDX]=250
            QL_DATAG[QL_ROI_IDX]=bytscl(QL_DATAG[QL_ROI_IDX],top=75)
            QL_DATAB[QL_ROI_IDX]=bytscl(QL_DATAb[QL_ROI_IDX],top=75)
            QL_IMAGE[0,*,*] = QL_DATAR
            QL_IMAGE[1,*,*] = QL_DATAG
            QL_IMAGE[2,*,*] = QL_DATAB
          
    ENDIF
  ENDIF

<span class="comments">;---------------------------------------------------</span>
<span class="comments">; OUTPUT QUICKLOOK AS JPEG</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B QUICKLOOK: WRITING IMAGE TO JPEG'
  WRITE_JPEG ,QL_PARASOL_JPG,QL_IMAGE,TRUE=1,/ORDER
  
<span class="comments">;---------------------------------------------------</span>
<span class="comments">; RETURN A POSITIVE VALUE INDICATING QL GENERATION OK</span>

  RETURN, 1

END
</code>
    </div>
  </body>
</html>