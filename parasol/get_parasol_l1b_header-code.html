<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.5.1 on Thu Jul  4 16:01:52 2013 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>get_parasol_l1b_header.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="get_parasol_l1b_header.pro (Documentation for /home/marrabld/projects/DIMITRI_2.0/Source/)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;*</span>
<span class="comments">;* NAME:</span>
<span class="comments">;*      GET_PARASOL_L1B_HEADER       </span>
<span class="comments">;* </span>
<span class="comments">;* PURPOSE:</span>
<span class="comments">;*      RETURNS THE HEADER DATA FOR A SPECIFIC PARASOL PRODUCT</span>
<span class="comments">;* </span>
<span class="comments">;* CALLING SEQUENCE:</span>
<span class="comments">;*      RES = GET_PARASOL_L1B_HEADER(FILENAME)      </span>
<span class="comments">;* </span>
<span class="comments">;* INPUTS:</span>
<span class="comments">;*      FILENAME - A SCALAR CONTAINING THE FILENAME OF THE PRODUCT TO BE READ </span>
<span class="comments">;*</span>
<span class="comments">;* KEYWORDS:</span>
<span class="comments">;*      VERBOSE     - PROCESSING STATUS OUTPUTS</span>
<span class="comments">;*</span>
<span class="comments">;* OUTPUTS:</span>
<span class="comments">;*      L1B_DATA    - A STRUCTURE CONTAINING THE HEADER INFORMATION </span>
<span class="comments">;*</span>
<span class="comments">;* COMMON BLOCKS:</span>
<span class="comments">;*      NONE</span>
<span class="comments">;*</span>
<span class="comments">;* MODIFICATION HISTORY:</span>
<span class="comments">;*             2005 - M BOUVET - PROTOTYPE DIMITRI VERSION</span>
<span class="comments">;*      15 DEC 2010 - C KENT   - DIMITRI-2 V1.0</span>
<span class="comments">;*      14 JUL 2011 - C KENT   - UPDATED TIME EXTRACTION SECTION</span>
<span class="comments">;*      29 FEB 2012 - C KENT   - ADDED SEQUENCE TIME EXTRACTION</span>
<span class="comments">;*</span>
<span class="comments">;* VALIDATION HISTORY:</span>
<span class="comments">;*      10 JAN 2011 - C KENT   - WINDOWS 32 BIT MACHINE, IDL 7.1: COMPILATION AND </span>
<span class="comments">;*                               RUNNING SUCCESSFUL, RESULTS NOMINAL</span>
<span class="comments">;*                             - LINUX 64-BIT MACHINE, IDL 8.0: COMPILATION SUCESSFUL, </span>
<span class="comments">;*                               RESULTS EQUAL TO WINDOWS MACHINE </span>
<span class="comments">;*</span>
<span class="comments">;**************************************************************************************</span>
<span class="comments">;**************************************************************************************</span>

FUNCTION GET_PARASOL_L1B_HEADER,FILENAME,VERBOSE=VERBOSE

<span class="comments">;------------------------</span>
<span class="comments">; FILENAME PARAMETER CHECK</span>

  IF STRCMP(FILENAME,'') THEN BEGIN
    PRINT, 'PARASOL L1B HEADER: NO INPUT FILES PROVIDED, RETURNING...'
    RETURN,-1
  ENDIF  
  
<span class="comments">;-----------------------------------------------</span>
<span class="comments">; CHECK FILENAME OS A PARASOL DATA FILE</span>

  TEMP = STRMATCH(FILENAME,'*P3L1TBG*D*')
  IF TEMP EQ 0 THEN BEGIN
    PRINT, 'PARASOL L1B HEADER: ERROR, INPUT FILE NOT A PARASOL DATA FILE'
    RETURN,-1
  ENDIF

<span class="comments">;------------------------------------------------</span>
<span class="comments">; CONVERT FILENAME TO HEADER FILENAME</span>

  IF KEYWORD_SET(VERBOSE) THEN PRINT, 'PARASOL L1B HEADER: COMPUTING LEADER FILE FROM INPUT FILENAME'
  TEMP = STRPOS(FILENAME,'P3L1TBG',/REVERSE_SEARCH)
  HDR_FILE = FILENAME
  STRPUT,HDR_FILE,'L',TEMP+15

<span class="comments">;------------------------------------------------</span>
<span class="comments">; CHECK THAT THE FILE EXISTS</span>

  TEMP = FILE_INFO(HDR_FILE)
  IF TEMP.EXISTS EQ 0 THEN BEGIN
    PRINT, 'PARASOL L1B DATA: ERROR, INPUT FILE DOES NOT EXIST'
    RETURN,-1
  ENDIF

<span class="comments">;------------------------------------------------</span>
<span class="comments">; DEFINE HEADER STRUCTURE</span>

  L1B_HEADER = {$
              DATE:STRARR(1),$
              SOFTWARE_VERSION:STRARR(1),$
              DEM_MODEL:STRARR(1),$
              RAD_DATE:STRARR(1),$
              GEO_DATE:STRARR(1), $
              SEQ_DATE:STRARR(130,9), $
              SCL_FACT:FLTARR(16,9), $
              OFF_FACT:FLTARR(16,9) $
              }

<span class="comments">;------------------------------------------------</span>
<span class="comments">; OPEN THE PRODUCT </span>

  OPENR,IN_PARA,HDR_FILE,/GET_LUN
  
<span class="comments">;------------------------------------------------</span>
<span class="comments">; DEFINE TEMPORARY VARIABLES FOR READING</span>

  TEMP_SSI = INTARR(1)
  TEMP_USI = UINTARR(1)
  TEMP_ULI = ULONARR(1)
  TEMP_BYT = BYTARR(16)
  TEMP_REF = INTARR(15)

<span class="comments">;------------------------------------------------</span>
<span class="comments">; RETIREVE THE PRODUCT DATE</span>

  POINT_LUN,IN_PARA,180+360+100
  TEMP = BYTARR(16)
  READU,IN_PARA,TEMP
  L1B_HEADER.DATE = STRING(TEMP)

<span class="comments">;------------------------------------------------</span>
<span class="comments">; RETIREVE THE SOFTWARE VERSION</span>

  POINT_LUN,IN_PARA,26
  TEMP = BYTARR(6)
  READU,IN_PARA,TEMP
  L1B_HEADER.SOFTWARE_VERSION = STRING('VERSION_'+STRING(TEMP))

<span class="comments">;------------------------------------------------</span>
<span class="comments">; RETIREVE THE DEM VERSION</span>

  POINT_LUN,IN_PARA,180+134
  TEMP = BYTARR(30)
  READU,IN_PARA,TEMP
  L1B_HEADER.DEM_MODEL = STRING(TEMP)

<span class="comments">;------------------------------------------------</span>
<span class="comments">; RETIREVE THE RAD VERSION</span>

  POINT_LUN,IN_PARA,180+360+1620+180+166320+296
  TEMP = BYTARR(16)
  READU,IN_PARA,TEMP
  L1B_HEADER.RAD_DATE = STRING('RAD_'+STRMID(STRING(TEMP),0,8))  
 
<span class="comments">;------------------------------------------------</span>
<span class="comments">; RETIREVE THE GEO VERSION</span>

  POINT_LUN,IN_PARA,180+360+1620+180+166320+336
  TEMP = BYTARR(16)
  READU,IN_PARA,TEMP
  L1B_HEADER.GEO_DATE = STRING('GEO_'+STRMID(STRING(TEMP),0,8))      
  
<span class="comments">;------------------------------------------------</span>
<span class="comments">; GET DATE OF EACH SEQUENCE IN PRODUCT</span>

  SKIP = 180+360+1620+180
  FOR ISEQ = 1,130 DO BEGIN
    POINT_LUN,IN_PARA,SKIP+1278l*(ISEQ-1)+8
    SEQN = BYTARR(4)
    READU,IN_PARA,SEQN
    SEQN = STRING(SEQN)
    
    FOR ISEQB=1,9 DO BEGIN
      POINT_LUN,IN_PARA,SKIP+1278L*(ISEQ-1)+138L*(ISEQB-1)+46
      TEMP = BYTARR(16)
      READU,IN_PARA,TEMP
      L1B_HEADER.SEQ_DATE[(FIX(SEQN)-1)>0,(ISEQB-1)] = STRMID(STRING(TEMP),0,14) <span class="comments">; YYYYMMDDHHMNSS</span>
    ENDFOR
  ENDFOR

<span class="comments">;------------------------------------------------ </span>
<span class="comments">; GET SCALING FACTORS</span>

   SKIP = 180+360+1620+180+166320+720
   FOR IPD=0,15 DO BEGIN
     FOR IPB=0,8 DO BEGIN   
       PNUM = 23*(IPD+1)+(IPB-9)
       POINT_LUN,IN_PARA,SKIP+26*(PNUM-1)+46
       TEMP = BYTARR(12)
       READU,IN_PARA,TEMP
       L1B_HEADER.SCL_FACT[IPD,IPB] = FLOAT(STRING(TEMP))
    
       POINT_LUN,IN_PARA,SKIP+26*(PNUM-1)+48
       TEMP = BYTARR(12)
       READU,IN_PARA,TEMP
       L1B_HEADER.OFF_FACT[IPD,IPB] = FLOAT(STRING(TEMP))
     ENDFOR
   ENDFOR
 
<span class="comments">;------------------------------------------------</span>
<span class="comments">; CLOSE THE PRODUCT</span>

  FREE_LUN, IN_PARA 
 
<span class="comments">;------------------------------------------------</span>
<span class="comments">; RETURN THE HEADER INFORMATION</span>

  RETURN,L1B_HEADER

END
</code>
    </div>
  </body>
</html>